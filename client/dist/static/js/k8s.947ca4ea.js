(function(e){function t(t){for(var o,i,s=t[0],n=t[1],c=t[2],p=0,u=[];p<s.length;p++)i=s[p],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&u.push(r[i][0]),r[i]=0;for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);d&&d(t);while(u.length)u.shift()();return l.push.apply(l,c||[]),a()}function a(){for(var e,t=0;t<l.length;t++){for(var a=l[t],o=!0,s=1;s<a.length;s++){var n=a[s];0!==r[n]&&(o=!1)}o&&(l.splice(t--,1),e=i(i.s=a[0]))}return e}var o={},r={k8s:0},l=[];function i(t){if(o[t])return o[t].exports;var a=o[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=o,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(a,o,function(t){return e[t]}.bind(null,o));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],n=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=n;l.push([2,"chunk-vendors","chunk-common"]),a()})({"04e5":function(e,t,a){"use strict";var o=a("e93e"),r=a.n(o);r.a},"0d43":function(e,t,a){},"0dbe":function(e,t,a){},"108d":function(e,t,a){},"11e0":function(e,t,a){},"138c":function(e,t,a){},"168e":function(e,t,a){},2:function(e,t,a){e.exports=a("4933")},"244f":function(e,t,a){"use strict";var o=a("138c"),r=a.n(o);r.a},"24ee":function(e,t,a){},2562:function(e,t,a){"use strict";var o=a("626e"),r=a.n(o);r.a},"29ca":function(e,t,a){"use strict";var o=a("c49e"),r=a.n(o);r.a},"2c1d":function(e,t,a){},3976:function(e,t,a){"use strict";var o=a("11e0"),r=a.n(o);r.a},"3d87":function(e,t,a){},"437c":function(e,t,a){},"44ae":function(e,t,a){"use strict";var o=a("b2b3"),r=a.n(o);r.a},4917:function(e,t,a){"use strict";var o=a("108d"),r=a.n(o);r.a},4933:function(e,t,a){"use strict";a.r(t);a("e260"),a("e6cf"),a("cca6"),a("a79d");var o=a("a026"),r=(a("9c65"),a("42a2a")),l=(a("b3f5"),a("0ce2"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("k8s-header"),a("p",{attrs:{id:"web_version"}},[e._v("Version:"+e._s(e.web_version))]),a("keep-alive",[a("router-view",{staticClass:"main-width"})],1)],1)}),i=[],s=a("bc3a"),n=a.n(s),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app_index__header"},[a("div",{staticClass:"main-width"},[a("el-row",{attrs:{gutter:24}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"logo-wrap"},["true"===e.enable&&"true"===e.show?a("a",{attrs:{href:"/"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/tars-logo.png"}})]):e._e(),"true"===e.k8s?a("a",{class:{active:!0},attrs:{href:"/k8s.html"}},[a("img",{staticClass:"logo",attrs:{src:"/static/img/K8S.png"}})]):e._e(),"true"===e.enable?a("a",{attrs:{href:"/dcache.html"}},[a("img",{staticClass:"logo",attrs:{alt:"dcache",src:"/static/img/dcache-logo.png"}})]):e._e()])]),a("el-col",{attrs:{span:12}},[a("let-tabs",{staticClass:"tabs",attrs:{center:!0,activekey:e.$route.matched[0].path},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab1"),tabkey:"/server",icon:e.serverIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab2"),tabkey:"/operation",icon:e.opaIcon}}),a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab8"),tabkey:"/gateway",icon:e.cacheIcon}}),"true"==e.enableMarket?a("let-tab-pane",{attrs:{tab:e.$t("header.tab.tab9"),tabkey:"/market/list",icon:e.packageIcon}}):e._e()],1)],1),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"language-wrap"},[a("let-select",{attrs:{clearable:!1},on:{change:e.changeLocale},model:{value:e.locale,callback:function(t){e.locale=t},expression:"locale"}},[e._l(e.localeMessages,(function(t){return[a("let-option",{key:t.localeCode,attrs:{value:t.localeCode}},[e._v(e._s(t.localeName))])]}))],2)],1)]),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"user-wrap"},[a("el-dropdown",{staticStyle:{display:"block!important"},on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[e._v(" "+e._s(e.uid)),a("i",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:e.enableLogin,expression:"enableLogin"}],attrs:{command:"center"}},[e._v(e._s(e.$t("header.userCenter")))]),a("el-dropdown-item",{attrs:{command:"modifyPass"}},[e._v(e._s(e.$t("header.modifyPass")))]),a("el-dropdown-item",{attrs:{command:"quit"}},[e._v(e._s(e.$t("header.logout")))])],1)],1),e.marketUid?a("el-dropdown",{on:{command:e.handleMarketCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-cloudy el-icon--left"}),e._v(" "+e._s(e.marketUid.uid)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"pass"}},[e._v(e._s(e.$t("market.header.pass")))]),a("el-dropdown-item",{attrs:{command:"project"}},[e._v(e._s(e.$t("market.header.repo")))]),a("el-dropdown-item",{attrs:{command:"modify"}},[e._v(e._s(e.$t("market.header.modify")))]),a("el-dropdown-item",{attrs:{command:"quit"}},[e._v(e._s(e.$t("market.header.quit")))])],1)],1):e._e()],1)])],1)],1)])},d=[],p=(a("ac1f"),a("5319"),a("1817")),u=a.n(p),m=a("1ca6"),f=a.n(m),h=a("4d18"),v=a.n(h),g=a("cc08"),b=a.n(g),$=a("3e1a"),S=a.n($),y=a("f51c"),_={data:function(){return{serverIcon:u.a,opaIcon:f.a,releaseIcon:v.a,cacheIcon:b.a,operatorIcon:S.a,packageIcon:v.a,locale:this.$cookie.get("locale")||"en",enableMarket:this.$cookie.get("market")||"false",uid:"--",enableLogin:!1,isAdmin:!1,localeMessages:y["c"],k8s:this.$cookie.get("k8s")||"false",enable:this.$cookie.get("enable")||"false",show:this.$cookie.get("show")||"false",enableLdap:!1}},computed:{marketUid:function(){return this.$store.state.marketUid}},methods:{handleCommand:function(e){"center"==e?location.href="/auth.html":"modifyPass"==e&&(location.href="/pass.html"),"quit"==e&&(location.href="/logout")},handleMarketCommand:function(e){"quit"==e?(this.$store.commit({type:"quit"}),this.$router.push("/market/user/login")):"pass"==e?this.$router.push("/market/repo/pass"):"project"==e?this.$router.push("/market/repo/project"):"modify"==e&&this.$router.push("/market/user/modifyPass")},clickTab:function(e){this.$router.replace(e)},userCenter:function(){window.open("/pages/server/api/userCenter")},getLoginUid:function(){var e=this;this.$ajax.getJSON("/server/api/get_login_uid").then((function(t){t&&t.uid?e.uid=t.uid:e.uid="***"})).catch((function(t){e.$tip.error("获取用户登录信息: ".concat(t.err_msg||t.message))}))},changeLocale:function(){this.$cookie.set("locale",this.locale,{expires:"1Y"}),location.reload()},checkEnableLogin:function(){var e=this;this.$ajax.getJSON("/server/api/is_enable_login").then((function(t){e.enableLogin=t.enableLogin||!1})).catch((function(e){}))},checkEnableLdap:function(){var e=this;this.$ajax.getJSON("/server/api/isEnableLdap").then((function(t){e.enableLdap=t.enableLdap||!1})).catch((function(e){}))},checkAdmin:function(){var e=this;this.isAdmin=!1,this.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){}))}},mounted:function(){this.getLoginUid(),this.checkEnableLogin(),this.checkAdmin(),this.checkEnableLdap(),window.header=this}},k=_,w=(a("c219"),a("2877")),M=Object(w["a"])(k,c,d,!1,null,null,null),x=M.exports,N=a("559f"),C={name:"App",components:{K8sHeader:x,AppFooter:N["a"]},data:function(){return{web_version:" loading··"}},mounted:function(){var e=this;n.a.create({baseURL:"/"})({method:"get",url:"/k8s_version"}).then((function(t){e.web_version=t.data}))}},T=C,L=(a("7b9a"),Object(w["a"])(T,l,i,!1,null,null,null)),A=L.exports,I=a("8c4f"),D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server"},[a("div",{staticClass:"left-view"},[a("div",{staticClass:"tree_search"},[a("el-input",{attrs:{size:"small",placeholder:e.$t("home.placeholder")},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.filterTextChange(t)}},model:{value:e.treeSearchKey,callback:function(t){e.treeSearchKey=t},expression:"treeSearchKey"}})],1),a("div",{staticClass:"tree_wrap"},[a("a",{staticClass:"tree_icon iconfont el-icon-third-shuaxin",class:{active:e.isIconPlay},staticStyle:{"font-family":"iconfont  !important","z-index":"99"},attrs:{href:"javascript:;"},on:{click:function(t){return e.treeSearch(1)}}}),e.treeData&&e.treeData.length?a("el-tree",{ref:"trees",staticClass:"left-tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,"highlight-current":"","empty-text":e.$t("common.noService"),"node-key":"id"},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){t.node;var o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("el-tooltip",{attrs:{content:o.name+"("+o.serverType+")",placement:"bottom-start",effect:"light","open-delay":e.openDelay}},[a("span",[2==o.type?a("i",{class:e._f("serverTypeFilter")(o.serverType)}):e._e(),e._v(" "+e._s(o.name)+" ")])])],1)}}],null,!1,4191436028)}):e._e(),e.treeData?e._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"left-tree"},[!1===e.treeData?a("div",{staticClass:"loading"},[a("p",[e._v(e._s(e.treeErrMsg))]),a("a",{attrs:{href:"javascript:;"},on:{click:e.getTreeData}},[e._v(e._s(e.$t("common.reTry")))])]):e._e()])],1)]),a("div",{staticClass:"right-view"},[a("div",{staticClass:"btabs_wrap"},[a("ul",{directives:[{name:"vscroll",rawName:"v-vscroll"}],ref:"btabs",staticClass:"btabs"},[a("li",{key:e.homeTab,staticClass:"btabs_item",class:{active:e.homeTab===e.treeid}},[a("a",{staticClass:"btabs_link",staticStyle:{"padding-right":"20px"},attrs:{href:"javascript:;"},on:{click:function(t){return e.clickBTabs(t,e.homeTab)}}},[e._v(" "+e._s(e.$t("home.homeTab"))+" ")])]),e._l(e.BTabs,(function(t){return a("li",{key:t.id,staticClass:"btabs_item",class:{active:t.id===e.treeid}},[a("a",{staticClass:"btabs_link",attrs:{href:"javascript:;"},on:{click:function(a){return e.clickBTabs(a,t.id)}}},[e._v(e._s(t.id))]),a("a",{staticClass:"btabs_close",attrs:{href:"javascript:;"},on:{click:function(a){return e.closeBTabs(t.id)}}},[e._v(" "+e._s(e.$t("home.close")))])])}))],2),a("a",{staticClass:"btabs_all",attrs:{href:"javascript:;",title:e.$t("home.closeAll")},on:{click:e.closeAllBTabs}},[e._v(" "+e._s(e.$t("home.closeAll")))])]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.treeid===e.homeTab,expression:"treeid === homeTab"}],staticClass:"btabs_con_home",staticStyle:{height:"800px"}},[a("serverHistory")],1),a("div",{staticClass:"btabs_con"},e._l(e.BTabs,(function(t){return t.id===e.treeid?a("div",{key:t.id,staticClass:"btabs_con_item"},[a("let-tabs",{attrs:{activekey:t.path},on:{click:e.clickTab}},[a("let-tab-pane",{attrs:{tabkey:e.base+"/manage",tab:e.$t("header.tab.tab1")}}),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/history",tab:e.$t("header.tab.tab7")}}):e._e(),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/publish",tab:e.$t("index.rightView.tab.patch")}}):e._e(),5===e.serverData.level||1===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/config",tab:5===e.serverData.level?e.$t("index.rightView.tab.serviceConfig"):1===e.serverData.level?e.$t("index.rightView.tab.appConfig"):""}}):e._e(),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/server-monitor",tab:e.$t("index.rightView.tab.statMonitor")}}):e._e(),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/property-monitor",tab:e.$t("index.rightView.tab.propertyMonitor")}}):e._e(),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/user-manage",tab:e.$t("index.rightView.tab.privileage")}}):e._e(),5===e.serverData.level?a("let-tab-pane",{attrs:{tabkey:e.base+"/callChain",tab:e.$t("index.rightView.tab.treeConfig")}}):e._e()],1),a(e.getName(t.path),{ref:"childView",refInFor:!0,tag:"router-view",staticClass:"page_server_child",attrs:{treeid:t.id}})],1):e._e()})),0)])])},O=[],q=(a("4de4"),a("4160"),a("c975"),a("baa5"),a("a434"),a("b0c0"),a("1276"),a("159b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",{staticStyle:{float:"left"}},[e._v(" "+e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"icon iconfont el-icon-third-shuaxin",staticStyle:{"font-family":"iconfont !important",cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})]),e.isApplication?e._e():a("span",{staticClass:"btn_group",staticStyle:{float:"right"}},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.manageK8S}},[e._v(e._s(e.$t("operate.k8s")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.configServer}},[e._v(e._s(e.$t("operate.server")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.manageServant}},[e._v(e._s(e.$t("operate.servant")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.viewTemplate}},[e._v(e._s(e.$t("operate.viewTemplate")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.privateTemplateManage}},[e._v(e._s(e.$t("operate.privateTemplateManage")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.startServer}},[e._v(e._s(e.$t("operate.startServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.restartServer}},[e._v(e._s(e.$t("operate.restartServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.stopServer}},[e._v(e._s(e.$t("operate.stopServer")))]),e._v(" "),a("let-button",{attrs:{theme:"primary",size:"small",disabled:e.isNormal},on:{click:e.showMoreCmd}},[e._v(e._s(e.$t("operate.more")))])],1)]),e.serverList?a("div",{ref:"serverListLoading"},[a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{on:{change:function(a){return e.checkChange(t.row)}},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}],null,!1,3049151486)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:"pid",prop:"Pid"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.SettingState)},[e._v(e._s(t.row.SettingState))])]}}],null,!1,987565344)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.PresentState)},[e._v(e._s(t.row.PresentState))])]}}],null,!1,1754665792)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:t.row.PresentMessage||""}},[a("let-table-operation",[a("span",{staticClass:"over"},[e._v(e._s(t.row.PresentMessage))])])],1)]}}],null,!1,874570244)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.deletePod(t.row)}}},[e._v(e._s(e.$t("operate.deletePod"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.viewEvent(t.row)}}},[e._v(e._s(e.$t("operate.viewEvent"))+" ")])]}}],null,!1,702003604)})],1)],1):e._e(),a("div",{staticClass:"table_head"},[e.serverNotifyList&&e.showOthers?a("h4",[e._v(" "+e._s(this.$t("serverList.title.serverStatus"))+" "),a("i",{staticClass:"icon iconfont",staticStyle:{"font-family":"iconfont !important",cursor:"pointer"},on:{click:function(t){return e.getServerNotifyList()}}},[e._v("")])]):e._e()]),e.serverNotifyList&&e.showOthers?a("let-table",{ref:"serverNotifyListLoading",attrs:{data:e.serverNotifyList,stripe:"","empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("common.time"),width:"160px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.timeStr))])]}}],null,!1,3973901746)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.serviceID"),prop:"AppServer"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.app+"."+t.row._source.server))])]}}],null,!1,4255247636)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.podName))])]}}],null,!1,1996751150)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.source"),prop:"NotifySource"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(t.row._source.source))])]}}],null,!1,1994068079)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.result"),prop:"NotifyMessage"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.statusStyle(t.row._source.message)},[e._v(e._s(t.row._source.message))])]}}],null,!1,2929402306)})],1):e._e(),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.notifyPagination.page,total:e.notifyPagination.total},on:{change:e.notifyGotoPage}})],1),a("let-modal",{attrs:{title:e.$t("serverList.dlg.title.editService"),width:"800px",footShow:!(!e.configModal.model||!e.configModal.model.ServerId)},on:{"on-confirm":e.saveConfig,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model&&e.configModal.model.ServerId?a("let-form",{ref:"configForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("common.template"),required:""}},[e.configModal.model.templates&&e.configModal.model.templates.length?a("let-select",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ServerTemplate,callback:function(t){e.$set(e.configModal.model,"ServerTemplate",t)},expression:"configModal.model.ServerTemplate"}},e._l(e.configModal.model.templates,(function(t){return a("let-option",{key:t.TemplateName,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName)+" ")])})),1):a("span",[e._v(e._s(e.configModal.model.ServerTemplate))])],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.asyncThread"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.dlg.placeholder.thread"),required:"",pattern:"tars.nodejs"===e.configModal.model.ServerTemplate?"^[1-9][0-9]*$":"^([3-9]|[1-9][0-9]+)$","pattern-tip":"$t('serverList.dlg.placeholder.thread')"},model:{value:e.configModal.model.AsyncThread,callback:function(t){e.$set(e.configModal.model,"AsyncThread",t)},expression:"configModal.model.AsyncThread"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.dlg.privateTemplate"),labelWidth:"150px",itemWidth:"724px"}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:10},model:{value:e.configModal.model.ServerProfile,callback:function(t){e.$set(e.configModal.model,"ServerProfile",t)},expression:"configModal.model.ServerProfile"}})],1)],1):a("div",{ref:"configFormLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.$t("serverList.table.servant.title"),width:"1200px",footShow:!1},on:{close:e.closeServantModal},model:{value:e.servantModal.show,callback:function(t){e.$set(e.servantModal,"show",t)},expression:"servantModal.show"}},[a("let-button",{staticClass:"tbm16",attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.configServant()}}},[e._v(e._s(e.$t("operate.add"))+" Servant ")]),e.servantModal.model?a("let-table",{attrs:{data:e.servantModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"OBJ",prop:"Name"}}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),prop:"Port"}}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTars?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3719090988)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTcp?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.configServant(t.row.AdapterId)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteServant(t.row.AdapterId)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2769818527)})],1):a("div",{ref:"servantModalLoading",staticClass:"loading-placeholder"})],1),a("let-modal",{attrs:{title:e.servantAddModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"1200px",footShow:!!e.servantAddModal.model},on:{"on-confirm":e.saveServantAdd,close:e.closeServantAddModal,"on-cancel":e.closeServantAddModal},model:{value:e.servantAddModal.show,callback:function(t){e.$set(e.servantAddModal,"show",t)},expression:"servantAddModal.show"}},[e.servantAddModal.model&&e.servantAddModal.model.ServerServant?a("let-form",{ref:"servantAddForm"},[a("let-table",{attrs:{data:e.servantAddModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.Name,callback:function(a){e.$set(t.row,"Name",a)},expression:"props.row.Name"}})]}}],null,!1,3758810427)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Port,callback:function(a){e.$set(t.row,"Port",a)},expression:"props.row.Port"}})]}}],null,!1,2319070108)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,1519152386)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3031957841)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Threads,callback:function(a){e.$set(t.row,"Threads",a)},expression:"props.row.Threads"}})]}}],null,!1,1655720946)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Connections,callback:function(a){e.$set(t.row,"Connections",a)},expression:"props.row.Connections"}})]}}],null,!1,2060048682)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Capacity,callback:function(a){e.$set(t.row,"Capacity",a)},expression:"props.row.Capacity"}})]}}],null,!1,58581595)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:t.row.Timeout,callback:function(a){e.$set(t.row,"Timeout",a)},expression:"props.row.Timeout"}})]}}],null,!1,1471836343)}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.$index===e.servantAddModal.model.ServerServant.length-1?a("let-table-operation",{on:{click:function(a){return e.addAdapter(t.row)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]):a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.servantAddModal.model.ServerServant.splice(t.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,1130946150)})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.servantDetailModal.isNew?e.$t("operate.title.add")+" Servant":e.$t("operate.title.update")+" Servant",width:"800px",footShow:!!e.servantDetailModal.model},on:{"on-confirm":e.saveServantDetail,close:e.closeServantDetailModal,"on-cancel":e.closeServantDetailModal},model:{value:e.servantDetailModal.show,callback:function(t){e.$set(e.servantDetailModal,"show",t)},expression:"servantDetailModal.show"}},[e.servantDetailModal.model&&1===e.servantDetailModal.model.ServerServant.length?a("let-form",{ref:"servantDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("serverList.servant.objName"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("serverList.servant.c"),required:"",pattern:"^[A-Za-z0-9]+$","pattern-tip":e.$t("serverList.servant.obj")},model:{value:e.servantDetailModal.model.ServerServant[0].Name,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Name",t)},expression:"servantDetailModal.model.ServerServant[0].Name"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.port"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.servantDetailModal.model.ServerServant[0].Port,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Port",t)},expression:"servantDetailModal.model.ServerServant[0].Port"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.numOfThread"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",placeholder:e.$t("serverList.servant.thread"),required:"",pattern:"^[1-9][0-9]*$","pattern-tip":e.$t("serverList.servant.thread")},model:{value:e.servantDetailModal.model.ServerServant[0].Threads,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Threads",t)},expression:"servantDetailModal.model.ServerServant[0].Threads"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.connections"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Connections,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Connections",t)},expression:"servantDetailModal.model.ServerServant[0].Connections"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.lengthOfQueue"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Capacity,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Capacity",t)},expression:"servantDetailModal.model.ServerServant[0].Capacity"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.queueTimeout"),labelWidth:"150px"}},[a("let-input",{attrs:{size:"small",type:"number"},model:{value:e.servantDetailModal.model.ServerServant[0].Timeout,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"Timeout",t)},expression:"servantDetailModal.model.ServerServant[0].Timeout"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.protocol"),required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTars,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTars",t)},expression:"servantDetailModal.model.ServerServant[0].IsTars"}},[e._v("NOT TARS")])],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.portType"),required:""}},[a("let-radio",{attrs:{label:!0},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1},model:{value:e.servantDetailModal.model.ServerServant[0].IsTcp,callback:function(t){e.$set(e.servantDetailModal.model.ServerServant[0],"IsTcp",t)},expression:"servantDetailModal.model.ServerServant[0].IsTcp"}},[e._v("UDP")])],1)],1):e._e()],1),a("k8sManager",{ref:"k8s"}),a("let-modal",{staticClass:"more-cmd",attrs:{title:e.$t("operate.title.more"),width:"700px"},on:{"on-confirm":e.invokeMoreCmd,close:e.closeMoreCmdModal,"on-cancel":e.closeMoreCmdModal},model:{value:e.moreCmdModal.show,callback:function(t){e.$set(e.moreCmdModal,"show",t)},expression:"moreCmdModal.show"}},[e.moreCmdModal.model?a("let-form",{ref:"moreCmdForm"},[a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"setloglevel"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.logLevel"))+" ")]),a("let-select",{attrs:{size:"small",disabled:"setloglevel"!==e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.setloglevel,callback:function(t){e.$set(e.moreCmdModal.model,"setloglevel",t)},expression:"moreCmdModal.model.setloglevel"}},e._l(e.logLevels,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"loadconfig"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.pushFile"))+" ")]),a("let-select",{attrs:{size:"small",placeholder:e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length?e.$t("pub.dlg.defaultValue"):e.$t("pub.dlg.noConfFile"),disabled:!(e.moreCmdModal.model.configs&&e.moreCmdModal.model.configs.length)||"loadconfig"!==e.moreCmdModal.model.selected,required:"loadconfig"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.loadconfig,callback:function(t){e.$set(e.moreCmdModal.model,"loadconfig",t)},expression:"moreCmdModal.model.loadconfig"}},e._l(e.moreCmdModal.model.configs,(function(t){return a("let-option",{key:t.filename,attrs:{value:t.filename}},[e._v(" "+e._s(t.filename)+" ")])})),1)],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"command"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.sendCommand"))+" ")]),a("let-input",{attrs:{size:"small",disabled:"command"!==e.moreCmdModal.model.selected,required:"command"===e.moreCmdModal.model.selected},model:{value:e.moreCmdModal.model.command,callback:function(t){e.$set(e.moreCmdModal.model,"command",t)},expression:"moreCmdModal.model.command"}})],1),a("let-form-item",{attrs:{itemWidth:"100%"}},[a("let-radio",{attrs:{label:"connection"},model:{value:e.moreCmdModal.model.selected,callback:function(t){e.$set(e.moreCmdModal.model,"selected",t)},expression:"moreCmdModal.model.selected"}},[e._v(" "+e._s(e.$t("serverList.servant.serviceLink"))+" ")])],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.detailModal.title,width:"700px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[a("div",{staticStyle:{padding:"20px 0 0"}},[e.detailModal.model&&e.detailModal.model.detail?a("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),a("div",{ref:"detailModalLoading",staticClass:"detail-loading"})])])],1)}),P=[],j=(a("99af"),a("7db0"),a("d81d"),a("96cf"),a("1da1")),z=a("5530"),R=a("dcab"),B=a("c1df"),E=a.n(B),J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.DetailModel.show?a("el-dialog",{attrs:{title:e.$t("operate.k8s"),visible:e.DetailModel.show,width:"1060px","before-close":e.closeDetailModel,top:"10px","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.DetailModel,"show",t)}}},[a("el-collapse",{attrs:{accordion:""},on:{change:e.HandleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"0"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.copyNode")))])]),a("k8s-manger",{attrs:{k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator,mode:"copyNode"}})],2),a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),a("k8s-manger",{attrs:{k8sModel:e.k8sModel,labelMatchArr:e.labelMatchArr,LabelMatchOperator:e.LabelMatchOperator,mode:"nodeSelect"}})],2),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.network")))])]),a("network-mapping",{attrs:{k8sModel:e.k8sModel}})],2),a("el-collapse-item",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.disk")))])]),a("disk-manger",{attrs:{k8sModel:e.k8sModel,mounts:e.mounts}})],2),a("el-collapse-item",{attrs:{name:"4"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.resource")))])]),a("resource-manger",{attrs:{sourceModel:e.sourceModel}})],2),a("el-collapse-item",{attrs:{name:"6"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.hpa")))])]),a("div",[a("hpa-manger",{attrs:{hpaModel:e.hpaModel,serverData:e.serverData,sourceModel:e.sourceModel,indicators:e.indicators}})],1)],2),a("el-collapse-item",{attrs:{name:"5"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.yaml")))])]),a("k8s-yaml-edit",{ref:"yamlEdit",on:{flushOthers:e.show}})],2)],1)],1):e._e()},H=[],F=(a("b64b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",[e.k8sModel?a("let-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},["copyNode"==e.mode?a("div",[a("let-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[a("let-input",{attrs:{size:"small",type:"number",min:0,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.k8sModel.Replicas,callback:function(t){e.$set(e.k8sModel,"Replicas",t)},expression:"k8sModel.Replicas"}})],1)],1):e._e(),"nodeSelect"==e.mode?a("div",[a("let-form-item",{attrs:{label:e.$t("deployService.form.affinity"),itemWidth:"45%"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.k8sModel.abilityAffinity,callback:function(t){e.$set(e.k8sModel,"abilityAffinity",t)},expression:"k8sModel.abilityAffinity"}},e._l(e.abilityAffinities,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),0==e.labelMatchArr.length?a("let-form-item",{attrs:{itemWidth:"45%"}},[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addItems(0,e.labelMatchArr)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1):e._e(),e._l(e.labelMatchArr,(function(t,o){return a("div",[a("let-form-item",{attrs:{label:e.$t("nodeList.table.th.label"),itemWidth:"30%"}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("nodeList.table.th.label"),"pattern-tip":e.$t("deployService.form.labelMatch.labelValid")},model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}})],1),a("let-form-item",{attrs:{label:"operator",itemWidth:"15%"}},[a("el-select",{attrs:{size:"small"},on:{change:e.changeLabelOperator},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"item.operator"}},e._l(e.LabelMatchOperator,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("nodes.label.value"),itemWidth:"40%"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{disabled:t.disableValue,multiple:"",filterable:"","allow-create":"","multiple-limit":63,"default-first-option":"",placeholder:e.$t("deployService.form.labelMatch.labelValue"),size:"small"},on:{change:function(t){e.addLabelValues(t,o)}},model:{value:t.values,callback:function(a){e.$set(t,"values",a)},expression:"item.values"}},e._l(t.values,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",circle:""},on:{click:function(t){return e.addItems(o,e.labelMatchArr)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-minus",size:"mini",circle:""},on:{click:function(t){return e.delItems(o,e.labelMatchArr)}}})],1)}))],2):e._e()]):e._e(),a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveK8sDetail}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)}),V=[],K=(a("d3b7"),a("498a"),a("ddb0"),a("b85c")),W={props:["k8sModel","labelMatchArr","LabelMatchOperator","mode"],name:"k8sManager",data:function(){return{serverId:"",K8SNodeList:[],K8SisCheckedAll:!1,abilityAffinities:["AppRequired","ServerRequired","AppOrServerPreferred","None"]}},methods:{changeKind:function(){this.$forceUpdate()},adapterServerK8S:function(e){var t=Object.assign({},e),a=this.labelMatchArr.map((function(e){return{key:e.key,operator:e.operator,values:e.values}}));return delete t.NodeSelector.nodeBind,t.NodeSelector=a,t},saveK8sDetail:function(){var e=this;if(this.$refs.k8sDetailForm.validate()&&this.validateLabels(this.k8sModel)){var t=this.$Loading.show(),a=this.adapterServerK8S(this.k8sModel);this.$ajax.postJSON("/k8s/api/server_k8s_update",{ServerId:a.ServerId,Replicas:a.Replicas,abilityAffinity:a.abilityAffinity,NodeSelector:a.NodeSelector}).then((function(a){t.hide(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(a){t.hide(),e.$message.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},validateLabels:function(e){var t=!0;if("LabelMatch"===e.NodeSelector.Kind){var a,o=Object(K["a"])(this.labelMatchArr);try{for(o.s();!(a=o.n()).done;){var r=a.value;if(""==r.key.trim()){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorKey"))),t=!1;break}if(-1=="Exists,DoesNotExist".indexOf(r.operator)&&0==r.values.length){this.$message.error("".concat(this.$t("deployService.form.labelMatch.errorValue"))),t=!1;break}}}catch(l){o.e(l)}finally{o.f()}return t}return!0},addLabelValues:function(e,t){var a=this,o=/^([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]?$/;this.labelMatchArr[t].values.forEach((function(e,t){o.test(e)||(a.labelMatchArr[t].values.splice(t,1),a.$message.error("".concat(a.$t("deployService.form.labelMatch.labelValueValid"))))}))},changeLabelOperator:function(e){var t=this;this.labelMatchArr.forEach((function(e){"Exists"==e.operator||"DoesNotExist"==e.operator?(t.$set(e,"disableValue",!0),t.$set(e,"values",[])):t.$set(e,"disableValue",!1)}))},addItems:function(e,t){t.length>=63?this.$message.error("".concat(this.$t("deployService.form.labelMatch.labelMax"))):(t.splice(e+1,0,{key:"",operator:"In",values:[]}),this.$forceUpdate())},delItems:function(e,t){t.splice(e,1),this.$forceUpdate()}}},Y=W,U=Object(w["a"])(Y,F,V,!1,null,null,null),Z=U.exports,G=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{attrs:{shadow:"never"}},[e.k8sModel?a("let-form",{ref:"k8sDetailForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("div",[a("div",[a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostIpc"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sModel.HostIpc,callback:function(t){e.$set(e.k8sModel,"HostIpc",t)},expression:"k8sModel.HostIpc"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostNetwork"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sModel.HostNetwork,callback:function(t){e.$set(e.k8sModel,"HostNetwork",t)},expression:"k8sModel.HostNetwork"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostPort"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sModel.showHostPort,callback:function(t){e.$set(e.k8sModel,"showHostPort",t)},expression:"k8sModel.showHostPort"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1)],1),e.k8sModel.showHostPort?a("div",{staticStyle:{"padding-right":"30px"}},[a("let-table",{attrs:{data:e.k8sModel.HostPortArr}},[a("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.obj,callback:function(a){e.$set(t.row,"obj",a)},expression:"props.row.obj"}})]}}],null,!1,910875067)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.hostPort")},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:1,max:65535,placeholder:"1-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.HostPort,callback:function(a){e.$set(t.row,"HostPort",a)},expression:"props.row.HostPort"}})]}}],null,!1,4126442684)}),a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-button",{staticClass:"port-button",attrs:{size:"small",theme:"primary"},on:{click:function(a){return e.generateHostPort(t.row)}}},[e._v(" "+e._s(e.$t("deployService.table.th.checkHostPort"))+" ")])]}}],null,!1,1424865976)})],1)],1):e._e()])]):e._e(),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.saveK8sDetail}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},Q=[],X={props:["k8sModel"],name:"k8sManager",data:function(){return{serverId:"",K8SisCheckedAll:!1}},mounted:function(){},methods:{changeKind:function(){this.$forceUpdate()},adapterServerK8S:function(e){var t=Object.assign({},e);return t.HostNetwork&&t.showHostPort?this.$message.error("".concat(this.$t("deployService.form.portOrNetWork"))):(t.showHostPort&&(t.HostPort=[],t.HostPortArr&&t.HostPortArr.forEach((function(e){t.HostPort.push({NameRef:e.obj,Port:Math.floor(e.HostPort)})}))),t)},saveK8sDetail:function(){var e=this;if(this.$refs.k8sDetailForm.validate()){var t=this.$Loading.show(),a=this.adapterServerK8S(this.k8sModel);this.$ajax.postJSON("/k8s/api/server_k8s_update_network",a).then((function(a){t.hide(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(a){t.hide(),e.$message.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},generateHostPort:function(e){var t=this;this.$ajax.getJSON("/k8s/api/check_host_port",{NodePort:e.HostPort}).then((function(e){var a="";e.forEach((function(e){-1==e.ret?a+="<p>".concat(e.node,":").concat(e.port,": can use</p>"):a+='<p style="color: #F56C6C">'.concat(e.node,":").concat(e.port,": cannot use</p>")})),t.$message.success({dangerouslyUseHTMLString:!0,message:a})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}}},ee=X,te=Object(w["a"])(ee,G,Q,!1,null,null,null),ae=te.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{attrs:{shadow:"never"}},[0==e.mounts.length?a("div",[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addDisk(0,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")])],1):e._e(),a("el-form",{ref:"disk",attrs:{"label-position":"top","label-width":"120px",size:"mini"}},[e._l(e.mounts,(function(t,o){return a("div",{key:o},[a("el-card",[a("el-row",{attrs:{gutter:22}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.diskName"),required:""}},[a("el-input",{model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"disk.name"}})],1)],1),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.path"),required:""}},[a("el-input",{model:{value:t.mountPath,callback:function(a){e.$set(t,"mountPath",a)},expression:"disk.mountPath"}})],1)],1)],1),a("el-row",{attrs:{gutter:22}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"uid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.uid,callback:function(a){e.$set(t.source.tLocalVolume,"uid",a)},expression:"disk.source.tLocalVolume.uid"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"gid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.gid,callback:function(a){e.$set(t.source.tLocalVolume,"gid",a)},expression:"disk.source.tLocalVolume.gid"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"mode",required:""}},[a("el-input",{attrs:{placeholder:"755"},model:{value:t.source.tLocalVolume.mode,callback:function(a){e.$set(t.source.tLocalVolume,"mode",a)},expression:"disk.source.tLocalVolume.mode"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{offset:18}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")]),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.delDisk(o,e.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.delDisk"))+" ")])],1)],1)],1)],1)})),a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],2)],1)},re=[],le={props:["k8sModel","mounts"],name:"disk",methods:{validate:function(){},save:function(){var e=this;if(this.validate){var t=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_k8s_update_disk",{ServerId:this.k8sModel.ServerId,mounts:this.mounts}).then((function(a){t.hide(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(a){t.hide(),e.$message.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}},addDisk:function(e,t){t.splice(e+1,0,{name:"",source:{tLocalVolume:{uid:"",gid:"",mode:""}},mountPath:""}),this.$forceUpdate()},delDisk:function(e,t){t.splice(e,1),this.$forceUpdate()}}},ie=le,se=Object(w["a"])(ie,oe,re,!1,null,"3186cc02",null),ne=se.exports,ce=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",[a("el-form",{attrs:{"label-width":"100px","label-position":"top",size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.sourceModel.limitCpu,callback:function(t){e.$set(e.sourceModel,"limitCpu",t)},expression:"sourceModel.limitCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.sourceModel.limitMem,callback:function(t){e.$set(e.sourceModel,"limitMem",t)},expression:"sourceModel.limitMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.sourceModel.requestCpu,callback:function(t){e.$set(e.sourceModel,"requestCpu",t)},expression:"sourceModel.requestCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.sourceModel.requestMem,callback:function(t){e.$set(e.sourceModel,"requestMem",t)},expression:"sourceModel.requestMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)],1)},de=[],pe={props:["sourceModel"],name:"resource",methods:{save:function(){var e=this;this.$ajax.postJSON("/k8s/api/server_k8s_update_resource",this.sourceModel).then((function(t){e.$message.success("".concat(e.$t("common.success")))})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))}}},ue=pe,me=Object(w["a"])(ue,ce,de,!1,null,"04ef7cb6",null),fe=me.exports,he=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",[a("el-form",{ref:"hpaForm",attrs:{"label-position":"top",size:"small",model:e.hpaModel}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.minReplicas"),prop:"minReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.minReplicas"),trigger:"blur"}]}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.minReplicas")},model:{value:e.hpaModel.minReplicas,callback:function(t){e.$set(e.hpaModel,"minReplicas",t)},expression:"hpaModel.minReplicas"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.maxReplicas"),prop:"maxReplicas",rules:[{required:!0,message:e.$t("deployService.hpa.tip.maxReplicas")}]}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:e.$t("deployService.hpa.tip.maxReplicas")},model:{value:e.hpaModel.maxReplicas,callback:function(t){e.$set(e.hpaModel,"maxReplicas",t)},expression:"hpaModel.maxReplicas"}})],1)],1)],1),a("el-divider",{attrs:{"content-position":"left"}},[e._v(e._s(e.$t("inf.benchmark.detail")))]),e._l(e.hpaModel.indicatorData,(function(t,o){return a("el-card",{key:o,staticStyle:{"margin-bottom":"5px"},attrs:{shadow:"hover"}},[a("el-alert",{attrs:{type:"warning",title:e.$t("deployService.hpa.tip.t2"),"show-icon":"",closable:!1}}),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.IndicatorName"),prop:"indicatorData."+o+".name",rules:[{required:!0,message:e.$t("deployService.hpa.tip.IndicatorName"),trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},on:{change:function(a){return e.changeType(o,t.name)}},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}},e._l(e.customTargets,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.targetType"),prop:"indicatorData."+o+".targetType",rules:[{required:!0,message:e.$t("deployService.hpa.tip.targetType"),trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},on:{change:function(t){return e.$forceUpdate()}},model:{value:t.targetType,callback:function(a){e.$set(t,"targetType",a)},expression:"item.targetType"}},e._l(e.getTargetTypes(t.name),(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.hpa.form.value"),prop:"indicatorData."+o+".value",rules:[{required:!0,message:e.$t("deployService.hpa.tip.value"),trigger:"change"}]}},[a("el-input",{attrs:{onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}},[a("template",{slot:"append"},[e._v(e._s(e._f("getValueUnit")(t.targetType)))])],2)],1)],1)],1),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.addItems(o,e.hpaModel.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.addIndicator"))+" ")])],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.delItems(o,e.hpaModel.indicatorData)}}},[e._v(" "+e._s(e.$t("deployService.hpa.form.delIndicator"))+" ")])],1)],1)],1)}))],2),a("el-row",{staticStyle:{"margin-top":"15px"},attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save")))])],1)],1)],1)},ve=[],ge=(a("4d63"),a("25f0"),a("466d"),{props:["hpaModel","serverData","sourceModel","indicators"],name:"hpa",data:function(){return{customTargets:["cpu","memory"]}},mounted:function(){},filters:{getValueUnit:function(e){return"averagevalue"==e.toLowerCase()?"MiB":"averageutilization"==e.toLowerCase()?"%":"MiB"}},methods:{save:function(){var e=this;this.sourceModel.limitCpu||this.sourceModel.limitMem||this.sourceModel.requestCpu||this.sourceModel.requestMem?this.$refs.hpaForm.validate((function(t){var a=Object.assign({},{ServerId:e.serverData.ServerId},e.hpaModel,{serverData:e.serverData});t?e.$ajax.postJSON("/k8s/api/create_hpa",a).then((function(t){e.$message.success("".concat(e.$t("common.success")))})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))})):e.$message.warning("".concat(e.$t("deployService.hpa.tip.checkForm")))})):this.$message.error("".concat(this.$t("deployService.resources.tip.resources")))},addItems:function(e,t){t.splice(e+1,0,{name:"cpu",targetType:"AverageUtilization",value:""}),this.$forceUpdate()},delItems:function(e,t){1!==t.length&&(t.splice(e,1),this.$forceUpdate())},changeType:function(e,t){var a=this.getMatchIndicators(t);this.$set(this.hpaModel.indicatorData[e],"targetType",a.target[0].type),this.$forceUpdate()},getMatchIndicators:function(e){var t,a,o=Object(K["a"])(this.indicators);try{for(o.s();!(a=o.n()).done;){var r=a.value;if("exact"==r.matchType&&r.match.toLowerCase()==e.toLowerCase()){t=r;break}if("regex"==r.matchType){var l=new RegExp(r.match);if(l.test(e)){t=r;break}}}}catch(i){o.e(i)}finally{o.f()}return t||this.$message.error("".concat(this.$t("deployService.hpa.tip.noIndicator"))),t},getTargetTypes:function(e){var t=this,a=this.getMatchIndicators(e),o={};return a.target.forEach((function(e){e.type.toLowerCase()=="AverageValue".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageValue")),e.type.toLowerCase()=="AverageUtilization".toLowerCase()&&(o[e.type]=t.$t("deployService.hpa.form.averageUtilization"))})),o}}}),be=ge,$e=(a("6c7a"),Object(w["a"])(be,he,ve,!1,null,"23ac87cc",null)),Se=$e.exports,ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{attrs:{shadow:"never"}},[a("div",{staticStyle:{border:"1px solid #595656","border-radius":"5px"}},[a("yaml-editor",{ref:"yamlEdit",staticStyle:{margin:"1px"},model:{value:e.yamlContent,callback:function(t){e.yamlContent=t},expression:"yamlContent"}})],1),a("div",{staticClass:"bottom"},[a("el-upload",{attrs:{"before-upload":e.uploadFile,"show-file-list":!1,action:"","list-type":"yml/yaml"}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[e._v(e._s(e.$t("deployService.batchDeploy.btn.uploadApplyConf"))+" ")])],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:e.save}},[e._v(e._s(e.$t("operate.save"))+" ")])],1)])},_e=[],ke=a("1c27"),we={name:"k8sYamlEdit",components:{YamlEditor:ke["a"]},data:function(){return{ServerId:"",plural:"",yamlContent:""}},methods:{refresh:function(){this.$refs.yamlEdit.refresh()},readonly:function(){this.$refs.yamlEdit.readonly()},show:function(e,t){var a=this;this.ServerId=e,this.plural=t,this.$ajax.getJSON("/k8s/api/get_object",{plural:t,ServerId:e}).then((function(e){a.yamlContent=e})).catch((function(e){a.$message.error("".concat(a.$t("common.error"),": ").concat(e.err_msg||e.message))}))},save:function(){var e=this;this.$ajax.postJSON("/k8s/api/update_object",{plural:this.plural,ServerId:this.ServerId,yamlContent:this.yamlContent}).then((function(t){e.$emit("flushOthers",e.ServerId),e.$message.success("".concat(e.$t("common.success"))),e.$emit("successFun")})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))},uploadFile:function(e){var t=e.name;if(-1==t.lastIndexOf("."))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var a=".yml|.yaml|",o=t.substring(t.lastIndexOf(".")).toLowerCase();if(-1==a.indexOf(o+"|"))return this.$message.error("".concat(this.$t("deployService.batchDeploy.errFile"))),!1;var r=new FileReader;r.readAsText(e,"UTF-8");var l=this;r.onload=function(e){e.target.result;l.$nextTick((function(){l.yamlContent=r.result}))}}}},Me=we,xe=(a("ca6f"),Object(w["a"])(Me,ye,_e,!1,null,"697eb848",null)),Ne=xe.exports,Ce={name:"index",components:{k8sManger:Z,diskManger:ne,networkMapping:ae,resourceManger:fe,K8sYamlEdit:Ne,hpaManger:Se},data:function(){return{DetailModel:{show:!1},activeName:"0",k8sModel:{},labelMatchArr:[],LabelMatchOperator:[],sourceModel:{},serverData:{},hpaModel:{minReplicas:"",maxReplicas:"",indicatorData:[]},indicators:[],yamlContent:"",mounts:[],serverId:""}},methods:{HandleClick:function(e){var t=this;"5"==e&&this.$nextTick((function(){t.$refs.yamlEdit.show(t.serverId,"tservers"),t.$refs.yamlEdit.refresh()}))},closeDetailModel:function(){this.DetailModel.show=!1,this.k8sModel={},this.mounts=[],this.labelMatchArr=[],this.sourceModel={},this.serverData={},this.hpaModel={minReplicas:"",maxReplicas:"",indicatorData:[]}},show:function(e){var t=this;this.serverId=e,this.DetailModel.show=!0,this.getDefaultValue(),this.getServerInfo(e),this.getHpaInfo(e),this.$nextTick((function(){t.$refs.yamlEdit.show(e,"tservers")}))},getDefaultValue:function(){var e=this,t=this.LabelMatchOperator,a=this.indicators;this.$ajax.getJSON("/k8s/api/default",{}).then((function(o){e.defaultObj=o.ServerServantElem,o.LabelMatchOperator&&(t=o.LabelMatchOperator),o.indicators&&(a=o.indicators),e.LabelMatchOperator=t,e.indicators=a}))},getServerInfo:function(e){var t=this;this.$ajax.getJSON("/k8s/api/server_k8s_select",{ServerId:e}).then((function(a){if(a=a.Data[0],t.serverData=a,t.sourceModel.ServerId=e,a.resources&&Object.keys(a.resources).length>0&&(a.resources.limits&&(a.resources.limits.cpu&&t.$set(t.sourceModel,"limitCpu",a.resources.limits.cpu.replace(/m/g,"")),a.resources.limits.memory&&t.$set(t.sourceModel,"limitMem",a.resources.limits.memory.replace(/m/g,""))),a.resources.requests&&(a.resources.requests.cpu&&t.$set(t.sourceModel,"requestCpu",a.resources.requests.cpu.replace(/m/g,"")),a.resources.requests.memory&&t.$set(t.sourceModel,"requestMem",a.resources.requests.memory.replace(/m/g,"")))),a.showHostPort=!1,a&&a){var o=[];a.HostPort&&Object.keys(a.HostPort).length>0&&(a.showHostPort=!0,a.HostPort.forEach((function(e){o.push({obj:e.nameRef,HostPort:Math.floor(e.port)})})),a.HostPortArr=o),0===o.length&&t.$ajax.getJSON("/k8s/api/server_adapter_select",{ServerId:e}).then((function(e){e&&e.Data&&(e.Data.forEach((function(e){o.push({obj:e.Name,HostPort:0})})),a.HostPortArr=o)}))}a.NodeSelector=a.NodeSelector,t.labelMatchArr=a.NodeSelector,t.labelMatchArr.forEach((function(e){-1!="Exists,DoesNotExist".indexOf(e.operator)&&(e.disableValue=!0)})),t.k8sModel=a,t.mounts=a.mounts.filter((function(e){return e.source.hasOwnProperty("tLocalVolume")}))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))},getHpaInfo:function(e){var t=this;this.$ajax.getJSON("/k8s/api/get_hpa",{serverId:e.toLowerCase().replace(".","-")}).then((function(e){if(console.log("res:"+JSON.stringify(e,null,4)),e&&Object.keys(e).length>1){var a=e.body.spec;t.$set(t.hpaModel,"minReplicas",a.minReplicas),t.$set(t.hpaModel,"maxReplicas",a.maxReplicas),a.metrics.forEach((function(e,a){var o={};"Resource"==e.type&&(o.name=e.resource.name,"averagevalue"==e.resource.target.type.toLowerCase()?(o.targetType="AverageValue",o.value=e.resource.target.averageValue.replace(/m/g,"")):(o.targetType="AverageUtilization",o.value=e.resource.target.averageUtilization)),"Pods"==e.type&&(o.name=e.pods.metric.name,o.targetType=e.pods.target.type,o.value=e.pods.target.averageValue.replace(/m/g,"")),"object"==e.type.toLowerCase()&&(o.name=e.object.metric.name,"averagevalue"==e.object.target.type.toLowerCase()&&(o.targetType="AverageValue",o.value=e.object.target.averageValue.replace(/m/g,""))),t.$set(t.hpaModel.indicatorData,a,o)})),a.metrics&&0==a.metrics.length&&t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageValue",value:""})}else t.hpaModel.indicatorData.push({name:"cpu",targetType:"AverageUtilization",value:""})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}}},Te=Ce,Le=Object(w["a"])(Te,J,H,!1,null,null,null),Ae=Le.exports,Ie={name:"ServerManage",components:{wrapper:R["a"],k8sManager:Ae},data:function(){return{serverData:{level:5,application:"",server_name:"",server_type:""},isreloadlist:!0,reloadTask:null,reloadlist:null,serverList:[],serverNotifyList:[],notifyPagination:{page:1,size:10,total:1},defaultObj:{},configModal:{show:!1,model:null},servantAddModal:{show:!1,isNew:!0,model:null},servantModal:{show:!1,model:null,currentServer:null},servantDetailModal:{show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},logLevels:["NONE","DEBUG","TARS","INFO","WARN","ERROR"],moreCmdModal:{show:!1,model:null,currentServer:null},isCheckedAll:!1,checkedList:[]}},props:["treeid"],computed:{isApplication:function(){return-1==this.treeid.indexOf(".")},showOthers:function(){return 5===this.serverData.level},isEndpointValid:function(){return!(!this.servantDetailModal.model||!this.servantDetailModal.model.endpoint)&&this.checkServantEndpoint(this.servantDetailModal.model.endpoint)},isNormal:function(){return"normal"===this.serverData.server_type}},methods:{gotoLog:function(e){var t="/logview.html?History=false&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getServerId:function(){return this.treeid},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},reloadServerList:function(){var e=this;if(this.$parent.BTabs.length>0){var t=this.$parent.BTabs[0].path,a=t.substring(t.lastIndexOf("/")+1);"manage"!==a&&e.reloadTask||(e.reloadTask=setTimeout((function(){e.isreloadlist&&"#/server"==location.hash&&e.$parent.treeid==e.getServerId()&&(e.getServerList(),e.getServerNotifyList()),e.reloadServerList()}),3e3))}},startServerList:function(){this.isreloadlist=!0},stopServerList:function(){this.isreloadlist=!1},getServerList:function(){var e=this;this.$ajax.getJSON("/k8s/api/pod_list",{ServerId:this.getServerId()}).then((function(t){e.serverList=[],t.hasOwnProperty("Data")&&(t.Data.forEach((function(e){e.isChecked=!1,e.CreateTime=E()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.StartTime=E()(e.StartTime).format("YYYY-MM-DD HH:mm:ss")})),e.serverList=t.Data)})).catch((function(e){}))},getServerNotifyList:function(){var e=this;this.showOthers&&this.$ajax.getJSON("/k8s/api/server_notify_list",{ServerId:this.getServerId(),size:this.notifyPagination.size,page:this.notifyPagination.page}).then((function(t){e.notifyPagination.total=Math.ceil(t.total.value/e.notifyPagination.size),e.serverNotifyList=t.hits||[],e.serverNotifyList.forEach((function(e){e._source.timeStr=E()(e._source.notifyTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(e){}))},statusStyle:function(e){return e=e||"","restart"==e||-1!=e.indexOf("[succ]")?"color: green":"stop"==e||-1!=e.indexOf("[alarm]")||-1!=e.indexOf("error")||-1!=e.indexOf("ERROR")?"color: red":""},notifyGotoPage:function(e){this.notifyPagination.page=e,this.getServerNotifyList()},getServerConfig:function(e){var t=this;this.stopServerList();var a=this.$loading.show({target:this.$refs.configFormLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{ServerId:e}).then((function(e){a.hide(),t.configModal.model?t.configModal.model=Object.assign({},t.configModal.model,e.Data[0]):(e.templates=[],t.configModal.model=e.Data[0]),t.startServerList()})).catch((function(e){a.hide(),t.closeConfigModal(),t.startServerList(),t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},configServer:function(){var e=this;this.stopServerList(),this.configModal.show=!0,this.$ajax.getJSON("/k8s/api/template_select").then((function(t){e.configModal.model?e.configModal.model.templates=t.Data:e.configModal.model={templates:t.Data},e.getServerConfig(e.getServerId()),e.startServerList()})).catch((function(t){e.startServerList(),e.$tip.error("".concat(e.$t("serverList.restart.failed"),": ").concat(t.err_msg||t.message))}))},saveConfig:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_option_update",Object(z["a"])({isBak:this.configModal.model.bak_flag},this.configModal.model)).then((function(a){t.hide(),e.closeConfigModal(),e.$tip.success(e.$t("common.success"))}))}},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1,this.configModal.model=null,this.startServerList()},startServer:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,l=a[0].ServerName,e.$confirm(e.$t("serverList.startService.msg.startService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StartServer",podIp:o,serverApp:r,serverName:l}).then((function(t){e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},restartServer:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,l=a[0].ServerName,e.$confirm(e.$t("serverList.restartService.msg.restartService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"RestartServer",podIp:o,serverApp:r,serverName:l}).then((function(t){e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},stopServer:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o,r,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.checkLauncherType();case 2:if(!t.sent){t.next=5;break}return e.$tip.warning(e.$t("pub.dlg.foregroundTip")),t.abrupt("return");case 5:if(e.stopServerList(),a=e.checkedList.filter((function(e){return e.isChecked})),!(a.length<=0)){t.next=10;break}return e.$tip.warning(e.$t("pub.dlg.a")),t.abrupt("return");case 10:o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,l=a[0].ServerName,e.$confirm(e.$t("serverList.stopService.msg.stopService"),e.$t("common.alert")).then((function(){e.$ajax.getJSON("/k8s/api/send_command",{command:"StopServer",podIp:o,serverApp:r,serverName:l}).then((function(t){e.$tip.success(e.$t("common.success")),e.startServerList(),e.getServerNotifyList()})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.err_msg||t.message))}))})).catch((function(){e.startServerList()}));case 14:case"end":return t.stop()}}),t)})))()},deletePod:function(e){var t=this;this.$confirm(this.$t("serverList.tips.deletePod"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_pod",{PodName:e.PodName}).then((function(e){t.$tip.success("".concat(t.$t("common.success"))),t.getServerList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},viewEvent:function(e){var t=Object.assign({},e),a={application:t.ServerApp,serverName:t.ServerName};this.$router.push({path:"/operation/event",query:a})},viewTemplate:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_template",{ServerId:this.getServerId()}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewTemplate"),e.detailModal.model={detail:a},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},privateTemplateManage:function(){var e=this,t=this.$loading.show({target:this.$refs.servantModalLoading});this.$ajax.getJSON("/k8s/api/server_option_select",{ServerId:this.getServerId()}).then((function(a){t.hide(),e.detailModal.title=e.$t("cfg.title.viewProfileTemplate"),e.detailModal.model={detail:a&&a.Data[0].ServerProfile||""},e.detailModal.show=!0})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))},manageServant:function(e){var t=this;this.stopServerList(),this.servantModal.show=!0,this.$ajax.getJSON("/k8s/api/server_adapter_select",{ServerId:this.getServerId()}).then((function(a){t.servantModal.model=a.Data,t.servantModal.currentServer=e})).catch((function(e){t.$tip.error("".concat(t.$t("serverList.restart.failed"),": ").concat(e.err_msg||e.message))}))},manageK8S:function(){this.$refs.k8s.show(this.getServerId())},closeServantModal:function(){this.servantModal.show=!1,this.servantModal.model=null,this.servantModal.currentServer=null,this.startServerList()},addAdapter:function(e){this.servantAddModal.model.ServerServant.push(Object.assign({},e,{Port:this.getPort(e.Port)}))},getPort:function(e){var t=this.defaultObj,a=this.servantModal,o=0;if(e)o=e;else if(o=Math.floor(t.Port),a.model&&a.model.length>0){var r=a.model.sort((function(e,t){return t.Port-e.Port}))||[];o=Math.floor(r[0].Port)}return o++,19385===o&&o++,o},configServant:function(e){var t=this.defaultObj,a={ServerId:this.getServerId(),ServerServant:[{Name:"",Port:this.getPort()||0,Threads:t.Threads||0,Connections:t.Connections||0,Capacity:t.Capacity||0,Timeout:t.Timeout||0,IsTcp:t.IsTcp,IsTars:t.IsTars}]};if(e){this.servantDetailModal.model=a,this.servantDetailModal.isNew=!0;var o=this.servantModal.model.find((function(t){return t.AdapterId===e}));this.servantDetailModal.model={AdapterId:o.AdapterId,ServerServant:[o]},this.servantDetailModal.isNew=!1,this.servantDetailModal.show=!0}else this.servantAddModal.model=a,this.servantAddModal.isNew=!0,this.servantAddModal.show=!0},closeServantAddModal:function(){this.$refs.servantAddForm&&this.$refs.servantAddForm.resetValid(),this.servantAddModal.show=!1,this.servantAddModal.model=null},closeServantDetailModal:function(){this.$refs.servantDetailForm&&this.$refs.servantDetailForm.resetValid(),this.servantDetailModal.show=!1,this.servantDetailModal.model=null},checkServantEndpoint:function(e){var t=e.split(/\s-/),a=/^tcp|udp$/i,o=/^h\s(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/i,r=/^t\s([1-9]|[1-9]\d+)$/i,l=/^p\s\d{4,5}$/i,i=!0;if(a.test(t[0])){for(var s=0,n=1;n<t.length;n++)if(o&&o.test(t[n])&&(s++,this.servantDetailModal.model.node_name=t[n].split(/\s/)[1],o=null),r&&r.test(t[n])&&(s++,r=null),l&&l.test(t[n])){var c=t[n].substring(2);c<0||c>65535||s++,l=null}i=3===s}else i=!1;return i},saveServantAdd:function(){var e=this;if(this.$refs.servantAddForm.validate()){var t=this.$Loading.show();if(this.servantAddModal.isNew){var a=Object.assign({},this.servantAddModal.model);if(a.ServerServant){var o={};a.ServerServant.forEach((function(e){o[e.Name]=e})),a.ServerServant=o}this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.manageServant(),e.$tip.success(e.$t("common.success")),e.closeServantAddModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else t.hide()}},saveServantDetail:function(){var e=this;if(this.$refs.servantDetailForm.validate()){var t=this.$Loading.show();if(this.servantDetailModal.isNew){var a=this.servantDetailModal.model;this.$ajax.postJSON("/k8s/api/server_adapter_create",a).then((function(a){t.hide(),e.servantModal.model.unshift(a),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}else{this.servantDetailModal.model.servant=this.servantDetailModal.model.application+"."+this.servantDetailModal.model.server_name+"."+this.servantDetailModal.model.obj_name;var o=Object.assign({},this.servantDetailModal.model);this.$ajax.postJSON("/k8s/api/server_adapter_update",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.closeServantDetailModal()})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}}},deleteServant:function(e){var t=this;this.$confirm(this.$t("serverList.servant.a"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/server_adapter_delete",{AdapterId:e}).then((function(o){a.hide(),t.servantModal.model=t.servantModal.model.filter((function(t){return t.AdapterId!==e})),t.$tip.success(t.$t("common.success"))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))}))}))},closeDetailModal:function(){this.detailModal.show=!1,this.detailModal.model=null},showMoreCmd:function(e){var t=this;this.stopServerList();var a=this.checkedList.filter((function(e){return e.isChecked}));if(a.length<=0)this.$tip.warning(this.$t("pub.dlg.a"));else{var o=a.map((function(e){return e.PodIp})),r=a[0].ServerApp,l=a[0].ServerName;this.moreCmdModal.model={podIp:o,serverApp:r,serverName:l,selected:"setloglevel",setloglevel:"NONE",loadconfig:"",command:"",configs:null},this.moreCmdModal.unwatch=this.$watch("moreCmdModal.model.selected",(function(){t.$refs.moreCmdForm&&t.$refs.moreCmdForm.resetValid()})),this.moreCmdModal.show=!0,this.moreCmdModal.currentServer=e}},sendCommand:function(e,t,a,o,r){var l=this,i=this.$Loading.show();this.$ajax.getJSON("/k8s/api/send_command",{serverApp:e,serverName:t,podIp:a,command:o}).then((function(e){i.hide();var t=e[0].err_msg.replace(/\n/g,"<br>");if(0!==e[0].ret_code)throw new Error(t);var a={title:l.$t("common.success"),message:t};r&&(a.duration=0),l.$tip.success(a),l.getServerNotifyList()})).catch((function(e){i.hide(),l.$tip.error({title:l.$t("common.error"),message:e.err_msg||e.message})}))},invokeMoreCmd:function(){var e=this.moreCmdModal.model;this.moreCmdModal.currentServer;"setloglevel"===e.selected?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.setloglevel ".concat(e.setloglevel)):"loadconfig"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.loadconfig ".concat(e.loadconfig)):"command"===e.selected&&this.$refs.moreCmdForm.validate()?this.sendCommand(e.serverApp,e.serverName,e.podIp,e.command):"connection"===e.selected&&this.sendCommand(e.serverApp,e.serverName,e.podIp,"tars.connection",!0)},closeMoreCmdModal:function(){this.$refs.moreCmdForm&&this.$refs.moreCmdForm.resetValid(),this.moreCmdModal.unwatch&&this.moreCmdModal.unwatch(),this.checkedList=[],this.moreCmdModal.show=!1,this.moreCmdModal.model=null,this.startServerList()},checkChange:function(e){this.stopServerList();var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.PodId===e.PodId&&(o=!0)})),o||t.push(e)}else{var r=!1,l=-1;t.forEach((function(t,a){t.PodId===e.PodId&&(r=!0,l=a)})),r&&t.splice(l,1)}},checkLauncherType:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{ServerId:e.getServerId()});case 2:return a=t.sent,o=a.Data[0].launcherType,t.abrupt("return","foreground"==o);case 5:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.serverData=e.$parent.getServerData(),e.serverData.server_type){t.next=12;break}return t.prev=2,t.next=5,e.$ajax.getJSON("/k8s/api/server_option_select",{ServerId:e.treeid});case 5:a=t.sent,e.$set(e.serverData,"server_type",a.Data[0].serverType),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](2),e.$set(e.serverData,"server_type","normal");case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))()},mounted:function(){this.getServerList(),this.reloadServerList(),this.startServerList(),this.getServerNotifyList()},beforeMount:function(){this.startServerList()},beforeDestroy:function(){this.stopServerList()},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]},checkedList:function(){var e=this.checkedList;e.length>0?this.stopServerList():this.startServerList()}}},De=Ie,Oe=(a("cb44"),Object(w["a"])(De,q,P,!1,null,null,null)),qe=Oe.exports,Pe=a("67ac"),je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_publish"},[e.buildList.length>0?a("div",[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.buildList"))+" "),a("i",{staticClass:"icon iconfont el-icon-third-shuaxin",staticStyle:{"font-family":"iconfont  !important",cursor:"pointer"},on:{click:function(t){return e.getBuildList()}}})])]),a("div",[a("let-table",{ref:"table",attrs:{data:e.buildList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.buildId"),prop:"Id"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.phase"),prop:"Phase"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.message"),prop:"Message"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.deleteBuild(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}],null,!1,4039036093)})],1)],1)]):e._e(),a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(" "+e._s(this.$t("serverList.title.patchList"))+" "),a("i",{staticClass:"icon iconfont el-icon-third-shuaxin",staticStyle:{"font-family":"iconfont  !important",cursor:"pointer"},on:{click:function(t){return e.getImageList()}}})])]),a("div",[a("let-button",{staticStyle:{float:"left","margin-right":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.showUploadModal}},[e._v(e._s(e.$t("pub.dlg.upload")))]),a("let-button",{staticStyle:{float:"left"},attrs:{theme:"primary",size:"small"},on:{click:e.showAddImageModal}},[e._v(e._s(e.$t("pub.dlg.image")))]),a("let-button",{staticStyle:{float:"right"},attrs:{theme:"primary",size:"small"},on:{click:e.openPublishVersionModal}},[e._v(e._s(e.$t("pub.btn.pubk8s")))])],1),a("br"),a("div",[a("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.id"),prop:"Id"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.image"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.secret"),prop:"Secret"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:e.getState(t.row.Enabled)})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createPerson"),prop:"CreatePerson"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.removeReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"},attrs:{slot:"operations"},slot:"operations"}),a("let-modal",{attrs:{title:e.$t("index.rightView.tab.patch"),width:"880px",footShow:!1},on:{close:e.closePublishModal,"on-confirm":e.savePublishServer},model:{value:e.publishModal.show,callback:function(t){e.$set(e.publishModal,"show",t)},expression:"publishModal.show"}},[e.publishModal.model?a("let-form",{ref:"publishForm",attrs:{itemWidth:"100%"}},[[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releaseVersion"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.ab")},model:{value:e.publishModal.model.Id,callback:function(t){e.$set(e.publishModal.model,"Id",t)},expression:"publishModal.model.Id"}},e._l(e.publishModal.model.patchList,(function(t){return a("let-option",{key:t.Id,attrs:{value:t.Id}},[""+t.Enabled=="true"?a("span",{domProps:{innerHTML:e._s(e.imgCur)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),a("span",[e._v(e._s(t.Id)+" | "+e._s(t.CreateTime)+" | "+e._s(t.Image))])])})),1)],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.nodeImage"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("pub.dlg.nodeImageTip")},model:{value:e.publishModal.model.NodeImage,callback:function(t){e.$set(e.publishModal.model,"NodeImage",t)},expression:"publishModal.model.NodeImage"}},e._l(e.publishModal.model.nodeList,(function(t){return a("let-option",{key:t.Image,attrs:{value:t.Image}},[t.isDefaultTafNode?a("span",{domProps:{innerHTML:e._s(e.imgNew)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),t.isCurrTafNode?a("span",{domProps:{innerHTML:e._s(e.imgCur)}}):a("span",{domProps:{innerHTML:e._s(e.imgSpace)}}),a("span",[e._v(e._s(t.Id)+" | "+e._s(t.CreateTime)+" | "+e._s(t.Image))])])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.replicas")}},[a("let-input",{attrs:{size:"small",type:"number",min:1,placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.table.tips.empty"),"pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.publishModal.model.Replicas,callback:function(t){e.$set(e.publishModal.model,"Replicas",t)},expression:"publishModal.model.Replicas"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{model:{value:e.publishModal.model.EnableMark,callback:function(t){e.$set(e.publishModal.model,"EnableMark",t)},expression:"publishModal.model.EnableMark"}}),a("let-button",{staticClass:"mt20",attrs:{theme:"primary",size:"small"},on:{click:e.savePublishServer}},[e._v(e._s(e.$t("common.patch")))])],1)]],2):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.upload"),width:"880px",footShow:!1},on:{"on-cancel":e.closeUploadModal},model:{value:e.uploadModal.show,callback:function(t){e.$set(e.uploadModal,"show",t)},expression:"uploadModal.show"}},[e.uploadModal.model?a("let-form",{ref:"uploadForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.uploadPatchPackage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.releasePkg"),itemWidth:"400px"}},[a("let-uploader",{attrs:{placeholder:e.$t("pub.dlg.defaultValue")},on:{upload:e.uploadFile}},[e._v(e._s(e.$t("common.submit"))+" ")]),e.uploadModal.model.file?a("span",[e._v(e._s(e.uploadModal.model.file.name))]):e._e()],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceType"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.serviceTypeTips")},on:{change:e.changeServerType},model:{value:e.uploadModal.model.ServerType,callback:function(t){e.$set(e.uploadModal.model,"ServerType",t)},expression:"uploadModal.model.ServerType"}},e._l(e.serverType,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.baseImage"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageTips")},on:{change:e.changeBaseImage},model:{value:e.uploadModal.model.BaseImage,callback:function(t){e.$set(e.uploadModal.model,"BaseImage",t)},expression:"uploadModal.model.BaseImage"}},e._l(e.baseImage,(function(t){return a("let-option",{key:t.Name,attrs:{value:t.Name}},[e._v(e._s(t.Name+"("+t.Mark+")"))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.baseImageRelease"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.baseImageReleaseTips")},model:{value:e.uploadModal.model.BaseImageRelease,callback:function(t){e.$set(e.uploadModal.model,"BaseImageRelease",t)},expression:"uploadModal.model.BaseImageRelease"}},e._l(e.baseImageRelease,(function(t){return a("let-option",{key:t.Image,attrs:{value:t.Image}},[e._v(e._s(t.Image+"("+(t.Mark||t.Id)+")"))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serverTag")}},[a("let-input",{attrs:{type:"text",size:"small",placeholder:e.$t("deployService.form.serverTagTip")},model:{value:e.uploadModal.model.ServerTag,callback:function(t){e.$set(e.uploadModal.model,"ServerTag","string"===typeof t?t.trim():t)},expression:"uploadModal.model.ServerTag"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.servant.comment")}},[a("let-input",{attrs:{type:"textarea",rows:3},model:{value:e.uploadModal.model.comment,callback:function(t){e.$set(e.uploadModal.model,"comment",t)},expression:"uploadModal.model.comment"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("serverList.servant.upload")))])],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("pub.dlg.image"),width:"600px",footShow:!1},on:{"on-cancel":e.closeAddImageModal},model:{value:e.addImageModal.show,callback:function(t){e.$set(e.addImageModal,"show",t)},expression:"addImageModal.show"}},[e.addImageModal.model?a("let-form",{ref:"addImageForm",attrs:{itemWidth:"100%"},nativeOn:{submit:function(t){return t.preventDefault(),e.addImage(t)}}},[a("let-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),required:""}},[a("let-input",{attrs:{type:"text",size:"small",required:""},model:{value:e.addImageModal.model.Image,callback:function(t){e.$set(e.addImageModal.model,"Image",t)},expression:"addImageModal.model.Image"}})],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.secret"),required:""}},[a("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Secret,callback:function(t){e.$set(e.addImageModal.model,"Secret",t)},expression:"addImageModal.model.Secret"}})],1),a("let-form-item",{attrs:{label:e.$t("pub.dlg.mark")}},[a("let-input",{attrs:{type:"text",size:"small"},model:{value:e.addImageModal.model.Mark,callback:function(t){e.$set(e.addImageModal.model,"Mark",t)},expression:"addImageModal.model.Mark"}})],1),a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("pub.dlg.add")))])],1):e._e()],1)],1)])},ze=[],Re=a("2699"),Be={name:"ServerPublish",data:function(){return{imgNew:'<img class="logo" src="/static/img/new.gif">',imgCur:'<img class="logo" src="/static/img/current.gif">',imgSpace:'<img class="logo" src="/static/img/space.png">',buildList:[],serverList:[],publishModal:{show:!1,model:{patchList:[],nodeList:[]}},reloadTask:null,serverK8S:{},serverType:[],baseImage:[],baseImageRelease:[],uploadModal:{show:!1,model:null},addImageModal:{show:!1,model:null}}},props:["treeid"],methods:{getServerId:function(){return this.treeid},getServerType:function(){return this.$ajax.getJSON("/k8s/api/server_list",{ServerId:this.getServerId()})},getDefault:function(){var e=this;this.$ajax.getJSON("/k8s/api/default").then((function(t){e.serverK8S=t.ServerK8S||{},e.serverType=t.ServerTypeOptional||[]}))},changeServerType:function(){var e=this;this.$ajax.getJSON("/k8s/api/base_image_list",{ServerType:this.uploadModal.model.ServerType}).then((function(t){e.baseImage=t.Data||[],e.uploadModal.model.BaseImage=e.baseImage[0].Name}))},changeBaseImage:function(){var e=this;this.baseImageRelease=this.baseImage.filter((function(t){return t.Name==e.uploadModal.model.BaseImage}))[0].Release,this.$set(this.uploadModal.model,"BaseImageRelease",this.baseImageRelease[this.baseImageRelease.length-1].Image)},getState:function(e){var t="";switch("".concat(e)){case"true":t="status-active";break}return t},formatDate:function(e,t){return Object(Re["b"])(e,"YYYY-MM-DD HH:mm:ss")},reloadBuildList:function(){var e=this,t=this.$parent.BTabs[0].path,a=t.substring(t.lastIndexOf("/")+1);"publish"!==a&&e.reloadTask||(e.reloadTask=setTimeout((function(){e.$parent.treeid==e.getServerId()&&e.getBuildList(),e.reloadBuildList()}),3e3))},getBuildList:function(){var e=this;this.$ajax.getJSON("/k8s/api/build_list",{ServerId:this.getServerId()}).then((function(t){t.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime)})),e.buildList=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},deleteBuild:function(e){var t=this;this.$confirm(this.$t("deployService.form.delete"),this.$t("common.alert")).then((function(){t.$ajax.getJSON("/k8s/api/delete_build",{ImageName:e.ImageName}).then((function(){t.getBuildList(),t.getImageList()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}))},getImageList:function(){var e=this;this.$ajax.getJSON("/k8s/api/patch_list",{ServerId:this.getServerId()}).then((function(t){e.getNowImages().then((function(a){var o=t.Data||[];o.forEach((function(t){t.Id==a.Id&&(t.Enabled=!0),t.CreateTime=e.formatDate(t.CreateTime)})),e.serverList=o})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))})).catch((function(t){e.$confirm(t.err_msg||t.message||e.$t("serverList.table.msg.fail")).then((function(){e.getImageList()}))}))},openPublishVersionModal:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o,r,l,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.getServerId(),e.publishModal.model={ServerId:a,Replicas:e.serverK8S.Replicas||1,show:!0},t.next=4,e.getPatchList(a);case 4:return o=t.sent,t.next=7,e.getK8SData();case 7:return r=t.sent,t.next=10,e.getNowImages();case 10:return l=t.sent,t.next=13,e.getTafNodes();case 13:return i=t.sent,t.next=16,e.getNodeImage();case 16:s=t.sent,e.publishModal.model.Replicas=r.Data[0].Replicas||e.serverK8S.Replicas||1,o.Data.forEach((function(t){t.CreateTime=e.formatDate(t.CreateTime),t.Image==l.Image&&(t.Enabled=!0)})),i.Data.forEach((function(e){e.Image==l.NodeImage&&(e.isCurrTafNode=!0),e.Image==s&&(e.isDefaultTafNode=!0)})),e.publishModal.model.patchList=o.Data,e.publishModal.model.nodeList=i.Data,e.publishModal.show=!0;case 23:case"end":return t.stop()}}),t)})))()},getPatchList:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/k8s/api/patch_list",{ServerId:e});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()},getNowImages:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_now_image",{ServerId:e.getServerId()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getK8SData:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/server_k8s_select",{ServerId:e.getServerId()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getTafNodes:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/image_node_select");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},getNodeImage:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:return a=t.sent,o=a.filter((function(e){return"nodeImage.image"===e.column})),t.abrupt("return",1==o.length?o[0].value:"");case 5:case"end":return t.stop()}}),t)})))()},closePublishModal:function(){this.publishModal.show=!1,this.publishModal.modal=null,this.$refs.publishForm.resetValid()},savePublishServer:function(){var e=this,t=this.$Loading.show();this.$refs.publishForm.validate()&&(t.hide(),this.$ajax.postJSON("/k8s/api/patch_publish",{ServerId:this.publishModal.model.ServerId,Id:this.publishModal.model.Id,Replicas:this.publishModal.model.Replicas,EnableMark:this.publishModal.model.EnableMark,NodeImage:this.publishModal.model.NodeImage}).then((function(a){t.hide(),e.getImageList(),e.closePublishModal(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))})))},updateServerInfo:function(e){this.$ajax.postJSON("/k8s/api/server_update",{ServerId:e.ServerId,ServerType:e.ServerType,ServerMark:e.ServerMark})},showUploadModal:function(){var e=this;this.getServerType().then((function(t){var a=e.getServerId();e.uploadModal.model={ServerId:a,file:null,ServerMark:"",ServerType:t.Data[0].ServerType},e.uploadModal.show=!0}))},showAddImageModal:function(){var e=this.getServerId();this.addImageModal.model={ServerId:e,Id:"",Image:"",Secret:"tars-image-secret",Mark:""},this.addImageModal.show=!0},closeAddImageModal:function(){this.addImageModal.show=!1,this.addImageModal.model=null,this.$refs.addImageForm.resetValid()},closeUploadModal:function(){this.uploadModal.show=!1,this.uploadModal.model=null,this.$refs.uploadForm.resetValid()},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){t.getServerId();var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.getImageList()})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},uploadFile:function(e){this.uploadModal.model.file=e},uploadPatchPackage:function(){var e=this,t=this.getServerId();if(this.$refs.uploadForm.validate()){var a=this.$Loading.show(),o=new FormData,r="",l=this.baseImageRelease.filter((function(t){return t.Image==e.uploadModal.model.BaseImageRelease}));1==l.length&&(r=l[0].Secret||""),o.append("ServerId",t),o.append("ServerType",this.uploadModal.model.ServerType),o.append("ServerTag",this.uploadModal.model.ServerTag),o.append("BaseImage",this.uploadModal.model.BaseImageRelease),o.append("Secret",r),o.append("suse",this.uploadModal.model.file),o.append("CreateMark",this.uploadModal.model.comment||""),this.$ajax.postForm("/k8s/api/patch_upload",o).then((function(t){e.closeUploadModal(),a.hide(),setTimeout(e.getImageList,1e3)})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},addImage:function(){var e=this,t=this.getServerId();if(this.$refs.addImageForm.validate()){var a=this.$Loading.show(),o=new FormData;o.append("Name",t),o.append("Image",this.addImageModal.model.Image),o.append("Secret",this.addImageModal.model.Secret||""),o.append("Mark",this.addImageModal.model.Mark||""),this.$ajax.postForm("/k8s/api/image_release_create",o).then((function(t){e.closeAddImageModal(),a.hide(),setTimeout(e.getImageList,1e3)})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},handleNoPublishedTime:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$t("pub.dlg.unpublished");return"0000:00:00 00:00:00"===e?t:e}},mounted:function(){this.getImageList(),this.getDefault(),this.reloadBuildList()}},Ee=Be,Je=(a("9df2"),Object(w["a"])(Ee,je,ze,!1,null,null,null)),He=Je.exports,Fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_config"},[e.configList?a("wrapper",{ref:"configListLoading"},[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{size:"small",theme:"sub-primary"},on:{click:e.addConfig}},[e._v(e._s(e.$t("cfg.btn.add")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.nodeConfigAdd(e.configList,e.checkedConfigId)}}},[e._v(e._s(e.$t("filter.btn.addNode")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.changeConfig(e.configList,"ConfigName",e.checkedConfigId,"configList")}}},[e._v(e._s(e.$t("operate.update")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.showDetail(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("cfg.title.viewConf")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.showHistory(e.configList,"ConfigName",e.checkedConfigId)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1),a("let-table",{attrs:{data:e.configList,title:e.$t("cfg.title.a"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.ConfigName},model:{value:e.checkedConfigId,callback:function(t){e.checkedConfigId=t},expression:"checkedConfigId"}},[a("span",{staticStyle:{"font-size":"0"}},[e._v(e._s(t.row.ConfigName))])])]}}],null,!1,367281790)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"250px"}})],1)],1):e._e(),e.nodeConfigList&&e.showOthers?a("wrapper",{ref:"nodeConfigListLoading"},[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.changeConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList,"nodeConfigList")}}},[e._v(e._s(e.$t("cfg.table.modCfg")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.showMergedDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewMerge")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.deleteConfig(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("operate.delete")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.showDetail(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("cfg.table.viewIpContent")))]),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:function(t){return e.showHistory(e.nodeConfigList,"ConfigId",e.nodeCheckList)}}},[e._v(e._s(e.$t("pub.btn.history")))])],1),e.nodeConfigList.length?a("let-checkbox",{staticClass:"check-all",model:{value:e.nodeCheckAll,callback:function(t){e.nodeCheckAll=t},expression:"nodeCheckAll"}}):e._e(),a("let-table",{attrs:{data:e.nodeConfigList,title:e.$t("cfg.title.c"),"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-checkbox",{attrs:{label:t.row.ConfigId},model:{value:e.nodeCheckList,callback:function(t){e.nodeCheckList=t},expression:"nodeCheckList"}})]}}],null,!1,1794674851)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.service"),width:"250px",prop:"ServerId"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.fileName"),width:"250px",prop:"ConfigName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"PodSeq"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-"+e._s(t.row.PodSeq)+" ")]}}],null,!1,3730132245)}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"CreateTime",width:"180px"}})],1)],1):e._e(),a("let-modal",{attrs:{title:e.configModal.isNew?e.$t("operate.title.add")+" "+e.$t("common.config"):e.$t("operate.title.update")+" "+e.$t("common.config"),width:"800px"},on:{"on-confirm":e.configDiff,close:e.closeConfigModal,"on-cancel":e.closeConfigModal},model:{value:e.configModal.show,callback:function(t){e.$set(e.configModal,"show",t)},expression:"configModal.show"}},[e.configModal.model?a("let-form",{ref:"configForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[a("let-input",{attrs:{size:"small",disabled:!e.configModal.isNew,required:""},model:{value:e.configModal.model.ConfigName,callback:function(t){e.$set(e.configModal.model,"ConfigName",t)},expression:"configModal.model.ConfigName"}})],1),e.configModal.isNew?e._e():a("let-form-item",{attrs:{label:e.$t("cfg.btn.reason"),required:""}},[a("let-input",{attrs:{size:"small",required:""},model:{value:e.configModal.model.ConfigMark,callback:function(t){e.$set(e.configModal.model,"ConfigMark",t)},expression:"configModal.model.ConfigMark"}})],1),a("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.configContent,callback:function(t){e.configContent=t},expression:"configContent"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.nodeConfigModal.isNew?e.$t("operate.title.add")+" "+e.$t("common.config"):e.$t("operate.title.update")+" "+e.$t("common.config"),width:"1000px"},on:{"on-confirm":e.updateNodeConfigFile,close:e.closeNodeConfigModal,"on-cancel":e.closeNodeConfigModal},model:{value:e.nodeConfigModal.show,callback:function(t){e.$set(e.nodeConfigModal,"show",t)},expression:"nodeConfigModal.show"}},[e.nodeConfigModal.model?a("let-form",{ref:"nodeConfigForm",attrs:{itemWidth:"100%"}},[a("let-form-item",{attrs:{label:e.$t("cfg.btn.fileName"),required:""}},[a("let-input",{attrs:{disabled:"",size:"small",required:""},model:{value:e.nodeConfigModal.model.ConfigName,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigName",t)},expression:"nodeConfigModal.model.ConfigName"}})],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.ip"),required:""}},[a("div",{staticStyle:{display:"flex"}},[a("span",{staticStyle:{display:"block"}},[e._v(e._s(e.nodeConfigModal.model.ServerId.replace(/\./g,"-").toLocaleLowerCase())+"-")]),a("let-input",{staticStyle:{display:"block",flex:"1"},attrs:{type:"number",min:0,max:20,size:"small",required:""},model:{value:e.nodeConfigModal.model.PodSeq,callback:function(t){e.$set(e.nodeConfigModal.model,"PodSeq",t)},expression:"nodeConfigModal.model.PodSeq"}})],1)]),a("let-form-item",{attrs:{label:e.$t("cfg.btn.content"),required:""}},[a("let-input",{attrs:{size:"large",type:"textarea",rows:16,required:""},model:{value:e.nodeConfigModal.model.ConfigContent,callback:function(t){e.$set(e.nodeConfigModal.model,"ConfigContent",t)},expression:"nodeConfigModal.model.ConfigContent"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.$t("filter.title.diffTxt"),width:"1200px"},on:{"on-confirm":e.updateConfigDiff,close:e.closeConfigDiffModal,"on-cancel":e.closeConfigDiffModal},model:{value:e.configDiffModal.show,callback:function(t){e.$set(e.configDiffModal,"show",t)},expression:"configDiffModal.show"}},[e.configDiffModal.model?a("div",{staticStyle:{"padding-top":"30px"}},[a("div",{staticClass:"codediff_head"},[a("div",{staticClass:"codediff_th"},[e._v("OLD:")]),a("div",{staticClass:"codediff_th"},[e._v("NEW:")])]),a("diff",{attrs:{"old-string":e.configDiffModal.model.oldData,"new-string":e.configDiffModal.model.newData,context:10,"output-format":"side-by-side"}})],1):e._e()]),a("let-modal",{attrs:{title:e.detailModal.title,width:"1200px",footShow:!1},on:{close:e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model&&e.detailModal.model.table?a("let-button",{staticStyle:{"margin-top":"20px"},attrs:{theme:"primary",size:"small"},on:{click:e.backConfig}},[e._v("恢复")]):e._e(),e.detailModal.model&&e.detailModal.model.table?a("let-table",{staticClass:"history-table",attrs:{data:e.detailModal.model.table,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:t.row.ConfigId},model:{value:e.backConfigId,callback:function(t){e.backConfigId=t},expression:"backConfigId"}},[e._v(e._s(""))])]}}],null,!1,316818822)}),a("let-table-column",{attrs:{title:e.$t("common.time"),prop:"CreateTime"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(e._s(t.row.CreateTime))])]}}],null,!1,2382811015)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ConfigVersion"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(e._s(t.row.ConfigVersion))])]}}],null,!1,3065663174)}),a("let-table-column",{attrs:{width:"400px",title:e.$t("cfg.btn.reason"),prop:"ConfigMark"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return e.historyClick(t.row)}}},[e._v(e._s(t.row.ConfigMark||" "))])]}}],null,!1,1879717673)}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.content"),width:"90px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.showTableDeatil(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}],null,!1,3538701521)})],1):e._e(),e.detailModal.model&&!e.detailModal.model.table||e.detailModal.model&&e.detailModal.model.table&&e.detailModal.model.detail?a("pre",[e._v(e._s(e.detailModal.model.detail||e.$t("cfg.msg.empty")))]):e._e(),a("div",{ref:"detailModalLoading",staticClass:"detail-loading"})],1)],1)},Ve=[],Ke=(a("8a79"),a("e68e")),We={name:"ServerConfig",components:{wrapper:R["a"],diff:Ke["a"]},data:function(){return{oldStr:"old code",newStr:"new code",serverData:{ServerId:""},checkedConfigId:"",backConfigId:"",configList:[],nodeConfigList:null,nodeCheckList:[],configContent:"",configModal:{show:!1,isNew:!0,model:null},nodeConfigContent:"",nodeConfigModal:{show:!1,isNew:!0,model:null},configDiffModal:{type:"",show:!1,isNew:!0,model:null},detailModal:{show:!1,title:"",model:null},refFileModal:{show:!1,model:{fileList:[]}},nodeRefFileListModal:{show:!1,model:null},pushResultModal:{show:!1,model:null}}},props:["treeid"],computed:{showOthers:function(){return 5===this.serverData.level},nodeCheckAll:{get:function(){return!(!this.nodeConfigList||!this.nodeConfigList.length)&&this.nodeCheckList.length===this.nodeConfigList.length},set:function(e){this.nodeCheckList=e?this.nodeConfigList.map((function(e){return e.ConfigId})):[]}}},watch:{checkedConfigId:function(){var e=this;this.$nextTick((function(){e.getNodeConfigList()}))}},methods:{getServerId:function(){return this.treeid},getConfigList:function(e){var t=this,a=this.$refs.configListLoading.$loading.show(),o=this.getServerId();this.$ajax.getJSON("/k8s/api/server_config_select",{ServerId:o}).then((function(e){a.hide(),t.configList=[],t.refFileList=[],t.nodeConfigList=[],e.hasOwnProperty("Data")&&(e.Data[0]&&e.Data[0].ConfigId&&(t.checkedConfigId=e.Data[0].ConfigName,t.getNodeConfigList()),e.Data.forEach((function(e){e.CreateTime=Object(Re["b"])(e.CreateTime)})),t.configList=e.Data)})).catch((function(e){a.hide(),t.$confirm(e.err_msg||e.message||t.$t("common.error"),t.$t("common.retry"),t.$t("common.alert")).then((function(){t.getConfigList()}))}))},addConfig:function(){var e=this.getServerId().split(".")[1]||"";this.configContent="",this.configModal.model={ConfigName:e&&"".concat(e,".conf")||"",ConfigContent:""},this.configModal.isNew=!0,this.configModal.show=!0},changeConfig:function(e,t,a,o){var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));if(!a||0===a.length||0==r.length)return this.$tip.warning(this.$t("dialog.tips.item"));this.configContent=r[0].ConfigContent,this.configModal.model=Object.assign(r[0],{ConfigMark:""}),this.configModal.target=o,this.configModal.isNew=!1,this.configModal.show=!0},updateConfigFile:function(){var e=this;if(this.$refs.configForm.validate()){var t=this.$Loading.show(),a=this.configModal.model;if(this.configModal.isNew){var o=Object.assign({ServerId:this.getServerId()},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}else this.$ajax.postJSON("/k8s/api/server_config_update",{ConfigId:a.ConfigId,ConfigMark:a.ConfigMark,ConfigContent:a.ConfigContent}).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeConfigModal(),e.closeConfigDiffModal()})).catch((function(a){t.hide(),e.$tip.error(e.$t("common.error"))}))}},updateNodeConfigFile:function(){var e=this;if(this.$refs.nodeConfigForm.validate()){var t=this.$Loading.show(),a=this.nodeConfigModal.model;if(this.nodeConfigModal.isNew){var o=Object.assign({ServerId:this.getServerId()},a);this.$ajax.postJSON("/k8s/api/server_config_create",o).then((function(a){t.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeNodeConfigModal()})).catch((function(a){t.hide(),e.$tip.error(a.err_msg)}))}}},backConfig:function(){var e=this,t=this.backConfigId;if(!t)return this.$tip.error("请先选择一项");var a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/server_config_history_back",{HistoryId:t}).then((function(t){a.hide(),e.$tip.success(e.$t("common.success")),e.getConfigList(),e.closeDetailModal()})).catch((function(){a.hide(),e.$tip.error(e.$t("common.error"))}))},closeConfigModal:function(){this.$refs.configForm&&this.$refs.configForm.resetValid(),this.configModal.show=!1},closeNodeConfigModal:function(){this.$refs.nodeConfigForm&&this.$refs.nodeConfigForm.resetValid(),this.nodeConfigModal.show=!1},deleteConfig:function(e,t,a){var o=this;if(!a)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.$confirm(this.$t("cfg.msg.confirmCfg"),this.$t("common.alert")).then((function(){var e=o.$Loading.show();o.$ajax.getJSON("/k8s/api/server_config_delete",{ConfigId:r[0].ConfigId}).then((function(t){e.hide(),o.getConfigList(o.serverData),o.$tip.success(o.$t("common.success"))})).catch((function(t){e.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(t.err_msg||t.message))}))}))},getNodeConfigList:function(){var e=this;if(this.showOthers){var t={ServerId:this.getServerId(),ConfigName:this.checkedConfigId};this.$ajax.getJSON("/k8s/api/server_config_select",t).then((function(t){t.Data.forEach((function(e){e.CreateTime=Object(Re["b"])(e.CreateTime)})),e.nodeCheckList=[],e.nodeConfigList=t.Data})).catch((function(t){e.nodeConfigList=[],e.$tip.error({title:e.$t("common.error"),message:t.err_msg||t.message||e.$t("common.networkErr")})}))}},nodeConfigAdd:function(e,t){if(!t)return this.$tip.warning(this.$t("dialog.tips.item"));var a=e.filter((function(e){return e.ConfigName===t}));this.nodeConfigModal.model={ServerId:a[0].ServerId,ConfigName:a[0].ConfigName,ConfigContent:""},this.nodeConfigModal.isNew=!0,this.nodeConfigModal.show=!0},showDetail:function(e,t,a){if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var o=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewConf"),this.detailModal.model={detail:o[0].ConfigContent},this.detailModal.show=!0},showMergedDetail:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewMerged"),this.detailModal.show=!0;var l=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/merged_node_config",{ServerId:r[0].ServerId,ConfigName:r[0].ConfigName,PodSeq:r[0].PodSeq}).then((function(e){l.hide(),o.detailModal.model={detail:e}})).catch((function(e){l.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showHistory:function(e,t,a){var o=this;if(!a||0===a.length)return this.$tip.warning(this.$t("dialog.tips.item"));var r=e.filter((function(e){return e[t]===a||e[t]===a[0]}));this.detailModal.title=this.$t("cfg.title.viewHistory"),this.detailModal.show=!0;var l=this.$loading.show({target:this.$refs.detailModalLoading});this.$ajax.getJSON("/k8s/api/server_config_history_select",{ConfigId:r[0].ConfigId}).then((function(e){l.hide(),e.Data.forEach((function(e){e.CreateTime=Object(Re["b"])(e.CreateTime)})),o.detailModal.model={currentVersion:r[0].ConfigVersion,ConfigId:r[0].ConfigId,table:e.Data,detail:""}})).catch((function(e){l.hide(),o.$tip.error("".concat(o.$t("common.error"),": ").concat(e.err_msg||e.message))}))},showTableDeatil:function(e){this.detailModal.model.detail=e.ConfigContent},closeDetailModal:function(){this.backConfigId="",this.detailModal.show=!1,this.detailModal.model=null},configDiff:function(){this.$refs.configForm.validate()&&(this.configDiffModal.type="config",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.configModal.model.ConfigContent,newData:this.configContent})},updateConfigDiff:function(){var e=this.configDiffModal.type,t=this.configModal.model;if(t.ConfigName.toLowerCase().endsWith(".json"))try{JSON.parse(this.configContent)}catch(i){return void alert("config format error:"+i.toString())}if(t.ConfigName.toLowerCase().endsWith(".xml"))try{var a=new DOMParser,o=a.parseFromString(this.configContent,"text/xml"),r=o.getElementsByTagName("parsererror"),l="";if(r.length>0)return l="parsererror"==o.documentElement.nodeName?o.documentElement.childNodes[0].nodeValue:o.getElementsByTagName("parsererror")[0].innerHTML,void alert("config format error:"+l)}catch(i){return void alert("config format error:"+i.toString())}"config"===e&&(this.configModal.model.ConfigContent=this.configContent,this.updateConfigFile())},closeConfigDiffModal:function(){this.configDiffModal.show=!1},nodeConfigDiff:function(){this.$refs.nodeConfigForm.validate()&&(this.configDiffModal.type="nodeConfig",this.configDiffModal.show=!0,this.configDiffModal.isNew=!1,this.configDiffModal.model={oldData:this.nodeConfigModal.model.ConfigContent,newData:this.nodeConfigContent})},historyClick:function(e){this.backConfigId=e.HistoryId}},created:function(){this.serverData=this.$parent.getServerData()},mounted:function(){this.getConfigList(this.serverData)}},Ye=We,Ue=(a("44ae"),Object(w["a"])(Ye,Fe,Ve,!1,null,null,null)),Ze=Ue.exports,Ge=a("c9e9"),Qe=a("4527"),Xe=a("c2de"),et=a("3430"),tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_manage"},[a("div",{staticClass:"table_head",staticStyle:{height:"50px"}},[a("h4",[e._v(e._s(this.$t("serverList.title.serverList"))+" "),a("i",{staticClass:"icon iconfont el-icon-third-shuaxin",staticStyle:{"font-family":"iconfont  !important",cursor:"pointer"},on:{click:function(t){return e.getServerList()}}})])]),e.serverList?a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.deleteTime"),prop:"DeleteTime"}})],1):e._e()],1)},at=[],ot={name:"ServerManage",data:function(){return{serverList:[]}},props:["treeid"],methods:{gotoLog:function(e){var t="/logview.html?History=true&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getServerId:function(){return this.treeid},getServerList:function(e){var t=this;this.$ajax.getJSON("/k8s/api/pod_history_list",{ServerId:this.getServerId()}).then((function(e){e.Data.forEach((function(e){e.CreateTime=E()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss"),e.DeleteTime=E()(e.DeleteTime).format("YYYY-MM-DD HH:mm:ss")})),t.serverList=e.Data})).catch((function(e){t.$confirm(e.err_msg||e.message||t.$t("serverList.msg.fail"),t.$t("common.alert")).then((function(){t.getServerList()}))}))},more:function(){this.getServerList(this.continue)}},created:function(){},mounted:function(){this.getServerList()}},rt=ot,lt=(a("29ca"),Object(w["a"])(rt,tt,at,!1,null,null,null)),it=lt.exports,st=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_server_history"},[e.serverListShow?a("div",{staticClass:"table_wrap"},[a("div",{staticClass:"table_head"},[a("h4",[e._v(e._s(this.$t("serverList.title.serverList")))])]),a("let-table",{attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podName"),prop:"PodName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.gotoLog(t.row)}}},[e._v(e._s(t.row.PodName))])]}}],null,!1,2844911292)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.podIP"),prop:"PodIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.ip"),prop:"NodeIp"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.version"),prop:"ServiceVersion"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.configStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.SettingState)},[e._v(e._s(t.row.SettingState))])]}}],null,!1,987565344)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currStatus")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{style:e.getState(t.row.PresentState)},[e._v(e._s(t.row.PresentState))])]}}],null,!1,1754665792)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.currMessage"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-tooltip",{staticClass:"tooltip",attrs:{placement:"top",content:t.row.PresentMessage||""}},[a("let-table-operation",[e._v(e._s(t.row.PresentMessage))])],1)]}}],null,!1,524765591)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.historyLink(t.row.id)}}},[e._v(e._s(e.$t("operate.goto")))])]}}],null,!1,1230847586)})],1),a("let-button",{attrs:{theme:"danger"},on:{click:function(t){return e.getMore()}}},[e._v(e._s(e.$t("operate.more")))])],1):a("div",{staticClass:"history_search"},[a("label",{staticClass:"history_search_box"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.historySearchKey,expression:"historySearchKey"}],staticClass:"history_search_key",attrs:{type:"text",placeholder:"请输入 应用名/服务名/IP地址 搜索"},domProps:{value:e.historySearchKey},on:{blur:e.historySearch,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.historySearch(t)},input:function(t){t.target.composing||(e.historySearchKey=t.target.value)}}})]),a("div",{staticClass:"history_list_wrap"},[a("div",{staticClass:"history_list_title"},[e._v("最近访问：")]),a("ul",{staticClass:"history_list"},e._l(e.historySearchList,(function(t){return a("li",{key:t,staticClass:"history_item"},[a("a",{staticClass:"history_link",attrs:{href:"javascript:;"},on:{click:function(a){return e.historySearchLink(t)}}},[e._v(e._s(t))])])})),0)])])])},nt=[],ct=(a("fb6a"),{name:"ServerHistory",data:function(){return{historySearchKey:"",historySearchList:[],serverList:[],serverListShow:!1,continue:null}},mounted:function(){this.updateHistorySearchKey()},methods:{gotoLog:function(e){var t="/logview.html?History=false&NodeIP=".concat(e.NodeIp,"&ServerApp=").concat(e.ServerApp,"&ServerName=").concat(e.ServerName,"&PodName=").concat(e.PodName);window.open(t)},getState:function(e){var t=e;switch("".concat(e)){case"Active":t="color: green";break;case"Inactive":case"Activating":case"Deactivating":case"Unknown":t="color: red";break}return t},getMore:function(){this.historySearch(this.continue)},historySearch:function(e){var t=this,a=this.historySearchKey;a&&(this.updateHistorySearchKey(),this.$ajax.getJSON("/k8s/api/server_search",{searchkey:a,continue:e}).then((function(e){t.continue=e.continue,t.serverList=e.rows,t.serverListShow=!0})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.err_msg||e.message))})))},historySearchLink:function(e){this.historySearchKey=e,this.historySearch()},historyLink:function(e){var t=this;this.$nextTick((function(){t.$parent.selectTree(e),t.$parent.getTreeData()}))},updateHistorySearchKey:function(){var e=this.historySearchKey,t=this.getLocalStorage("taf_history_key")||[];if(e){if(t&&t.length>0){var a=-1;t.forEach((function(t,o){t===e&&(a=o)})),-1!==a&&t.splice(a,1),t.unshift(e)}else t=[e];this.historySearchList=t.slice(0,20),this.setLocalStorage("taf_history_key",JSON.stringify(t))}else this.historySearchList=t},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}}}),dt=ct,pt=(a("98b3"),Object(w["a"])(dt,st,nt,!1,null,null,null)),ut=pt.exports,mt={name:"Server",components:{callChain:Pe["a"],manage:qe,publish:He,config:Ze,"server-monitor":Ge["a"],"property-monitor":Qe["a"],"interface-debuger":Xe["a"],"user-manage":et["a"],history:it,serverHistory:ut},data:function(){return{treeErrMsg:"load failed",treeData:null,treeSearchKey:"",treeid:"",isIconPlay:!1,serverData:{level:5,application:"",server_name:""},BTabs:[],defaultProps:{children:"children",label:"name"},openDelay:1e3,loading:!1,homeTab:"home"}},computed:{base:function(){return"/k8s/".concat(this.treeid)}},filters:{serverTypeFilter:function(e){return"tars"==e?"el-icon-tickets":"el-icon-document-copy"}},watch:{treeid:function(e){this.serverData=this.getServerData()},$route:function(e,t){"/server"===e.path&&this.getTreeData()}},directives:{vscroll:{componentUpdated:function(e){var t=e||"",a=e.children||[],o="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(o=e)})),o.offsetLeft<t.scrollLeft){var r=o.offsetLeft;t.scrollTo(r,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var l=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(l,0)}}}},methods:{getName:function(e){var t="";return e.lastIndexOf("/")>-1&&(t=e.substring(e.lastIndexOf("/")+1,e.length)),t},iconLoading:function(){var e=this;e.isIconPlay||(e.isIconPlay=!0,setTimeout((function(){e.isIconPlay=!1}),1e3))},handleNodeClick:function(e){e.id&&0!=e.type&&(this.selectBTabs(e.id),this.checkCurrBTabs())},filterTextChange:function(){this.$refs.trees.filter(this.treeSearchKey)},filterNode:function(e,t){return!e||-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},treeSearch:function(e){this.iconLoading(),this.getTreeData(this.treeSearchKey,e)},handleData:function(e,t){var a=this;e&&e.length&&e.forEach((function(e){e.label=e.name,e.nodeKey="0"!==e.type?e.id:"",a.treeSearchKey&&(e.expand=!0),e.children&&e.children.length&&a.handleData(e.children)}))},getTreeData:function(e,t){var a=this;this.treeData=null,this.$nextTick((function(){a.loading=!0,a.$ajax.getJSON("/k8s/api/tree",{searchKey:e||"",type:t}).then((function(e){a.loading=!1,a.treeData=e,a.handleData(a.treeData,!0)})).catch((function(e){a.loading=!1,a.treeErrMsg=e.err_msg||e.message||"load failed",a.treeData=!1}))}))},getServerData:function(){this.treeid||(this.treeid=this.getLocalStorage("k8s_treeid"));var e="";if(this.$refs.trees){var t=this.$refs.trees.getNode(this.treeid);t&&(e=t.data.serverType||"")}var a=this.treeid.split("."),o={level:1==a.length?1:5,application:a[0],server_name:a[1]||"",server_type:e};return this.treeid?(this.treeid,o):{}},checkTreeid:function(){this.treeid=this.getLocalStorage("k8s_treeid")||""},clickTab:function(e){var t=this.treeid,a=this.BTabs;a&&a.forEach((function(a){a.id===t&&(a.path=e)})),this.setLocalStorage("k8s_tabs",JSON.stringify(a))},isTrueTreeLevel:function(){var e=this.$route.path.split("/"),t=e[e.length-1],a=!1;"server"===t&&1!==this.serverData.level&&(a=!0),2===this.serverData.level||"manage"!==t&&"history"!==t&&"publish"!==t||(a=!0),a&&(1===this.serverData.level?this.$router.replace("server"):2===this.serverData.level&&this.$router.replace("manage"))},checkBTabs:function(){var e=this.BTabs,t=this.getLocalStorage("k8s_tabs");t&&t.length>0&&t.forEach((function(t){e.push({id:t.id,path:t.path})}))},checkCurrBTabs:function(){var e=this;this.$nextTick((function(){var t=e.$refs.btabs||"",a=t.children||[],o="";if(a.forEach((function(e){var t=e.getAttribute("class");t.indexOf("active")>-1&&(o=e)})),o.offsetLeft<t.scrollLeft){var r=o.offsetLeft;t.scrollTo(r,0)}else if(o.offsetLeft+o.offsetWidth>t.scrollLeft+t.offsetWidth){var l=o.offsetLeft+o.offsetWidth-t.offsetWidth;t.scrollTo(l,0)}}))},selectBTabs:function(e){var t=this.BTabs,a=!1;t.forEach((function(t){t.id===e&&(a=!0,t.path="/server/".concat(e,"/manage"))})),a||this.BTabs.push({id:e,path:"/server/".concat(e,"/manage")}),this.treeid=e,this.setLocalStorage("k8s_treeid",JSON.stringify(e)),this.setLocalStorage("k8s_tabs",JSON.stringify(t))},clickBTabs:function(e,t){t==this.homeTab&&(ut.data.serverListShow=!1),this.treeid=t,this.setLocalStorage("k8s_treeid",JSON.stringify(t))},closeBTabs:function(e){var t=this.BTabs,a=0;t.forEach((function(t,o){t.id===e&&(a=o)})),t.splice(a,1),this.setLocalStorage("k8s_tabs",JSON.stringify(t)),t.length>0?this.treeid=t[t.length-1].id:this.treeid="home",this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid))},closeAllBTabs:function(){this.BTabs=[],this.treeid="home",this.setLocalStorage("k8s_tabs",JSON.stringify(this.BTabs)),this.setLocalStorage("k8s_treeid",JSON.stringify(this.treeid)),this.getTreeData()},getLocalStorage:function(e){var t="";return window.localStorage&&(t=JSON.parse(JSON.parse(localStorage.getItem(e)))),t},setLocalStorage:function(e,t){var a="";return window.localStorage&&(a=localStorage.setItem(e,JSON.stringify(t))),a}},created:function(){this.serverData=this.getServerData(),this.isTrueTreeLevel()},mounted:function(){this.checkTreeid(),this.checkBTabs(),this.getTreeData(),this.treeid||(this.treeid="home")}},ft=mt,ht=(a("5d82"),Object(w["a"])(ft,D,O,!1,null,null,null)),vt=ht.exports,gt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation"},[a("let-tabs",{attrs:{activekey:e.$route.path},on:{click:e.onTabClick}},[a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.deploy"),tabkey:"/operation/deploy"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.approval"),tabkey:"/operation/approval"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.history"),tabkey:"/operation/history"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.undeploy"),tabkey:"/operation/undeploy"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.template"),tabkey:"/operation/templates"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.business"),tabkey:"/operation/business"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.application"),tabkey:"/operation/application"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.node"),tabkey:"/operation/node"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.event"),tabkey:"/operation/event"}}),a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.image"),tabkey:"/operation/image"}}),e.isAdmin?a("let-tab-pane",{attrs:{tab:e.$t("deployService.title.framework"),tabkey:"/operation/tfc"}}):e._e()],1),a("router-view",{staticClass:"page_operation_children"})],1)},bt=[],$t="/operation/deploy",St={name:"Operation",data:function(){return{isAdmin:!1}},beforeRouteEnter:function(e,t,a){"/operation"===e.path?a($t):a()},beforeRouteLeave:function(e,t,a){$t=t.path,a()},created:function(){this.checkAdmin()},methods:{checkAdmin:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isAdmin=!1,t.abrupt("return",e.$ajax.getJSON("/server/api/isAdmin").then((function(t){e.isAdmin=t.admin})).catch((function(e){})));case 2:case"end":return t.stop()}}),t)})))()},selectTree:function(e){"/operation"===this.$route.path?this.$router.push($t):this.$router.push({params:{treeid:e}})},onTabClick:function(e){this.$router.replace(e)}}},yt=St,_t=(a("04e5"),Object(w["a"])(yt,gt,bt,!1,null,null,null)),kt=_t.exports,wt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_deploy"},[a("let-form",{ref:"form",attrs:{inline:"","label-position":"top",itemWidth:"480px"},nativeOn:{submit:function(t){return t.preventDefault(),e.save(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%",required:""}},[a("let-select",{attrs:{disabled:e.k8sApplyShow,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.model.ServerApp,callback:function(t){e.$set(e.model,"ServerApp",t)},expression:"model.ServerApp"}},e._l(e.appList,(function(t){return a("let-option",{key:t.ServerApp,attrs:{value:t.ServerApp}},[e._v(e._s(t.ServerApp))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%",required:""}},[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.model.ServerName,callback:function(t){e.$set(e.model,"ServerName",t)},expression:"model.ServerName"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),itemWidth:"45%",required:""}},[a("let-select",{attrs:{disabled:e.k8sApplyShow,size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.model.ServerOption.ServerTemplate,callback:function(t){e.$set(e.model.ServerOption,"ServerTemplate",t)},expression:"model.ServerOption.ServerTemplate"}},e._l(e.templates,(function(t){return a("let-option",{key:t.TemplateName,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName)+" ")])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.model.ServerMark,callback:function(t){e.$set(e.model,"ServerMark",t)},expression:"model.ServerMark"}})],1),a("let-table",{attrs:{data:e.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.Name,callback:function(a){e.$set(t.row,"Name",a)},expression:"props.row.Name"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",type:"number",min:1,max:3e4,placeholder:"1-30000",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Port,callback:function(a){e.$set(t.row,"Port",a)},expression:"props.row.Port"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0,disabled:e.k8sApplyShow},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1,disabled:e.k8sApplyShow},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0,disabled:e.k8sApplyShow},model:{value:t.row.IsTaf,callback:function(a){e.$set(t.row,"IsTaf",a)},expression:"props.row.IsTaf"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1,disabled:e.k8sApplyShow},model:{value:t.row.IsTaf,callback:function(a){e.$set(t.row,"IsTaf",a)},expression:"props.row.IsTaf"}},[e._v("NOT TARS")])]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Threads,callback:function(a){e.$set(t.row,"Threads",a)},expression:"props.row.Threads"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Connections,callback:function(a){e.$set(t.row,"Connections",a)},expression:"props.row.Connections"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Capacity,callback:function(a){e.$set(t.row,"Capacity",a)},expression:"props.row.Capacity"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:e.k8sApplyShow,size:"small",type:"number",min:0},model:{value:t.row.Timeout,callback:function(a){e.$set(t.row,"Timeout",a)},expression:"props.row.Timeout"}})]}}])}),e.k8sApplyShow?e._e():a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"60px"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.$index?a("let-table-operation",{on:{click:function(a){return e.addAdapter(t.row)}}},[e._v(e._s(e.$t("operate.add"))+" ")]):e._e(),t.$index?a("let-table-operation",{staticClass:"danger",on:{click:function(a){return e.model.ServerServant.splice(t.$index,1)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]):e._e()]}}],null,!1,434370726)})],1),e.k8sApplyShow?e._e():a("let-button",{attrs:{type:"submit",theme:"primary"}},[e._v(e._s(e.$t("common.submit")))])],1),e.k8sApplyShow?a("div",[a("b",[e._v(e._s(e.$t("deployService.form.k8sExtra")))]),a("el-collapse",{staticStyle:{"margin-top":"5px"},attrs:{accordion:""},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-collapse-item",{attrs:{name:"0"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.nodeSelect")))])]),a("let-form",{ref:"nodeSelect",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.affinity"),itemWidth:"45%"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{size:"small"},model:{value:e.k8sApplyModel.abilityAffinity,callback:function(t){e.$set(e.k8sApplyModel,"abilityAffinity",t)},expression:"k8sApplyModel.abilityAffinity"}},e._l(e.abilityAffinities,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),0==e.k8sApplyModel.NodeSelector.length?a("let-form-item",{attrs:{itemWidth:"45%"}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItems(0,e.k8sApplyModel.NodeSelector)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1):e._e(),e._l(e.k8sApplyModel.NodeSelector,(function(t,o){return a("div",[a("let-form-item",{attrs:{label:e.$t("nodeList.table.th.label"),itemWidth:"15%"}},[a("el-input",{staticStyle:{width:"95%"},attrs:{size:"small"},model:{value:t.key,callback:function(a){e.$set(t,"key",a)},expression:"item.key"}})],1),a("let-form-item",{attrs:{label:"operator",itemWidth:"10%"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{size:"small"},on:{change:e.changeLabelOperator},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"item.operator"}},e._l(e.LabelMatchOperator,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("nodes.label.value"),itemWidth:"20%"}},[a("el-select",{staticStyle:{width:"95%"},attrs:{disabled:t.disableValue,multiple:"",filterable:"","allow-create":"","multiple-limit":63,"default-first-option":"",placeholder:e.$t("deployService.form.labelMatch.labelValue"),size:"small"},on:{change:function(t){e.addLabelValues(t,o)}},model:{value:t.values,callback:function(a){e.$set(t,"values",a)},expression:"item.values"}},e._l(t.values,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",size:"mini",circle:""},on:{click:function(t){return e.addItems(o,e.k8sApplyModel.NodeSelector)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-minus",size:"mini",circle:""},on:{click:function(t){return e.delItems(o,e.k8sApplyModel.NodeSelector)}}})],1)}))],2)],2),a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.network")))])]),a("let-form",{ref:"networkForm",staticClass:"two-columns",attrs:{itemWidth:"360px",columns:2}},[a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostIpc"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sApplyModel.HostIpc,callback:function(t){e.$set(e.k8sApplyModel,"HostIpc",t)},expression:"k8sApplyModel.HostIpc"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostNetwork"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sApplyModel.HostNetwork,callback:function(t){e.$set(e.k8sApplyModel,"HostNetwork",t)},expression:"k8sApplyModel.HostNetwork"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.table.th.hostPort"),itemWidth:"25%"}},[a("el-radio-group",{on:{change:e.changeKind},model:{value:e.k8sApplyModel.showHostPort,callback:function(t){e.$set(e.k8sApplyModel,"showHostPort",t)},expression:"k8sApplyModel.showHostPort"}},[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.$t("common.true")))]),a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.$t("common.false")))])],1)],1),e.k8sApplyModel.showHostPort?a("div",{staticStyle:{"padding-right":"30px"}},[a("let-table",{attrs:{data:e.k8sApplyModel.HostPortArr}},[a("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.obj,callback:function(a){e.$set(t.row,"obj",a)},expression:"props.row.obj"}})]}}],null,!1,910875067)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.hostPort")},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:1,max:65535,placeholder:"1-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.HostPort,callback:function(a){e.$set(t.row,"HostPort",a)},expression:"props.row.HostPort"}})]}}],null,!1,4126442684)}),a("let-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-button",{staticClass:"port-button",attrs:{size:"small",theme:"primary"},on:{click:function(a){return e.generateHostPort(t.row)}}},[e._v(" "+e._s(e.$t("deployService.table.th.checkHostPort"))+" ")])]}}],null,!1,642882776)})],1)],1):e._e()],1)],2),a("el-collapse-item",{attrs:{name:"2"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.disk")))])]),0==e.k8sApplyModel.mounts.length?a("div",[a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"text",size:"mini"},on:{click:function(t){return e.addDisk(0,e.k8sApplyModel.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")])],1):e._e(),a("el-form",{ref:"disk",attrs:{"label-position":"top","label-width":"120px",size:"mini"}},e._l(e.k8sApplyModel.mounts,(function(t,o){return a("div",{key:o},[a("el-card",[a("el-row",{attrs:{gutter:18}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.diskName"),required:""}},[a("el-input",{model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"disk.name"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:e.$t("deployService.disk.path"),required:""}},[a("el-input",{model:{value:t.mountPath,callback:function(a){e.$set(t,"mountPath",a)},expression:"disk.mountPath"}})],1)],1)],1),a("el-row",{attrs:{gutter:18}},[a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"uid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.uid,callback:function(a){e.$set(t.source.tLocalVolume,"uid",a)},expression:"disk.source.tLocalVolume.uid"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"gid",required:""}},[a("el-input",{attrs:{placeholder:"0"},model:{value:t.source.tLocalVolume.gid,callback:function(a){e.$set(t.source.tLocalVolume,"gid",a)},expression:"disk.source.tLocalVolume.gid"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-form-item",{attrs:{label:"mode",required:""}},[a("el-input",{attrs:{placeholder:"755"},model:{value:t.source.tLocalVolume.mode,callback:function(a){e.$set(t.source.tLocalVolume,"mode",a)},expression:"disk.source.tLocalVolume.mode"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{offset:9}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.addDisk(o,e.k8sApplyModel.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.addDisk"))+" ")]),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.delDisk(o,e.k8sApplyModel.mounts)}}},[e._v(" "+e._s(e.$t("deployService.disk.delDisk"))+" ")])],1)],1)],1)],1)})),0)],2),a("el-collapse-item",{attrs:{name:"3"}},[a("template",{slot:"title"},[a("b",[e._v(e._s(e.$t("operate.resource")))])]),a("el-form",{attrs:{"label-width":"100px","label-position":"top",size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.k8sApplyModel.resources.limitCpu,callback:function(t){e.$set(e.k8sApplyModel.resources,"limitCpu",t)},expression:"k8sApplyModel.resources.limitCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.limitMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.k8sApplyModel.resources.limitMem,callback:function(t){e.$set(e.k8sApplyModel.resources,"limitMem",t)},expression:"k8sApplyModel.resources.limitMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestCpu"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":1000",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.k8sApplyModel.resources.requestCpu,callback:function(t){e.$set(e.k8sApplyModel.resources,"requestCpu",t)},expression:"k8sApplyModel.resources.requestCpu"}},[a("template",{slot:"append"},[e._v("milli CPUs")])],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("deployService.resources.requestMem"),itemWidth:"50%"}},[a("el-input",{attrs:{placeholder:e.$t("deployService.resources.example")+":128",size:"small",onkeyup:"value=value.replace(/[^\\d]/g,'')"},model:{value:e.k8sApplyModel.resources.requestMem,callback:function(t){e.$set(e.k8sApplyModel.resources,"requestMem",t)},expression:"k8sApplyModel.resources.requestMem"}},[a("template",{slot:"append"},[e._v("MiB")])],2)],1)],1)],1)],1)],2)],1),a("el-button",{staticStyle:{"margin-top":"10px"},on:{click:e.editYaml}},[e._v("yaml编辑")]),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary"},on:{click:e.saveK8s}},[e._v(e._s(e.$t("operate.save")))])],1):e._e(),a("let-modal",{staticClass:"more-cmd",attrs:{width:"1000px",footShow:!1},on:{close:e.closeYamlModel,"on-cancel":e.closeYamlModel},model:{value:e.yamlModel.show,callback:function(t){e.$set(e.yamlModel,"show",t)},expression:"yamlModel.show"}},[a("k8s-yaml-edit",{ref:"yamlEdit",on:{successFun:e.closeYamlModel}})],1),a("let-modal",{staticClass:"more-cmd",attrs:{width:"700px",footShow:!1},on:{close:e.closeResultModal,"on-cancel":e.closeResultModal},model:{value:e.resultModal.show,callback:function(t){e.$set(e.resultModal,"show",t)},expression:"resultModal.show"}},[a("p",{staticClass:"result-text"},[e._v(" "+e._s(e.$t("deployService.form.ret.success"))+e._s(e.$t("resource.installRstMsg"))+" ")]),a("let-table",{attrs:{data:e.resultModal.resultList,"empty-msg":e.$t("common.nodata"),"row-class-name":e.resultModal.rowClassName}},[a("let-table-column",{attrs:{title:"ip",prop:"ip"}}),a("let-table-column",{attrs:{title:e.$t("resource.installResult"),prop:"rst"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{domProps:{textContent:e._s(t.row.rst?e.$t("common.success"):e.$t("common.error"))}})]}}])}),a("let-table-column",{attrs:{title:e.$t("common.message"),prop:"msg"}})],1)],1)],1)},Mt=[],xt=a("2494"),Nt=a("2ef0"),Ct=a.n(Nt),Tt=["taf_cpp","taf_java","taf_php","taf_node","not_taf","taf_go"],Lt=function(){return{ServerApp:"",ServerName:"",ServerMark:"",ServerServant:[{Name:"",Port:"",HostPort:0,showHostPort:!1,Threads:0,Connections:0,Capacity:0,Timeout:0,IsTcp:!0,IsTars:!1}],ServerOption:{ServerImportant:0}}},At={name:"OperationDeploy",components:{SetInputer:xt["a"],K8sYamlEdit:Ne},data:function(){return{types:Tt,templates:[],appList:[],isCheckedAll:!1,NodeList:[],NodeListArr:[],model:Lt(),enableAuth:!1,resultModal:{show:!1,resultList:[],rowClassName:function(e){return e&&e.row&&!e.row.rst?"err-row":""}},DeployId:"",activeTab:"0",k8sApplyShow:!1,k8sApplyModel:{NodeSelector:[],tars:{},resources:{},mounts:[]},abilityAffinities:["AppRequired","ServerRequired","AppOrServerPreferred","None"],LabelMatchOperator:[],yamlModel:{show:!1}}},mounted:function(){var e=this;this.getServerTemplate(),this.getDefaultValue(),this.getAppList(),this.getNodeList(),this.$watch("model.ServerName",(function(e,t){})),this.$watch("model.node_name",(function(t,a){t!==a&&e.model.ServerServant.forEach((function(e){e.bind_ip=t}))}))},methods:{showHostPort:function(e){e.showHostPort=!0},hideHostPort:function(e){e.HostPort=0,e.showHostPort=!1},checkedChange:function(e){this.NodeListArr.indexOf(e)>-1?this.NodeListArr.splice(this.NodeListArr.indexOf(e),1):this.NodeListArr.push(e),0===this.NodeListArr.length&&(this.isCheckedAll=!1)},addAdapter:function(e){e=this.model.ServerServant[this.model.ServerServant.length-1];var t=e.Port+1,a=Object.assign({},e,{Port:t});this.model.ServerServant.push(Object.assign({},a))},deploy:function(){var e=this;this.$refs.form.validate()&&this.$confirm(this.$t("deployService.form.deployServiceTip"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/deploy_create",e.model).then((function(a){t.hide(),e.DeployId=a.metadata.name,e.showK8sExtra(a.metadata.name)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))}))},getServerTemplate:function(){var e=this;this.$ajax.getJSON("/k8s/api/template_select",{isAll:!0}).then((function(t){e.templates=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},save:function(){this.deploy()},showResultModal:function(e){this.resultModal.resultList=e,this.resultModal.show=!0},closeResultModal:function(){this.resultModal.show=!1,this.resultModal.resultList=[]},getDefaultValue:function(){var e=this,t=this.model,a=t.ServerServant,o=t.ServerOption;this.$ajax.getJSON("/k8s/api/default",{}).then((function(t){t.ServerServantElem&&a.forEach((function(e){e.Port=t.ServerServantElem.Port,e.HostPort=t.ServerServantElem.HostPort,e.showHostPort=!1,e.Capacity=t.ServerServantElem.Capacity,e.Connections=t.ServerServantElem.Connections,e.Threads=t.ServerServantElem.Threads,e.Timeout=t.ServerServantElem.Timeout,e.IsTcp=t.ServerServantElem.IsTcp,e.IsTars=t.ServerServantElem.IsTars})),t.ServerOption&&(o=t.ServerOption),e.model.ServerServant=a,e.model.ServerOption=o,e.LabelMatchOperator=t.LabelMatchOperator})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.appList=t.Data}))},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_list",{isAll:!0}).then((function(t){e.NodeList=t}))},showK8sExtra:function(e){var t=this;this.k8sApplyShow=!0,this.$ajax.getJSON("/k8s/api/deploy_select",{deployName:e}).then((function(e){var a=Ct.a.cloneDeep(e.Data[0]);console.log("deploy:"+JSON.stringify(a,null,4)),t.k8sApplyModel={abilityAffinity:a.ServerK8S.abilityAffinity,NodeSelector:a.ServerK8S.NodeSelector,HostIpc:a.ServerK8S.HostIpc,HostNetwork:a.ServerK8S.HostNetwork,mounts:a.Mounts.filter((function(e){return e.source.hasOwnProperty("tLocalVolume")})),resources:a.resources};var o=[];if(a.ServerK8S.HostPort&&Object.keys(a.ServerK8S.HostPort).length>0&&(t.k8sApplyModel.showHostPort=!0,a.ServerK8S.HostPort.forEach((function(e){o.push({obj:e.NameRef,HostPort:Math.floor(e.Port)})})),t.k8sApplyModel.HostPortArr=o),0==o.length)for(var r in t.k8sApplyModel.showHostPort=!1,t.k8sApplyModel.HostPortArr=[],a.ServerServant)t.k8sApplyModel.HostPortArr.push({obj:r,HostPort:0})})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},addItems:function(e,t){t.length>=63?this.$message.error("".concat(this.$t("deployService.form.labelMatch.labelMax"))):(t.splice(e+1,0,{key:"",operator:"In",values:[]}),this.$forceUpdate())},delItems:function(e,t){t.splice(e,1),this.$forceUpdate()},addLabelValues:function(e,t){var a=this,o=/^([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]?$/;this.labelMatchArr[t].values.forEach((function(e,t){o.test(e)||(a.labelMatchArr[t].values.splice(t,1),a.$message.error("".concat(a.$t("deployService.form.labelMatch.labelValueValid"))))}))},changeLabelOperator:function(e){var t=this;this.labelMatchArr.forEach((function(e){"Exists"==e.operator||"DoesNotExist"==e.operator?(t.$set(e,"disableValue",!0),t.$set(e,"values",[])):t.$set(e,"disableValue",!1)}))},changeKind:function(){this.$forceUpdate()},generateHostPort:function(e){var t=this;this.$ajax.getJSON("/k8s/api/check_host_port",{NodePort:e.HostPort}).then((function(e){var a="";e.forEach((function(e){-1==e.ret?a+="<p>".concat(e.node,":").concat(e.port,": can use</p>"):a+='<p style="color: #F56C6C">'.concat(e.node,":").concat(e.port,": cannot use</p>")})),t.$message.success({dangerouslyUseHTMLString:!0,message:a})})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},addDisk:function(e,t){t.splice(e+1,0,{name:"",source:{tLocalVolume:{uid:"",gid:"",mode:""}},mountPath:""}),this.$forceUpdate()},delDisk:function(e,t){t.splice(e,1),this.$forceUpdate()},saveK8s:function(){var e=this;console.log("this.model:"+JSON.stringify(this.model,null,4)),console.log("this.k8sApplyModel:"+JSON.stringify(this.k8sApplyModel,null,4)),this.$ajax.postJSON("/k8s/api/deploy_update",{DeployId:this.DeployId,ServerServant:this.model.ServerServant,ServerOption:this.model.ServerOption,ServerK8S:this.k8sApplyModel}).then((function(t){e.$tip.success("".concat(e.$t("common.success"))),e.$router.replace("/operation/approval")})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},editYaml:function(){this.yamlModel.show=!0,this.$refs.yamlEdit.show(this.DeployId,"tdeploys")},closeYamlModel:function(){this.yamlModel.show=!1}}},It=At,Dt=(a("4917"),Object(w["a"])(It,wt,Mt,!1,null,null,null)),Ot=Dt.exports,qt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_approval"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestPerson"),prop:"RequestPerson",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestMark"),prop:"RequestMark"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestTime"),prop:"RequestTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.approvalItem(t.row)}}},[e._v(e._s(e.$t("operate.approval")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"80%"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%",required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.detailModal.model.ServerName,callback:function(t){e.$set(e.detailModal.model,"ServerName",t)},expression:"detailModal.model.ServerName"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),itemWidth:"45%",required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.detailModal.model.ServerOption.ServerTemplate,callback:function(t){e.$set(e.detailModal.model.ServerOption,"ServerTemplate",t)},expression:"detailModal.model.ServerOption.ServerTemplate"}},e._l(e.templates,(function(t){return a("let-option",{key:t.TemplateName,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.detailModal.model.ServerMark,callback:function(t){e.$set(e.detailModal.model,"ServerMark",t)},expression:"detailModal.model.ServerMark"}})],1),a("let-table",{attrs:{data:e.detailModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.Name,callback:function(a){e.$set(t.row,"Name",a)},expression:"props.row.Name"}})]}}],null,!1,3758810427)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Port,callback:function(a){e.$set(t.row,"Port",a)},expression:"props.row.Port"}})]}}],null,!1,826062684)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,1519152386)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,3031957841)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Threads,callback:function(a){e.$set(t.row,"Threads",a)},expression:"props.row.Threads"}})]}}],null,!1,1655720946)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Connections,callback:function(a){e.$set(t.row,"Connections",a)},expression:"props.row.Connections"}})]}}],null,!1,2060048682)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"120px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Capacity,callback:function(a){e.$set(t.row,"Capacity",a)},expression:"props.row.Capacity"}})]}}],null,!1,58581595)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{size:"small",type:"number",min:0},model:{value:t.row.Timeout,callback:function(a){e.$set(t.row,"Timeout",a)},expression:"props.row.Timeout"}})]}}],null,!1,1471836343)}),a("let-table-column",{attrs:{width:"10px"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:(e.approvalModal.isNew,this.$t("deployService.title.approval")),width:"80%"},on:{"on-confirm":e.saveApprovalItem,"on-cancel":e.closeApprovalModal},model:{value:e.approvalModal.show,callback:function(t){e.$set(e.approvalModal,"show",t)},expression:"approvalModal.show"}},[e.approvalModal.model?a("let-form",{ref:"approvalForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%",required:""}},[a("let-input",{attrs:{disabled:"",size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.approvalModal.model.ServerApp,callback:function(t){e.$set(e.approvalModal.model,"ServerApp",t)},expression:"approvalModal.model.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%",required:""}},[a("let-input",{attrs:{disabled:"",size:"small",placeholder:e.$t("deployService.form.serviceFormatTips"),required:"","required-tip":e.$t("deployService.form.serviceTips"),pattern:"^[a-zA-Z]([a-zA-Z0-9]+)?$","pattern-tip":e.$t("deployService.form.serviceFormatTips")},model:{value:e.approvalModal.model.ServerName,callback:function(t){e.$set(e.approvalModal.model,"ServerName",t)},expression:"approvalModal.model.ServerName"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),itemWidth:"45%",required:""}},[a("let-select",{attrs:{disabled:"",size:"small",required:"","required-tip":e.$t("deployService.form.templateTips")},model:{value:e.approvalModal.model.ServerOption.ServerTemplate,callback:function(t){e.$set(e.approvalModal.model.ServerOption,"ServerTemplate",t)},expression:"approvalModal.model.ServerOption.ServerTemplate"}},e._l(e.templates,(function(t){return a("let-option",{key:t.TemplateName,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[a("let-input",{attrs:{disabled:"",size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.approvalModal.model.ServerMark,callback:function(t){e.$set(e.approvalModal.model,"ServerMark",t)},expression:"approvalModal.model.ServerMark"}})],1),a("let-table",{attrs:{data:e.approvalModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ",width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.objTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:t.row.Name,callback:function(a){e.$set(t.row,"Name",a)},expression:"props.row.Name"}})]}}],null,!1,3088624381)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port"),width:"100px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",type:"number",min:0,max:65535,placeholder:"0-65535",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Port,callback:function(a){e.$set(t.row,"Port",a)},expression:"props.row.Port"}})]}}],null,!1,2426397722)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType"),width:"150px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{disabled:"",label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]),a("let-radio",{attrs:{disabled:"",label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,1671426050)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol"),width:"180px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-radio",{attrs:{disabled:"",label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]),a("let-radio",{attrs:{disabled:"",label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("NOT TARS")])]}}],null,!1,2516800849)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Threads,callback:function(a){e.$set(t.row,"Threads",a)},expression:"props.row.Threads"}})]}}],null,!1,2306495156)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Connections,callback:function(a){e.$set(t.row,"Connections",a)},expression:"props.row.Connections"}})]}}],null,!1,2695745772)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",type:"number",min:0,required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:t.row.Capacity,callback:function(a){e.$set(t.row,"Capacity",a)},expression:"props.row.Capacity"}})]}}],null,!1,1268742429)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-input",{attrs:{disabled:"",size:"small",type:"number",min:0},model:{value:t.row.Timeout,callback:function(a){e.$set(t.row,"Timeout",a)},expression:"props.row.Timeout"}})]}}],null,!1,882398385)}),a("let-table-column",{attrs:{width:"10px"}})],1),a("div",[a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalResult"),required:""}},[a("let-select",{attrs:{size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.approvalModal.model.ApprovalResult,callback:function(t){e.$set(e.approvalModal.model,"ApprovalResult",t)},expression:"approvalModal.model.ApprovalResult"}},e._l(e.approvalResult,(function(t){return a("let-option",{key:t.label,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1),a("div",[a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalMark"),required:""}},[a("let-input",{attrs:{type:"textarea",rows:3,placeholder:e.$t("serviceApproval.ApprovalMark"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.approvalModal.model.ApprovalMark,callback:function(t){e.$set(e.approvalModal.model,"ApprovalMark",t)},expression:"approvalModal.model.ApprovalMark"}})],1)],1)],1):e._e()],1)],1)},Pt=[],jt=[{label:"Approve",value:"true"},{label:"Reject",value:"false"}],zt={name:"OperationApproval",data:function(){return{approvalResult:jt,templates:[],query:{ServerApp:"",ServerName:""},items:[],K8SisCheckedAll:!1,K8SNodeList:[],K8SNodeListArr:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1},approvalModal:{show:!1,model:null,isNew:!1},k8sApplyModel:{NodeSelector:[],tars:{},resources:{},mounts:[]}}},watch:{K8SisCheckedAll:function(){var e=this,t=this.K8SisCheckedAll;t?this.K8SNodeList.forEach((function(t){-1===e.K8SNodeListArr.indexOf(t)&&e.K8SNodeListArr.push(t)})):this.K8SNodeListArr=[]}},mounted:function(){this.getServerTemplate(),this.getNodeList(),this.fetchData()},methods:{K8ScheckedChange:function(e){this.K8SNodeListArr.indexOf(e)>-1?this.K8SNodeListArr.splice(this.K8SNodeListArr.indexOf(e),1):this.K8SNodeListArr.push(e),0===this.K8SNodeListArr.length&&(this.K8SisCheckedAll=!1)},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/deploy_select",{ServerApp:this.query.ServerApp,ServerName:this.query.ServerName}).then((function(a){if(t.hide(),e.items=[],a.hasOwnProperty("Data")){for(var o=0;o<a.Data.length;o++){a.Data[o].RequestTime=Object(Re["b"])(a.Data[o].RequestTime,"YYYY-MM-DD HH:mm:ss");var r=[];for(var l in a.Data[o].ServerServant)r.push(a.Data[o].ServerServant[l]);if(a.Data[o].ServerServant=r,0==a.Data[o].ServerK8S.HostPort.length)for(var i in a.Data[o].ServerServant)a.Data[o].ServerK8S.HostPort.push({NameRef:a.Data[o].ServerServant[i].Name,Port:a.Data[o].ServerServant[i].Port})}e.items=a.Data}})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},closeApprovalModal:function(){this.$refs.approvalForm.resetValid(),this.approvalModal.show=!1,this.approvalModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},approvalItem:function(e){this.approvalModal.model=e,this.approvalModal.show=!0,this.approvalModal.isNew=!1},adapterServerK8S:function(e){var t=Object.assign({},e),a={};return t.ServerServant.forEach((function(e){a[e.Name]=e})),t.ServerServant=a,t},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.adapterServerK8S(this.detailModal.model);if(!t)return;var a=this.$Loading.show();this.k8sApplyModel={abilityAffinity:t.ServerK8S.abilityAffinity,NodeSelector:t.ServerK8S.NodeSelector,HostIpc:t.ServerK8S.HostIpc,HostNetwork:t.ServerK8S.HostNetwork,mounts:t.Mounts.filter((function(e){return e.source.hasOwnProperty("tLocalVolume")})),resources:t.resources};var o=[];if(t.ServerK8S.HostPort&&Object.keys(t.ServerK8S.HostPort).length>0&&(this.k8sApplyModel.showHostPort=!0,t.ServerK8S.HostPort.forEach((function(e){o.push({obj:e.NameRef,HostPort:Math.floor(e.Port)})})),this.k8sApplyModel.HostPortArr=o),0==o.length)for(var r in this.k8sApplyModel.showHostPort=!1,this.k8sApplyModel.HostPortArr=[],t.ServerServant)this.k8sApplyModel.HostPortArr.push({obj:r,HostPort:0});this.$ajax.postJSON("/k8s/api/deploy_update",{DeployId:t.DeployId,ServerServant:t.ServerServant,ServerOption:t.ServerOption,ServerK8S:this.k8sApplyModel}).then((function(){a.hide(),e.fetchData().then((function(){e.detailModal.show=!1,e.$tip.success(e.$t("common.success"))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},saveApprovalItem:function(){var e=this;if(this.$refs.approvalForm.validate()){var t=this.approvalModal.model,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/approval_create",t).then((function(){a.hide(),e.fetchData().then((function(){e.approvalModal.show=!1,e.$tip.success(e.$t("common.success"))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/deploy_delete",{DeployId:e.DeployId}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getServerTemplate:function(){var e=this;this.$ajax.getJSON("/k8s/api/template_select",{isAll:!0}).then((function(t){e.templates=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_list",{isAll:!0}).then((function(t){e.K8SNodeList=t}))}}},Rt=zt,Bt=(a("244f"),Object(w["a"])(Rt,qt,Pt,!1,null,null,null)),Et=Bt.exports,Jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_history"},[a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.RequestPerson"),prop:"RequestPerson",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalTime"),prop:"ApprovalTime"}}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalResult"),prop:"ApprovalResult"},scopedSlots:e._u([{key:"default",fn:function(t){return[""+t.row.ApprovalResult==="true"?a("span",{staticClass:"success"},[e._v("Approval")]):""+t.row.ApprovalResult==="false"?a("span",{staticClass:"warn"},[e._v("Reject")]):a("span",[e._v(e._s(t.row.ApprovalResult))])]}}])}),a("let-table-column",{attrs:{title:e.$t("serviceApproval.ApprovalMark"),prop:"ApprovalMark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))])]}}])})],1),""!=this.Continue?a("let-button",{on:{click:e.fetchData}},[e._v("more")]):e._e(),a("let-modal",{attrs:{title:e.$t("deployService.title.history"),width:"80%"},on:{"on-confirm":e.closeViewModal,"on-cancel":e.closeViewModal},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("let-form",{ref:"viewForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerApp))]),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerName))]),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark"),itemWidth:"45%"}},[e._v(e._s(e.viewModal.model.ServerMark))]),a("let-table",{attrs:{data:e.viewModal.model.ServerServant}},[a("let-table-column",{attrs:{title:"OBJ"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Name))]}}],null,!1,1485259994)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.port")},scopedSlots:e._u([{key:"head",fn:function(t){return[a("span",{staticClass:"required"},[e._v(e._s(t.column.title))])]}},{key:"default",fn:function(t){return[e._v(e._s(t.row.Port))]}}],null,!1,1805883483)}),a("let-table-column",{attrs:{title:e.$t("deployService.form.portType")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTcp?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("TCP")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTcp,callback:function(a){e.$set(t.row,"IsTcp",a)},expression:"props.row.IsTcp"}},[e._v("UDP")])]}}],null,!1,2027518380)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.protocol")},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.IsTars?a("let-radio",{attrs:{label:!0},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v("TARS")]):a("let-radio",{attrs:{label:!1},model:{value:t.row.IsTars,callback:function(a){e.$set(t.row,"IsTars",a)},expression:"props.row.IsTars"}},[e._v(e._s(e.$t("serverList.servant.notTARS")))])]}}],null,!1,387019230)}),a("let-table-column",{attrs:{title:e.$t("deployService.table.th.threads"),width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Threads))]}}],null,!1,2683018496)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.connections"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Connections))]}}],null,!1,192188376)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.capacity"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Capacity))]}}],null,!1,4133537865)}),a("let-table-column",{attrs:{title:e.$t("serverList.table.servant.timeout"),width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.Timeout))]}}],null,!1,2137174470)}),a("let-table-column",{attrs:{width:"10px"}})],1),a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalResult")}},[e.viewModal.model.ApprovalResult?a("span",{class:e.viewModal.model.ApprovalResult?"success":"warn"},[e._v(e._s(e.viewModal.model.ApprovalResult?"通过":"驳回"))]):e._e()]),a("let-form-item",{attrs:{label:e.$t("serviceApproval.ApprovalMark"),itemWidth:"100%"}},[e._v(e._s(e.viewModal.model.ApprovalMark))])],1):e._e()],1)],1)},Ht=[],Ft={name:"OperationHistory",data:function(){return{items:[],Continue:null,viewModal:{show:!1,model:null},K8SisCheckedAll:!1,K8SNodeList:[]}},mounted:function(){this.getDefaultValue(),this.getNodeList(),this.fetchData()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/approval_select",{Continue:this.Continue}).then((function(a){t.hide(),e.Continue=a.Continue,a.Data&&a.Data.forEach((function(t){var a=[];if(t.ServerServant){for(var o in t.ServerServant)a.push(t.ServerServant[o]);t.ServerServant=a}t.ApprovalTime=Object(Re["b"])(t.ApprovalTime,"YYYY-MM-DD HH:mm:ss"),e.items.push(t)}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_list",{isAll:!0}).then((function(t){e.K8SNodeList=t}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){var t=this.adapterServerK8S(e);this.viewModal.model=t,this.viewModal.show=!0},adapterServerK8S:function(e){return e}}},Vt=Ft,Kt=(a("afb9"),Object(w["a"])(Vt,Jt,Ht,!1,null,null,null)),Wt=Kt.exports,Yt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_undeploy"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.serverList,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{width:"60px"},scopedSlots:e._u([{key:"head",fn:function(t){return[a("let-checkbox",{model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}})]}},{key:"default",fn:function(t){return[a("let-checkbox",{on:{change:function(a){return e.checkChange(t.row)}},model:{value:t.row.isChecked,callback:function(a){e.$set(t.row,"isChecked",a)},expression:"scope.row.isChecked"}})]}}])}),a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.serviceName"),prop:"ServerName"}})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("div",{staticClass:"btn_group"},[a("let-button",{attrs:{theme:"primary",size:"small"},on:{click:e.undeployServer}},[e._v(e._s(e.$t("operate.undeploy")))])],1),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1)],1)},Ut=[],Zt={name:"OperationUndeploy",data:function(){return{query:{ServerApp:"",ServerName:""},pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},serverList:[],isCheckedAll:!1,checkedList:[]}},watch:{isCheckedAll:function(){var e=this.isCheckedAll;this.serverList.forEach((function(t){t.isChecked=e})),this.checkedList=e?[].concat(this.serverList):[]}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/server_list",{ServerApp:this.query.ServerApp,ServerName:this.query.ServerName,page:this.pagination.page,size:this.pagination.size}).then((function(a){t.hide(),e.serverList=[],a.hasOwnProperty("Data")&&(a.Data.forEach((function(e){e.isChecked=!1})),e.serverList=a.Data),e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeViewModal:function(){this.viewModal.show=!1,this.viewModal.model=null},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},checkChange:function(e){var t=this.checkedList,a=e.isChecked;if(a){var o=!1;t.forEach((function(t){t.ServerId===e.ServerId&&(o=!0)})),o||t.push(e)}else{var r=!1,l=-1;t.forEach((function(t,a){t.ServerId===e.ServerId&&(r=!0,l=a)})),r&&t.splice(l,1)}},undeployServer:function(){var e=this,t=this.checkedList.filter((function(e){return e.isChecked}));if(t.length<=0)this.$tip.warning(this.$t("dialog.tips.item"));else{var a=t.map((function(e){return e.ServerId}));this.$confirm(this.$t("serverList.dlg.msg.undeploy"),this.$t("common.alert")).then((function(){var t=e.$Loading.show();e.$ajax.postJSON("/k8s/api/server_undeploy",{ServerId:a}).then((function(a){t.hide(),e.fetchData(),e.$tip.success(e.$t("common.success"))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.err_msg||a.message))}))}))}}}},Gt=Zt,Qt=(a("4e15"),Object(w["a"])(Gt,Yt,Ut,!1,null,null,null)),Xt=Qt.exports,ea=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_templates"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.template_name,callback:function(t){e.$set(e.query,"template_name",t)},expression:"query.template_name"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.parents_name,callback:function(t){e.$set(e.query,"parents_name",t)},expression:"query.parents_name"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addTempate")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.template"),prop:"TemplateName",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("template.search.parentTemplate"),prop:"TemplateParent",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("cfg.btn.lastUpdate"),prop:"UpdateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("template.add.title"):this.$t("template.update.title"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.template"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("template.add.templateFormatTips"),required:"","required-tip":e.$t("template.add.templateNameTips"),pattern:"^[a-zA-Z]([.a-zA-Z0-9]+)?$","pattern-tip":e.$t("template.add.templateFormatTips")},model:{value:e.detailModal.model.TemplateName,callback:function(t){e.$set(e.detailModal.model,"TemplateName",t)},expression:"detailModal.model.TemplateName"}})],1),a("let-form-item",{attrs:{label:e.$t("template.search.parentTemplate"),required:""}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateParent,callback:function(t){e.$set(e.detailModal.model,"TemplateParent",t)},expression:"detailModal.model.TemplateParent"}},[a("let-option",{attrs:{value:""}},[e._v(e._s(e.$t("pub.dlg.defaultValue")))]),e._l(e.items,(function(t){return a("let-option",{key:t.id,attrs:{value:t.TemplateName}},[e._v(e._s(t.TemplateName))])}))],2)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceMark")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.serviceMark")},model:{value:e.detailModal.model.CreateMark,callback:function(t){e.$set(e.detailModal.model,"CreateMark",t)},expression:"detailModal.model.CreateMark"}})],1),a("let-form-item",{attrs:{label:e.$t("template.form.content"),required:""}},[a("let-input",{attrs:{type:"textarea",rows:10,size:"small",required:"","required-tip":e.$t("deployService.table.tips.empty")},model:{value:e.detailModal.model.TemplateContent,callback:function(t){e.$set(e.detailModal.model,"TemplateContent",t)},expression:"detailModal.model.TemplateContent"}})],1)],1):e._e()],1)],1)},ta=[],aa={name:"OperationTemplates",data:function(){return{query:{template_name:"",parents_name:""},items:[],viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/template_select",{TemplateName:this.query.template_name,ParentName:this.query.parents_name}).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.UpdateTime=E()(e.UpdateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=t.TemplateId?"/k8s/api/template_update":"/k8s/api/template_create",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/template_delete",{TemplateId:e.TemplateId}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))}}},oa=aa,ra=(a("3976"),Object(w["a"])(oa,ea,ta,!1,null,null,null)),la=ra.exports,ia=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_operation_approval"},[a("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[a("div",[a("span",[e._v(e._s(e.$t("deployService.title.baseImage")))]),a("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addItem}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),a("let-table",{ref:"table",attrs:{data:e.baseLists,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("imageService.form.SupportedType"),prop:"SupportedTypeShow"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Count"),prop:"Count",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(e._s(e.$t("operate.view")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),a("el-card",{staticStyle:{"margin-top":"10px",padding:"15px"}},[a("div",[a("span",[e._v(e._s(e.$t("deployService.title.nodeImage")))]),a("el-button",{staticStyle:{float:"right","margin-bottom":"10px"},attrs:{type:"primary",size:"small"},on:{click:e.addNodeImage}},[e._v(e._s(e.$t("imageService.btn.add"))+" ")])],1),a("let-table",{ref:"table",attrs:{data:e.tafNodeImages,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:"ID"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{color:"green",display:"inline-block"},attrs:{title:e.$t("releasePackage.default")}},[t.row.isDefault?a("i",{staticClass:"icon iconfont"},[e._v("")]):e._e()]),e._v(" "+e._s(t.row.Id)+" ")]}}])}),a("let-table-column",{attrs:{title:e.$t("pub.dlg.imageAddress"),prop:"Image"}}),a("let-table-column",{attrs:{title:e.$t("pub.dlg.mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editNodeImage(t.row)}}},[e._v(e._s(e.$t("operate.update"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.setDefault(t.row)}}},[e._v(e._s(e.$t("operate.default"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.deleteNodeImage(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}])})],1)],1),a("let-modal",{attrs:{title:e.baseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.baseModal.show,callback:function(t){e.$set(e.baseModal,"show",t)},expression:"baseModal.show"}},[e.baseModal.model?a("let-form",{ref:"detailForm",attrs:{inline:""}},[a("let-form-item",{attrs:{label:e.$t("imageService.form.SupportedType"),itemWidth:"600px",required:""}},e._l(e.SupportedType,(function(t){return a("let-checkbox",{key:t,attrs:{value:e.baseModal.model.SupportedType.indexOf(t)>-1},on:{change:function(a){return e.SupportedTypeChange(t)}}},[e._v(" "+e._s(t)+" ")])})),1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.baseModal.model.Mark,callback:function(t){e.$set(e.baseModal.model,"Mark",t)},expression:"baseModal.model.Mark"}})],1)],1):e._e()],1),a("let-modal",{attrs:{footShow:!1,title:this.$t("imageService.title.view"),width:"80%"},model:{value:e.releaseListsModal.show,callback:function(t){e.$set(e.releaseListsModal,"show",t)},expression:"releaseListsModal.show"}},[a("br"),e.releaseListsModal.model?a("let-table",{ref:"table",attrs:{data:e.releaseListsModal.model,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("imageService.form.Image"),prop:"Image",width:"40%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreatePerson"),prop:"CreatePerson",width:"10%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.CreateTime"),prop:"CreateTime",width:"15%"}}),a("let-table-column",{attrs:{title:e.$t("imageService.form.Mark"),prop:"Mark"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.view"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.removeReleaseItem(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,3590708250)})],1):e._e()],1),a("let-modal",{attrs:{title:e.releaseModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"600px"},on:{"on-confirm":e.saveReleaseItem,"on-cancel":e.closeReleaseModal},model:{value:e.releaseModal.show,callback:function(t){e.$set(e.releaseModal,"show",t)},expression:"releaseModal.show"}},[e.releaseModal.model?a("let-form",{ref:"releaseForm"},[a("let-form-item",{attrs:{label:e.$t("imageService.form.Image"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.ImageHolder"),required:"","required-tip":e.$t("imageService.form.ImageTips")},model:{value:e.releaseModal.model.Image,callback:function(t){e.$set(e.releaseModal.model,"Image",t)},expression:"releaseModal.model.Image"}})],1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Secret")}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.SecretTips"),required:"","required-tip":e.$t("imageService.form.SecretTips")},model:{value:e.releaseModal.model.Secret,callback:function(t){e.$set(e.releaseModal.model,"Secret",t)},expression:"releaseModal.model.Secret"}})],1),a("let-form-item",{attrs:{label:e.$t("imageService.form.Mark"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("imageService.form.Mark")},model:{value:e.releaseModal.model.Mark,callback:function(t){e.$set(e.releaseModal.model,"Mark",t)},expression:"releaseModal.model.Mark"}})],1)],1):e._e()],1),a("el-dialog",{attrs:{title:e.nodeImageModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),visible:e.nodeImageModal.show,width:"600px","before-close":e.closeNodeModal,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.nodeImageModal,"show",t)}}},[a("el-form",{ref:"nodeForm",attrs:{model:e.nodeImageModal.model,size:"small","label-position":"top",rules:e.rules}},[a("el-form-item",{attrs:{label:"Id",prop:"Id"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Id,callback:function(t){e.$set(e.nodeImageModal.model,"Id",t)},expression:"nodeImageModal.model.Id"}})],1),a("el-form-item",{attrs:{label:e.$t("pub.dlg.imageAddress"),prop:"Image"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Image,callback:function(t){e.$set(e.nodeImageModal.model,"Image",t)},expression:"nodeImageModal.model.Image"}})],1),a("el-form-item",{attrs:{label:e.$t("pub.dlg.mark"),prop:"Mark"}},[a("el-input",{staticStyle:{width:"80%"},model:{value:e.nodeImageModal.model.Mark,callback:function(t){e.$set(e.nodeImageModal.model,"Mark",t)},expression:"nodeImageModal.model.Mark"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeNodeModal}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveNodeModal}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],1)},sa=[],na=(a("a15b"),{name:"OperationImage",data:function(){return{baseLists:[],tafNodeImages:[],SupportedType:["cpp","nodejs","java-war","java-jar","go"],baseModal:{show:!1,model:null,isNew:!1},releaseListsModal:{Name:"",show:!1,model:null,isNew:!1},releaseModal:{Name:"",show:!1,model:null,isNew:!1},nodeImageModal:{show:!1,model:{},isNew:!1},rules:{Id:[{required:!0,message:"".concat(this.$t("imageService.node.idTip")),trigger:"blur"}],Image:[{required:!0,message:"".concat(this.$t("imageService.node.imageAddressTip")),trigger:"blur"}],Mark:[{required:!0,message:"".concat(this.$t("imageService.node.markTip")),trigger:"blur"}]}}},mounted:function(){this.fetchData(),this.getTafNodeList()},methods:{fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_select",{}).then((function(a){t.hide(),e.baseLists=a.Data,e.baseLists.forEach((function(e){e.SupportedTypeShow=e.SupportedType.join(", "),e.CreateTime=E()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},SupportedTypeChange:function(e){this.baseModal.model.SupportedType.indexOf(e)>-1?this.baseModal.model.SupportedType.splice(this.baseModal.model.SupportedType.indexOf(e),1):this.baseModal.model.SupportedType.push(e)},addItem:function(){this.baseModal.model={SupportedType:[]},this.baseModal.show=!0,this.baseModal.isNew=!0},fetchReleaseData:function(e){var t=this,a=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/image_release_select",{Name:e}).then((function(o){a.hide(),t.releaseListsModal.Name=e,t.releaseListsModal.model=o.Data,t.releaseListsModal.model.forEach((function(t){t.CreateTime=E()(t.CreateTime).format("YYYY-MM-DD HH:mm:ss"),t.Name=e}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},viewItem:function(e){var t=this;this.fetchReleaseData(e.Name).then((function(){t.releaseListsModal.show=!0}))},editItem:function(e){this.baseModal.model=e,this.baseModal.show=!0,this.baseModal.isNew=!1},removeItem:function(e){var t=this,a=this.$refs.table.$loading.show();this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){return t.$ajax.postJSON("/k8s/api/image_delete",{Name:e.Name}).then((function(e){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.baseModal.show=!1,this.baseModal.model=null},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.baseModal.model,a=this.$Loading.show(),o=t.Name?"/k8s/api/image_update":"/k8s/api/image_create";this.$ajax.postJSON(o,t).then((function(){a.hide(),e.fetchData().then((function(){e.baseModal.show=!1,e.$tip.success(e.$t("common.success"))}))})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},addReleaseItem:function(e){this.releaseModal.model={Name:e},this.releaseModal.show=!0,this.releaseModal.isNew=!0},closeReleaseModal:function(){this.$refs.releaseForm.resetValid(),this.releaseModal.show=!1,this.releaseModal.model=null},editReleaseItem:function(e){this.releaseModal.model=e,this.releaseModal.show=!0,this.releaseModal.isNew=!1},removeReleaseItem:function(e){var t=this;this.$confirm(this.$t("imageService.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/image_release_delete",{Name:e.Name,Id:e.Id}).then((function(){a.hide(),t.fetchReleaseData(e.Name).then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},saveReleaseItem:function(){var e=this;if(this.$refs.releaseForm.validate()){var t=this.releaseModal.model,a=this.$Loading.show();this.$ajax.postJSON("/k8s/api/image_release_create",t).then((function(){a.hide(),e.$tip.success(e.$t("common.success")),e.fetchReleaseData(t.Name),e.releaseModal.show=!1})).catch((function(t){a.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},getTafNodeList:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getDefaultNodeImage();case 2:a=t.sent,e.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){t.Data.forEach((function(e){e.Image==a&&(e.isDefault=!0)})),e.tafNodeImages=t.Data})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}));case 4:case"end":return t.stop()}}),t)})))()},getDefaultNodeImage:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/get_tfc");case 2:return a=t.sent,o=a.filter((function(e){return"nodeImage.image"===e.column})),t.abrupt("return",1==o.length?o[0].value:"");case 5:case"end":return t.stop()}}),t)})))()},setDefault:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",{column:"nodeImage.image",value:e.Image}).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},addNodeImage:function(){this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!0},editNodeImage:function(e){this.nodeImageModal.model=Object.assign({},e),this.nodeImageModal.show=!0,this.nodeImageModal.isNew=!1},saveNodeModal:function(){var e=this;this.$refs.nodeForm.validate((function(t){if(!t)return!1;e.$ajax.postJSON("/k8s/api/image_node_update",e.nodeImageModal.model).then((function(t){e.closeNodeModal(),e.getTafNodeList(),e.$message.success("".concat(e.$t("common.success")))})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}))},deleteNodeImage:function(e){var t=this;if(e.isDefault)this.$message.warning("".concat(this.$t("imageService.node.deleteTip")));else{var a=Object.assign({},e);this.$ajax.postJSON("/k8s/api/image_node_delete",a).then((function(e){t.getTafNodeList(),t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$message.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))}},closeNodeModal:function(){this.nodeImageModal.show=!1,this.nodeImageModal.model={},this.$refs.nodeForm.resetFields()}}}),ca=na,da=(a("c914"),a("c3f0"),Object(w["a"])(ca,ia,sa,!1,null,"4ad5a006",null)),pa=da.exports,ua=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_affinity"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("filter.title.node")}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.query.NodeName,callback:function(t){e.$set(e.query,"NodeName",t)},expression:"query.NodeName"}},e._l(e.NodeList,(function(t){return a("let-option",{key:t.NodeName,attrs:{value:t.NodeName}},[e._v(e._s(t.NodeNameShow))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},on:{change:e.changeApp},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}},e._l(e.AppList,(function(t){return a("let-option",{key:t.ServerApp,attrs:{value:t.ServerApp}},[e._v(e._s(t.AppNameShow))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("filter.title.serverName")}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}},e._l(e.ServerNameList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1)],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("filter.btn.addAffinity")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("filter.title.app")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table_con"},[a("let-tag",{attrs:{theme:"success",checked:""}},[e._v(e._s(e._f("showTag")(t.row)))])],1)]}}])}),a("let-table-column",{attrs:{title:e.$t("filter.title.node")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table_con"},e._l(t.row.NodeName,(function(t){return a("let-tag",{key:t,attrs:{value:t,theme:"success",checked:""}},[e._v(e._s(t)+" ")])})),1)]}}])}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),t.row.del?a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete"))+" ")]):e._e()]}}])})],1),a("let-modal",{attrs:{title:this.$t("filter.title.node"),width:"800px"},on:{"on-confirm":e.addServerItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("filter.title.app"),required:""}},[e.detailModal.isNew?a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue"),required:""},on:{change:e.changeApp},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}},e._l(e.AppList,(function(t){return a("let-option",{key:t.ServerApp,attrs:{value:t.ServerApp}},[e._v(e._s(t.ServerApp))])})),1):e._e(),e.detailModal.isNew?e._e():a("let-input",{attrs:{size:"small",disabled:""},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.serverName")}},[e.detailModal.isNew?a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.detailModal.model.ServerName,callback:function(t){e.$set(e.detailModal.model,"ServerName",t)},expression:"detailModal.model.ServerName"}},e._l(e.detailModal.ServerNameList,(function(t){return a("let-option",{key:t,attrs:{value:t}},[e._v(e._s(t))])})),1):e._e(),e.detailModal.isNew?e._e():a("let-input",{attrs:{size:"small",disabled:""},model:{value:e.detailModal.model.ServerName,callback:function(t){e.$set(e.detailModal.model,"ServerName",t)},expression:"detailModal.model.ServerName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.node")}},[a("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}},[e._v(e._s(e.$t("cache.config.allSelected")))]),a("div",{staticClass:"checkbox_list"},e._l(e.NodeList,(function(t){return a("let-checkbox",{key:t.NodeName,staticClass:"checkbox_item",staticStyle:{"margin-right":"15px"},attrs:{value:e.detailModal.model.checkBoxAddList.indexOf(t.NodeName)>-1},on:{change:function(a){return e.checkedChange(t.NodeName)}}},[e._v(e._s(t.NodeName)+" ")])})),1)],1)],1):e._e()],1)],1)},ma=[],fa={name:"BaseAffinityServer",data:function(){return{isCheckedAll:!1,query:{NodeName:"",ServerApp:"",ServerName:""},totalPage:0,pageSize:20,page:1,items:[],AppList:[],NodeList:[],ServerNameList:[],viewModal:{show:!1,model:null},detailModal:{ServerNameList:[],show:!1,model:{checkBoxAddList:[],checkBoxDelList:[]},isNew:!1}}},filters:{showTag:function(e){return e.ServerName?e.ServerApp+"."+e.ServerName:e.ServerApp}},mounted:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getAppList();case 2:e.fetchData(),e.getNodeList();case 4:case"end":return t.stop()}}),t)})))()},watch:{isCheckedAll:function(){var e=this,t=this.isCheckedAll;t?this.NodeList.forEach((function(t){-1===e.detailModal.model.checkBoxAddList.indexOf(t.NodeName)&&e.detailModal.model.checkBoxAddList.push(t.NodeName),e.detailModal.model.checkBoxDelList=[]})):this.NodeList.forEach((function(t){-1===e.detailModal.model.checkBoxDelList.indexOf(t.NodeName)&&e.detailModal.model.checkBoxDelList.push(t.NodeName),e.detailModal.model.checkBoxAddList=[]}))}},methods:{checkedChange:function(e){-1===this.detailModal.model.checkBoxAddList.indexOf(e)?(this.detailModal.model.checkBoxAddList.push(e),this.detailModal.model.checkBoxDelList.splice(this.detailModal.model.checkBoxDelList.indexOf(e),1)):(this.detailModal.model.checkBoxDelList.push(e),this.detailModal.model.checkBoxAddList.splice(this.detailModal.model.checkBoxAddList.indexOf(e),1)),0===this.detailModal.model.checkBoxAddList.length&&(this.isCheckedAll=!1)},changePage:function(e){this.page=e},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/affinity_list_server",this.query).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(t){t.del=!e.AppList.find((function(e){return e.ServerApp==t.ServerApp}))}))})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.changePage(1),this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={checkBoxAddList:[],checkBoxDelList:[],ServerName:"",ServerApp:""},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.model.checkBoxAddList=JSON.parse(JSON.stringify(e.NodeName||[])),this.detailModal.model.checkBoxDelList=[],this.detailModal.show=!0,this.detailModal.isNew=!1},addServerItem:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$refs.detailForm.validate()){t.next=17;break}if(a=e.detailModal.model,o=e.$Loading.show(),t.prev=3,!(a.checkBoxDelList&&a.checkBoxDelList.length>0)){t.next=7;break}return t.next=7,e.$ajax.postJSON("/k8s/api/affinity_del_node",{ServerApp:a.ServerApp,NodeName:a.checkBoxDelList,Force:"true"});case 7:return t.next=9,e.$ajax.postJSON("/k8s/api/affinity_add_node",{ServerApp:a.ServerApp,ServerName:a.ServerName,NodeName:a.checkBoxAddList}).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}));case 9:t.next=17;break;case 11:t.prev=11,t.t0=t["catch"](3),o.hide(),e.closeDetailModal(),e.fetchData(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.t0.message||t.t0.err_msg));case 17:case"end":return t.stop()}}),t,null,[[3,11]])})))()},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.postJSON("/k8s/api/affinity_del_node",{ServerApp:e.ServerApp,NodeName:e.NodeName,ServerName:e.ServerName,Force:"false"}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getAppList:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$ajax.getJSON("/k8s/api/application_select",{});case 2:a=t.sent,e.AppList=[],a.Data.forEach((function(t){t.AppNameShow=t.ServerApp,e.AppList.push(t)}));case 5:case"end":return t.stop()}}),t)})))()},getServerList:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){var o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 2:return o=a.sent,r=o.Data.map((function(e){return e.ServerName})),a.abrupt("return",r);case 5:case"end":return a.stop()}}),a)})))()},changeApp:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!t.detailModal.show){a.next=7;break}return a.next=3,t.getServerList(e);case 3:t.detailModal.ServerNameList=a.sent,t.$nextTick((function(){t.detailModal.model.ServerName=""})),a.next=11;break;case 7:return t.query.ServerName="",a.next=10,t.getServerList(e);case 10:t.ServerNameList=a.sent;case 11:case"end":return a.stop()}}),a)})))()},getNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/node_select",{}).then((function(t){e.NodeList=[],t.Data.forEach((function(t){t.NodeNameShow=t.NodeName,e.NodeList.push(t)}))}))}}},ha=fa,va=(a("5dd2"),Object(w["a"])(ha,ua,ma,!1,null,null,null)),ga=va.exports,ba=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_application"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("template.btn.addApplication")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("deployService.form.app"),prop:"ServerApp",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.business"),prop:"BusinessName",width:"25%"}}),a("let-table-column",{attrs:{title:e.$t("deployService.form.appMark"),prop:"AppMark"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createTime"),prop:"CreateTime"}}),a("let-table-column",{attrs:{title:e.$t("serverList.table.th.createPerson"),prop:"CreatePerson"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("deployService.form.app"),required:""}},[a("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:"","required-tip":e.$t("deployService.form.appTips"),pattern:"^[a-zA-Z0-9]+$","pattern-tip":e.$t("deployService.form.placeholder")},model:{value:e.detailModal.model.ServerApp,callback:function(t){e.$set(e.detailModal.model,"ServerApp",t)},expression:"detailModal.model.ServerApp"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.business")}},[a("let-select",{attrs:{size:"small",placeholder:e.$t("pub.dlg.defaultValue")},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}},e._l(e.BusinessList,(function(t){return a("let-option",{key:t.BusinessName,attrs:{value:t.BusinessName}},[e._v(e._s(t.BusinessShow))])})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.appMark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.AppMark,callback:function(t){e.$set(e.detailModal.model,"AppMark",t)},expression:"detailModal.model.AppMark"}})],1)],1):e._e()],1)],1)},$a=[],Sa={name:"BaseApplication",data:function(){return{query:{ServerApp:"",BusinessName:""},items:[],BusinessList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData(),this.getBusinessList()},methods:{gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/application_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.items.forEach((function(e){e.CreateTime=E()(e.CreateTime).format("YYYY-MM-DD HH:mm:ss")})),e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},addItem:function(){this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/application_create":"/k8s/api/application_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/application_delete",{ServerApp:e.ServerApp}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getBusinessList:function(){var e=this;this.$ajax.getJSON("/k8s/api/business_select",{isAll:!0}).then((function(t){e.BusinessList=[{BusinessMark:"",BusinessName:"",BusinessOrder:0,BusinessShow:"",CreatePerson:"",CreateTime:new Date}].concat(t.Data)}))}}},ya=Sa,_a=(a("5de2"),Object(w["a"])(ya,ba,$a,!1,null,null,null)),ka=_a.exports,wa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_business"},[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessName,callback:function(t){e.$set(e.query,"BusinessName",t)},expression:"query.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessShow,callback:function(t){e.$set(e.query,"BusinessShow",t)},expression:"query.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.query.BusinessMark,callback:function(t){e.$set(e.query,"BusinessMark",t)},expression:"query.BusinessMark"}})],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("operate.search")))]),e._v(" "),a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.addItem}},[e._v(e._s(e.$t("filter.btn.add")))])],1)],1),a("let-table",{ref:"table",attrs:{data:e.items,"empty-msg":e.$t("common.nodata")}},[a("let-table-column",{attrs:{title:e.$t("filter.title.business"),prop:"BusinessName",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.name"),prop:"BusinessShow",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.mark"),prop:"BusinessMark",width:"20%"}}),a("let-table-column",{attrs:{title:e.$t("filter.title.order"),prop:"BusinessOrder"}}),a("let-table-column",{attrs:{title:e.$t("operate.operates"),width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.appListItem(t.row)}}},[e._v(e._s(e.$t("table.btn.appList")))]),a("let-table-operation",{on:{click:function(a){return e.editItem(t.row)}}},[e._v(e._s(e.$t("operate.update")))]),a("let-table-operation",{on:{click:function(a){return e.removeItem(t.row)}}},[e._v(e._s(e.$t("operate.delete")))])]}}])})],1),a("div",{staticStyle:{overflow:"hidden"}},[a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}})],1),a("let-modal",{attrs:{title:e.$t("template.view.title"),width:"800px"},model:{value:e.viewModal.show,callback:function(t){e.$set(e.viewModal,"show",t)},expression:"viewModal.show"}},[e.viewModal.model?a("pre",[e._v(e._s(e.viewModal.model.TemplateContent))]):e._e(),a("div",{attrs:{slot:"foot"},slot:"foot"})]),a("let-modal",{attrs:{title:e.detailModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.saveItem,"on-cancel":e.closeDetailModal},model:{value:e.detailModal.show,callback:function(t){e.$set(e.detailModal,"show",t)},expression:"detailModal.show"}},[e.detailModal.model?a("let-form",{ref:"detailForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[a("let-input",{attrs:{disabled:!e.detailModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessName,callback:function(t){e.$set(e.detailModal.model,"BusinessName",t)},expression:"detailModal.model.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[a("let-input",{attrs:{size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.detailModal.model.BusinessShow,callback:function(t){e.$set(e.detailModal.model,"BusinessShow",t)},expression:"detailModal.model.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.order"),required:""}},[a("let-input",{attrs:{size:"small",type:"number",min:0,max:100,required:""},model:{value:e.detailModal.model.BusinessOrder,callback:function(t){e.$set(e.detailModal.model,"BusinessOrder",t)},expression:"detailModal.model.BusinessOrder"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.mark")}},[a("let-input",{attrs:{size:"small"},model:{value:e.detailModal.model.BusinessMark,callback:function(t){e.$set(e.detailModal.model,"BusinessMark",t)},expression:"detailModal.model.BusinessMark"}})],1)],1):e._e()],1),a("let-modal",{attrs:{title:e.AppModal.isNew?this.$t("dialog.title.add"):this.$t("dialog.title.edit"),width:"800px"},on:{"on-confirm":e.appListSaveItem,"on-cancel":e.closeAppModal},model:{value:e.AppModal.show,callback:function(t){e.$set(e.AppModal,"show",t)},expression:"AppModal.show"}},[e.AppModal.model?a("let-form",{ref:"AppForm",attrs:{itemWidth:"700px"}},[a("let-form-item",{attrs:{label:e.$t("filter.title.business"),required:""}},[a("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessName,callback:function(t){e.$set(e.AppModal.model,"BusinessName",t)},expression:"AppModal.model.BusinessName"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.name"),required:""}},[a("let-input",{attrs:{disabled:!e.AppModal.isNew,size:"small",placeholder:e.$t("deployService.form.placeholder"),required:""},model:{value:e.AppModal.model.BusinessShow,callback:function(t){e.$set(e.AppModal.model,"BusinessShow",t)},expression:"AppModal.model.BusinessShow"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[a("let-checkbox",{attrs:{value:e.isCheckedAll},model:{value:e.isCheckedAll,callback:function(t){e.isCheckedAll=t},expression:"isCheckedAll"}},[e._v("全选")]),a("div",{staticClass:"checkbox_list"},e._l(e.AppList,(function(t){return a("let-checkbox",{key:t.ServerApp,staticClass:"checkbox_item",attrs:{value:e.checkBoxAddList.indexOf(t.ServerApp)>-1},on:{change:function(a){return e.checkedChange(t.ServerApp)}}},[e._v(e._s(t.ServerApp))])})),1)],1)],1):e._e()],1)],1)},Ma=[],xa={name:"BaseBusiness",data:function(){return{isCheckedAll:!1,checkBoxAddList:[],checkBoxDelList:[],query:{BusinessName:"",BusinessShow:"",BusinessMark:""},items:[],AppList:[],pagination:{page:1,size:10,total:1},viewModal:{show:!1,model:null},detailModal:{show:!1,model:null,isNew:!1},AppServerArr:[],AppServerStr:"",AppServerDeleteArr:[],AppModal:{show:!1,model:null,isNew:!1}}},mounted:function(){this.fetchData()},watch:{isCheckedAll:function(){var e=this,t=this.isCheckedAll;t?this.AppList.forEach((function(t){-1===e.checkBoxAddList.indexOf(t.ServerApp)&&e.checkBoxAddList.push(t.ServerApp),e.checkBoxDelList=[]})):this.AppList.forEach((function(t){-1===e.checkBoxDelList.indexOf(t.ServerApp)&&e.checkBoxDelList.push(t.ServerApp),e.checkBoxAddList=[]}))}},methods:{checkedChange:function(e){-1===this.checkBoxAddList.indexOf(e)?(this.checkBoxAddList.push(e),this.checkBoxDelList.splice(this.checkBoxDelList.indexOf(e),1)):(this.checkBoxDelList.push(e),this.checkBoxAddList.splice(this.checkBoxAddList.indexOf(e),1)),0===this.checkBoxAddList.length&&(this.isCheckedAll=!1)},gotoPage:function(e){this.pagination.page=e,this.fetchData()},fetchData:function(){var e=this,t=this.$refs.table.$loading.show();return this.$ajax.getJSON("/k8s/api/business_select",Object.assign(this.query,{isAll:!1,page:this.pagination.page,size:this.pagination.size})).then((function(a){t.hide(),e.items=a.Data,e.pagination.total=Math.ceil(a.Count.AllCount/e.pagination.size)})).catch((function(a){t.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(a.message||a.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},closeDetailModal:function(){this.$refs.detailForm.resetValid(),this.detailModal.show=!1,this.detailModal.model=null},closeAppModal:function(){this.$refs.AppForm.resetValid(),this.AppModal.show=!1,this.AppModal.model=null},addItem:function(){this.checkBoxAddList=[],this.detailModal.model={},this.detailModal.show=!0,this.detailModal.isNew=!0},viewItem:function(e){this.viewModal.model=e,this.viewModal.show=!0},editItem:function(e){this.checkBoxAddList=e.AppServer||[],this.detailModal.model=e,this.detailModal.show=!0,this.detailModal.isNew=!1},saveItem:function(){var e=this;if(this.$refs.detailForm.validate()){var t=this.detailModal.model,a=this.detailModal.isNew?"/k8s/api/business_create":"/k8s/api/business_update",o=this.$Loading.show();this.$ajax.postJSON(a,t).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeDetailModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},removeItem:function(e){var t=this;this.$confirm(this.$t("template.delete.confirmTips"),this.$t("common.alert")).then((function(){var a=t.$Loading.show();t.$ajax.getJSON("/k8s/api/business_delete",{BusinessName:e.BusinessName}).then((function(){a.hide(),t.fetchData().then((function(){t.$tip.success(t.$t("common.success"))}))})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))})).catch((function(){}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{isAll:!0}).then((function(t){e.AppList=t.Data}))},appListItem:function(e){var t=this;this.getAppList();var a=this.$refs.table.$loading.show();return this.$ajax.postJSON("/k8s/api/business_list_app",{BusinessNames:[e.BusinessName]}).then((function(e){a.hide(),t.appListEditItem(e[0])})).catch((function(e){a.hide(),t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},appListEditItem:function(e){this.checkBoxAddList=e.App||[],this.AppModal.model=e,this.AppModal.show=!0,this.AppModal.isNew=!1},appListSaveItem:function(){var e=this;if(this.$refs.AppForm.validate()){var t=this.AppModal.model,a=(this.AppModal.isNew,"/k8s/api/business_add_app"),o=this.$Loading.show();this.checkBoxAddList&&this.checkBoxAddList.length>0?this.$ajax.postJSON(a,{BusinessName:t.BusinessName,AppNames:this.checkBoxAddList}).then((function(){o.hide(),e.$tip.success(e.$t("common.success")),e.closeAppModal(),e.fetchData()})).catch((function(t){o.hide(),e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))})):(o.hide(),this.closeAppModal())}}}},Na=xa,Ca=(a("b50eb"),Object(w["a"])(Na,wa,Ma,!1,null,null,null)),Ta=Ca.exports,La=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_base_node"},[e.showDetail?e._e():[a("let-form",{attrs:{inline:"",itemWidth:"200px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{attrs:{label:e.$t("filter.title.node")}},[a("el-input",{attrs:{size:"small"},model:{value:e.query.NodeName,callback:function(t){e.$set(e.query,"NodeName",t)},expression:"query.NodeName"}})],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.app")}},[a("el-select",{attrs:{clearable:"",size:"small",filterable:""},on:{change:e.queryAppChange},model:{value:e.query.ServerApp,callback:function(t){e.$set(e.query,"ServerApp",t)},expression:"query.ServerApp"}},e._l(e.appList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("deployService.form.serviceName")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",size:"small"},model:{value:e.query.ServerName,callback:function(t){e.$set(e.query,"ServerName",t)},expression:"query.ServerName"}},e._l(e.serList,(function(e){return a("el-option",{key:e,attrs:{label:e,filterable:"",value:e}})})),1)],1),a("let-form-item",[a("let-button",{attrs:{size:"small",type:"submit",theme:"primary"}},[e._v(e._s(e.$t("filter.btn.searchAffinity")))])],1),a("let-form-item",{attrs:{itemWidth:"600px"}},[a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain"}},[e._v(" "+e._s(e.$t("filter.title.CommonTag"))+" ")]),a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{effect:"plain",type:"warning"}},[e._v(" "+e._s(e.$t("filter.title.FrameWorkTag"))+" ")])],1),a("div",{staticStyle:{float:"right","margin-top":"30px"}},[a("let-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditCommon}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),a("let-button",{attrs:{size:"small",type:"submit",theme:"primary",disabled:!e.batchEnabled},on:{click:e.batchEditAffinity}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])],1)],1),a("br"),a("el-table",{ref:"table",attrs:{data:e.items,width:"100%",border:"",stripe:"","highlight-current-row":""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeName"),prop:"NodeName",width:"150"}}),a("el-table-column",{attrs:{label:e.$t("common.status"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["Active"==t.row.status?a("el-tag",{attrs:{size:"small",effect:"plain",type:"success"}},[e._v(" "+e._s(t.row.status)+" ")]):e._e(),"Unavailable"==t.row.status?a("el-tag",{attrs:{size:"small",effect:"plain",type:"danger"}},[e._v(" "+e._s(t.row.status)+" ")]):e._e()]}}],null,!1,3672167682)}),a("el-table-column",{attrs:{label:"Version",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.NodInfo.kubeletVersion)+" ")]}}],null,!1,2972685414)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeFramework"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-switch",{on:{change:function(a){return e.changeStatus(t.row)}},model:{value:t.row.NodePublic,callback:function(a){e.$set(t.row,"NodePublic",a)},expression:"scope.row.NodePublic"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("开")]),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("关")])])]}}],null,!1,1705370074)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeLabels")},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.commonLabels,(function(t,o){return a("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+t)+" ")])}))}}],null,!1,2926056322)}),a("el-table-column",{attrs:{label:e.$t("filter.title.AbilityTag"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.NodeAbility,(function(t){return a("el-tag",{key:t,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("abilityType")(t)}},[e._v(" "+e._s(t)+" ")])}))}}],null,!1,3467388542)}),a("el-table-column",{attrs:{label:e.$t("filter.title.nodeAddress"),width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.NodeAddress,(function(t){return a("div",{key:t.NodeName,staticStyle:{margin:"2px 2px"}},[a("el-tag",{attrs:{effect:"plain",type:"info"}},[e._v(e._s(t.type+":"+t.address)+" ")])],1)}))}}],null,!1,402632902)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.viewItem(t.row)}}},[e._v(" "+e._s(e.$t("operate.view"))+" ")]),a("br"),a("let-table-operation",{on:{click:function(a){return e.editCommonTag(t.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editTag"))+" ")]),a("br"),a("let-table-operation",{on:{click:function(a){return e.editAbilityTag(t.row)}}},[e._v(" "+e._s(e.$t("filter.btn.editAffinity"))+" ")])]}}],null,!1,1007266554)})],1),a("br"),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.gotoPage}}),a("el-dialog",{attrs:{title:e.$t("filter.dialog.editCommonTag"),visible:e.commonTagDialog.show,width:"40%","before-close":e.closeCommonTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.commonTagDialog,"show",t)}}},[a("el-form",{ref:"commonForm",attrs:{model:e.commonTagDialog.model,"inline-message":""}},[a("el-table",{attrs:{data:e.commonTagDialog.model.commonArr,border:""}},[a("template",{slot:"empty"},[a("let-table-operation",{on:{click:function(t){return e.addCommonTag(0,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("deployService.form.labelMatch.addLabel"))+" ")])],1),a("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"commonArr."+t.$index+".name",rules:[{validator:function(a,o,r){e.validateTagName(a,o,r,t.row.name)},trigger:"blur"}]}},[a("el-input",{model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})],1)]}}],null,!1,1739047982)}),a("el-table-column",{attrs:{label:e.$t("filter.title.tagName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}],null,!1,4065949250)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.addCommonTag(t.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.delCommonTag(t.$index,e.commonTagDialog.model.commonArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2871227552)})],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeCommonTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCommonTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1),a("el-dialog",{attrs:{title:e.$t("filter.dialog.editAbilityTag"),visible:e.abilityTagDialog.show,width:"40%","before-close":e.closeAbilityTagDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.abilityTagDialog,"show",t)}}},[a("el-form",{ref:"abilityForm",attrs:{model:e.abilityTagDialog.model,"inline-message":""}},[a("el-table",{attrs:{data:e.abilityTagDialog.model.abilityArr,border:""}},[a("template",{slot:"empty"},[a("let-table-operation",{on:{click:function(t){return e.addAbilityTag(0,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("filter.tip.addAffinityGroup"))+" ")])],1),a("el-table-column",{attrs:{label:e.$t("filter.title.app")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"abilityArr."+t.$index+".application",rules:[{validator:function(a,o,r){e.validateAppName(a,o,r,t.row.application)},trigger:"change"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),filterable:""},on:{change:function(a){return e.changeApp(t.$index,t.row.application)}},model:{value:t.row.application,callback:function(a){e.$set(t.row,"application",a)},expression:"scope.row.application"}},e._l(e.appList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)]}}],null,!1,3541109157)}),a("el-table-column",{attrs:{label:e.$t("filter.title.serverName")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",filterable:""},model:{value:t.row.serverName,callback:function(a){e.$set(t.row,"serverName",a)},expression:"scope.row.serverName"}},e._l(t.row.serverNames,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)]}}],null,!1,695734775)}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.addAbilityTag(t.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.add"))+" ")]),a("let-table-operation",{on:{click:function(a){return e.delAbilityTag(t.$index,e.abilityTagDialog.model.abilityArr)}}},[e._v(" "+e._s(e.$t("operate.delete"))+" ")])]}}],null,!1,2609683168)})],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeAbilityTagDialog}},[e._v(e._s(e.$t("common.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveAbilityTag}},[e._v(e._s(e.$t("common.submit")))])],1)],1)],e.showDetail?a("node-detail",{attrs:{nodeDetail:e.nodeDetail},on:{closeDetail:e.closeDetail}}):e._e()],2)},Aa=[],Ia=(a("2ca0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("span",{staticClass:"title"},[e._v(e._s(e.nodeDetail.NodeName))]),a("span",{staticStyle:{"margin-left":"10px"}},["Active"==e.nodeDetail.status?a("el-tag",{attrs:{effect:"plain",type:"success"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e(),"Unavailable"==e.nodeDetail.status?a("el-tag",{attrs:{effect:"plain",type:"danger"}},[e._v(" "+e._s(e.nodeDetail.status)+" ")]):e._e()],1),a("span",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-back",size:"small"},on:{click:e.closeDetail}})],1)]),a("div",{staticStyle:{"margin-top":"10px"}},[a("span",[e._v("Age:"+e._s(e.getAge(e.nodeDetail.CreationTimestamp)))])]),a("el-divider"),a("div",[e._l(e.nodeDetail.NodeAddress,(function(t){return a("span",{staticClass:"item"},[e._v(e._s(t.type+":"+t.address))])})),a("span",{staticClass:"item"},[e._v("Version:"+e._s(e.nodeDetail.NodInfo.kernelVersion))]),a("span",{staticClass:"item"},[e._v("OS:"+e._s(e.nodeDetail.NodInfo.osImage))]),a("span",{staticClass:"item"},[e._v("containerRuntimeVersion:"+e._s(e.nodeDetail.NodInfo.containerRuntimeVersion))])],2),a("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Labels: "),e._l(e.nodeDetail.Labels,(function(t,o){return a("el-tag",{key:o,staticStyle:{margin:"2px 2px"},attrs:{effect:"plain",type:e._f("tagType")(o)}},[e._v(" "+e._s(o+":"+t)+" ")])}))],2),a("el-divider"),a("div",{staticStyle:{"margin-top":"10px"}},[e._v(" Conditions: "),e._l(e.nodeDetail.Conditions,(function(t){return a("el-tooltip",{key:t.type,attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},e._l(t,(function(t,o){return a("p",{key:o,staticStyle:{margin:"4px 0","font-size":"12px"}},[e._v(" "+e._s(o+":"+t)+" ")])})),0),a("el-tag",{staticStyle:{margin:"2px 15px"},attrs:{effect:"dark",type:e._f("conditionsStatus")(t)}},[e._v(" "+e._s(t.type)+" ")])],1)})),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("CPU")]),a("span",{staticStyle:{float:"right"}},[e._v("0 of 4")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("MEMORY")]),a("span",{staticStyle:{float:"right"}},[e._v("0 of 7.78 GiB ")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:1}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-card",{attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("PODS")]),a("span",{staticStyle:{float:"right"}},[e._v("8 of 110")])]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":20,percentage:7.3}})],1)],1)],1)],2),a("el-divider"),a("el-tabs",{attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"Info"}},[a("el-form",{attrs:{"label-width":"300px","label-position":"left"}},e._l(e.nodeDetail.NodInfo,(function(t,o){return a("div",{key:o},[a("el-form-item",{attrs:{label:o}},[e._v(" "+e._s(t)+" ")])],1)})),0)],1),a("el-tab-pane",{attrs:{label:"Images"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Images,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"names"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.names,(function(t){return a("p",{key:t},[e._v(" "+e._s(t)+" ")])}))}}])}),a("el-table-column",{attrs:{label:"size",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(Math.ceil(t.row.sizeBytes/1024/1024)+"M")+" ")]}}])})],1)],1),a("el-tab-pane",{attrs:{label:"Taints"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Taints,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"effect",prop:"effect",width:"300"}}),a("el-table-column",{attrs:{label:"key",prop:"key"}})],1)],1),a("el-tab-pane",{attrs:{label:"Conditions"}},[a("el-table",{ref:"table",attrs:{data:e.nodeDetail.Conditions,border:"",stripe:"","highlight-current-row":"",height:"400px"}},[a("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),a("el-table-column",{attrs:{label:"status",prop:"status",width:"80"}}),a("el-table-column",{attrs:{label:"message",prop:"message"}}),a("el-table-column",{attrs:{label:"reason",prop:"reason"}}),a("el-table-column",{attrs:{label:"lastTransitionTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTransitionTime)))]}}])}),a("el-table-column",{attrs:{label:"lastHeartbeatTime",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastHeartbeatTime)))]}}])})],1)],1)],1)],1)}),Da=[],Oa={name:"node-detail",props:["nodeDetail"],filters:{tagType:function(e){return e.startsWith("tars.io/node")?"warning":e.startsWith("tars.io/ability")?"success":""},conditionsStatus:function(e){return"False"==e.status?"danger":"success"},timeFormat:function(e){return E()(e).format("YYYY-MM-DD HH:mm:ss")}},methods:{closeDetail:function(){this.$emit("closeDetail")},getAge:function(e){var t=Math.ceil((new Date-new Date(e))/36e5),a=0,o=0;return t>=24&&(a=Math.ceil(t/24),o=t%24),"".concat(a,"d").concat(o>0?o+"h":"")}}},qa=Oa,Pa=(a("f333"),Object(w["a"])(qa,Ia,Da,!1,null,"38a1db4e",null)),ja=Pa.exports,za={name:"BaseBusiness",components:{nodeDetail:ja},data:function(){return{multipleSelection:[],query:{NodeName:""},items:[],pagination:{page:1,size:10,total:1},commonTagDialog:{flag:"one",show:!1,model:{}},abilityTagDialog:{flag:"one",show:!1,model:{}},appList:[],serList:[],showDetail:!1,nodeDetail:{}}},filters:{tagType:function(e){return e.startsWith("taf.io/node")?"warning":""},abilityType:function(e){return-1!=e.indexOf(".")?"success":""}},computed:{batchEnabled:function(){return this.multipleSelection.length>0}},mounted:function(){this.fetchData(),this.getAppList()},methods:{handleSelectionChange:function(e){this.multipleSelection=e},gotoPage:function(e){this.pagination.page=e,this.getServerList()},fetchData:function(){var e=this;return this.$ajax.getJSON("/k8s/api/node_select",Object.assign(this.query,{page:this.pagination.page,size:this.pagination.size})).then((function(t){t.Data.forEach((function(e){var t="";e.Conditions.forEach((function(e){"Ready"==e.Type&&(t=e.status)})),e.status="False"==t?"Unavailable":"Active"})),e.items=t.Data,e.pagination.total=Math.ceil(t.Count.AllCount/e.pagination.size)})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},search:function(){this.pagination.page=1,this.fetchData()},editCommonTag:function(e){for(var t in this.commonTagDialog.show=!0,this.commonTagDialog.flag="one",this.commonTagDialog.model=Ct.a.cloneDeep(e),this.commonTagDialog.model.commonArr=[],e.Labels)t.startsWith("taf.io/node")||t.startsWith("taf.io/ability")||this.commonTagDialog.model.commonArr.push({name:t,value:e.Labels[t]})},batchEditCommon:function(){1==this.multipleSelection.length?this.editCommonTag(this.multipleSelection[0]):(this.commonTagDialog.show=!0,this.commonTagDialog.flag="batch",this.commonTagDialog.model.nodes=this.multipleSelection,this.commonTagDialog.model.commonArr=[{name:"",value:""}])},saveCommonTag:function(){var e=this;if(this.validate(this.$refs.commonForm)){var t=[];this.commonTagDialog.model.nodes&&(t=this.commonTagDialog.model.nodes.map((function(e){return e.NodeName})));var a="",o={};"one"==this.commonTagDialog.flag?(a="/k8s/api/edit_common_tag",o={nodeName:this.commonTagDialog.model.NodeName,tags:this.commonTagDialog.model.commonArr}):(a="/k8s/api/batch_edit_common_tag",o={nodeNames:t,tags:this.commonTagDialog.model.commonArr}),this.$ajax.postJSON(a,o).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeCommonTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeCommonTagDialog:function(){this.commonTagDialog={flag:"one",show:!1,model:{}}},editAbilityTag:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){var o,r,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:t.abilityTagDialog.show=!0,t.abilityTagDialog.flag="one",t.abilityTagDialog.model=Ct.a.cloneDeep(e),t.abilityTagDialog.model.abilityArr=[],o=Object(K["a"])(e.NodeAbility),a.prev=5,o.s();case 7:if((r=o.n()).done){a.next=19;break}return l=r.value,a.t0=t.abilityTagDialog.model.abilityArr,a.t1=l.split(".")[0],a.t2=l.split(".")[1]||"",a.next=14,t.getServerList(l.split(".")[0]);case 14:a.t3=a.sent,a.t4={application:a.t1,serverName:a.t2,serverNames:a.t3},a.t0.push.call(a.t0,a.t4);case 17:a.next=7;break;case 19:a.next=24;break;case 21:a.prev=21,a.t5=a["catch"](5),o.e(a.t5);case 24:return a.prev=24,o.f(),a.finish(24);case 27:case"end":return a.stop()}}),a,null,[[5,21,24,27]])})))()},batchEditAffinity:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1!=e.multipleSelection.length){t.next=5;break}return t.next=3,e.editCommonTag(e.multipleSelection[0]);case 3:t.next=9;break;case 5:e.abilityTagDialog.show=!0,e.abilityTagDialog.flag="batch",e.abilityTagDialog.model.nodes=e.multipleSelection,e.abilityTagDialog.model.abilityArr=[{application:"",serverName:"",serverNames:""}];case 9:case"end":return t.stop()}}),t)})))()},saveAbilityTag:function(){var e=this;if(this.validate(this.$refs.abilityForm)){var t=[];this.abilityTagDialog.model.nodes&&(t=this.abilityTagDialog.model.nodes.map((function(e){return e.NodeName})));var a=this.abilityTagDialog.model.abilityArr.map((function(e){return{application:e.application,serverName:e.serverName}})),o="",r={};"one"==this.abilityTagDialog.flag?(o="/k8s/api/edit_ability_tag",r={nodeName:this.abilityTagDialog.model.NodeName,tags:a}):(o="/k8s/api/batch_edit_ability_tag",r={nodeNames:t,tags:a}),this.$ajax.postJSON(o,r).then((function(){e.$message.success("".concat(e.$t("common.success"))),e.closeAbilityTagDialog(),e.fetchData()})).catch((function(t){e.$message.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))}},closeAbilityTagDialog:function(){this.abilityTagDialog={flag:"one",show:!1,model:{}}},validate:function(e){var t=!0;return e.validate((function(e){e||(t=!1)})),t},viewItem:function(e){this.showDetail=!0,this.nodeDetail=Ct.a.cloneDeep(e)},closeDetail:function(){this.showDetail=!1,this.fetchData()},changeStatus:function(e){if(e.NodePublic){if(e.Labels.hasOwnProperty("node-role.kubernetes.io/master"))return void this.fetchData();this.addTafTag(e.NodeName)}else this.delTafTag(e.NodeName)},addTafTag:function(e){var t=this;this.$ajax.postJSON("/k8s/api/taf_ability_open",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},delTafTag:function(e){var t=this;this.$ajax.postJSON("/k8s/api/taf_ability_close",{NodeName:e}).then((function(){t.$tip.success(t.$t("common.success")),t.fetchData()})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){var o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 2:return o=a.sent,r=o.Data.map((function(e){return e.ServerName})),a.abrupt("return",r);case 5:case"end":return a.stop()}}),a)})))()},changeApp:function(e,t){var a=this;return Object(j["a"])(regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,a.getServerList(t);case 2:r=o.sent,a.$set(a.abilityTagDialog.model.abilityArr[e],"serverNames",r);case 4:case"end":return o.stop()}}),o)})))()},queryAppChange:function(){var e=this;return Object(j["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getServerList(e.query.ServerApp);case 2:a=t.sent,e.$set(e.query,"ServerName",""),e.serList=a;case 5:case"end":return t.stop()}}),t)})))()},addCommonTag:function(e,t){t.splice(e+1,0,{name:"",value:""}),this.$forceUpdate()},delCommonTag:function(e,t){t.splice(e,1),this.$forceUpdate()},addAbilityTag:function(e,t){t.splice(e+1,0,{application:"",serverName:"",serverNames:[]}),this.$forceUpdate()},delAbilityTag:function(e,t){t.splice(e,1),this.$forceUpdate()},validateTagName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.notNull")))):o.toLowerCase().startsWith("taf.io")?a(new Error("".concat(this.$t("filter.tip.notTaf")))):a()},validateAppName:function(e,t,a,o){""===o?a(new Error("".concat(this.$t("filter.tip.application")))):a()}}},Ra=za,Ba=(a("e81f"),a("cdeb"),Object(w["a"])(Ra,La,Aa,!1,null,"78a7d013",null)),Ea=Ba.exports,Ja=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("let-form",{attrs:{inline:"",itemWidth:"180px"},nativeOn:{submit:function(t){return t.preventDefault(),e.search(t)}}},[a("let-form-item",{staticStyle:{width:"400px"},attrs:{label:e.$t("callChain.date")}},[a("el-date-picker",{attrs:{size:"small",type:"datetimerange","range-separator":"~","start-placeholder":e.$t("board.alarm.form.startDate"),"end-placeholder":e.$t("board.alarm.form.endDate"),"value-format":"timestamp"},model:{value:e.eventDate,callback:function(t){e.eventDate=t},expression:"eventDate"}})],1),a("let-form-item",{attrs:{label:e.$t("filter.title.app")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),size:"small",disabled:!e.serverEnable,clearable:""},on:{change:function(t){return e.getServerList(e.query.application)}},model:{value:e.query.application,callback:function(t){e.$set(e.query,"application",t)},expression:"query.application"}},e._l(e.appList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("filter.title.serverName")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.getPods},model:{value:e.query.serverName,callback:function(t){e.$set(e.query,"serverName",t)},expression:"query.serverName"}},e._l(e.serverNames,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("serverList.table.th.podName")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",disabled:!e.serverEnable,size:"small"},on:{change:e.search},model:{value:e.query.pod,callback:function(t){e.$set(e.query,"pod",t)},expression:"query.pod"}},e._l(e.pods,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{attrs:{label:e.$t("event.eventLevel")}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("pub.dlg.defaultValue"),clearable:"",size:"small"},on:{change:e.search},model:{value:e.query.level,callback:function(t){e.$set(e.query,"level",t)},expression:"query.level"}},e._l(e.levels,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("let-form-item",{staticStyle:{width:"240px"}},[a("el-radio-group",{attrs:{size:"small"},on:{change:e.checkedChange},model:{value:e.query.check,callback:function(t){e.$set(e.query,"check",t)},expression:"query.check"}},[a("el-radio-button",{attrs:{label:"Server"}},[e._v(e._s(e.$t("event.type.server")))]),a("el-radio-button",{attrs:{label:"Cluster"}},[e._v(e._s(e.$t("event.type.cluster")))]),a("el-radio-button",{attrs:{label:"Downtime"}},[e._v(e._s(e.$t("event.type.downtime")))])],1)],1),a("let-form-item",[a("let-button",{attrs:{size:"small",theme:"primary"},on:{click:e.search}},[e._v(e._s(e.$t("operate.search")))])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.events,border:"",stripe:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"kind",width:"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.kind||""))]}}])}),a("el-table-column",{attrs:{label:"namespace",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.namespace||""))]}}])}),a("el-table-column",{attrs:{label:"name",width:"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.involvedObject.name||""))]}}])}),a("el-table-column",{attrs:{label:"type",prop:"type",width:"150"}}),a("el-table-column",{attrs:{label:"reason",prop:"reason",width:"200"}}),a("el-table-column",{attrs:{label:"message",prop:"message","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"firstTime",width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.firstTimestamp)))]}}])}),a("el-table-column",{attrs:{label:"lastTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("timeFormat")(t.row.lastTimestamp)))]}}])})],1),a("br"),a("let-pagination",{staticStyle:{float:"right"},attrs:{align:"right",page:e.pagination.page,total:e.pagination.total},on:{change:e.handleCurrentChange}})],1)},Ha=[],Fa=(a("841c"),{name:"event",data:function(){return{query:{application:"",serverName:"",check:"Server"},eventDate:[new Date((new Date).getTime()-72e5).getTime(),(new Date).getTime()],appList:[],serverNames:[],pods:[],levels:["Normal","Warning"],loading:!1,pagination:{page:1,size:20,total:1},events:[]}},filters:{timeFormat:function(e){return E()(e).format("YYYY-MM-DD HH:mm:ss")}},watch:{$route:function(e,t){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.search()}},mounted:function(){this.$set(this.query,"application",this.$route.query.application||""),this.$set(this.query,"serverName",this.$route.query.serverName||""),this.getAppList(),this.search()},computed:{serverEnable:function(){return"Server"==this.query.check}},methods:{checkedChange:function(){this.pagination.page=1,this.loadData(1)},handleCurrentChange:function(e){this.loadData(e)},search:function(){this.loadData(1)},loadData:function(e){var t=this;e||(e=1);var a="",o="";this.eventDate&&(a=this.eventDate[0],o=this.eventDate[1]);var r=Object.assign({},this.query,{currPage:e,pageSize:this.pagination.size},{startDate:a,endDate:o});this.loading=!0,this.$ajax.getJSON("/k8s/api/get_events",r).then((function(e){t.events=e.rows,t.pagination.total=e.total,t.loading=!1})).catch((function(e){t.loading=!1,t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},getAppList:function(){var e=this;this.$ajax.getJSON("/k8s/api/application_select",{}).then((function(t){e.appList=t.Data.map((function(e){return e.ServerApp}))})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getServerList:function(e){var t=this;return Object(j["a"])(regeneratorRuntime.mark((function a(){var o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$set(t.query,"serverName",""),a.next=3,t.$ajax.getJSON("/k8s/api/server_list",{ServerApp:e,isAll:!0});case 3:o=a.sent,t.serverNames=o.Data.map((function(e){return e.ServerName})),t.search();case 6:case"end":return a.stop()}}),a)})))()},getPods:function(){var e=this;this.$set(this.query,"pod","");var t="",a="";this.eventDate&&(t=this.eventDate[0],a=this.eventDate[1]);var o=Object.assign({},this.query,{startDate:t,endDate:a});this.$ajax.getJSON("/k8s/api/get_pods",o).then((function(t){e.pods=t,e.search()})).catch((function(t){e.$set(e,"pods","")})),this.search()}}}),Va=Fa,Ka=Object(w["a"])(Va,Ja,Ha,!1,null,"5419c7a2",null),Wa=Ka.exports,Ya=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page_framework_config"},[[a("el-button",{staticStyle:{width:"100px",margin:"10px 0 5px 0",float:"right"},attrs:{size:"mini",type:"primary"},on:{click:e.showYaml}},[e._v(e._s(e.$t("operate.yaml"))+" ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.config,stripe:"",border:""}},[a("el-table-column",{attrs:{prop:"column",label:"key",width:"300"}}),a("el-table-column",{attrs:{prop:"remark",label:"remark",width:"300"}}),a("el-table-column",{attrs:{label:"value"},scopedSlots:e._u([{key:"default",fn:function(t){return["nodeImage.image"==t.row.column?a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}},e._l(e.nodeList,(function(t){return a("el-option",{key:t.Image,attrs:{value:t.Image}},[a("span",[e._v(e._s(t.Image))])])})),1):a("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:8},placeholder:"请输入内容"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])}),a("el-table-column",{attrs:{label:e.$t("operate.operates"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("let-table-operation",{on:{click:function(a){return e.saveTfcItem(t.row)}}},[e._v(" "+e._s(e.$t("operate.save"))+" ")])]}}])})],1),a("el-dialog",{attrs:{title:"Framework config",width:"50%",top:"50px",visible:e.showDialog,"before-close":e.closeDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("k8s-yaml-edit",{ref:"yamlEdit",on:{successFun:e.closeDialog}})],1)]],2)},Ua=[],Za={name:"frameworkConfig",data:function(){return{showDialog:!1,config:[],nodeList:[]}},components:{K8sYamlEdit:Ne},mounted:function(){this.getTfc(),this.getTafNodeList()},methods:{getTfc:function(){var e=this;this.$ajax.getJSON("/k8s/api/get_tfc").then((function(t){e.config=t})).catch((function(t){e.$tip.error("".concat(e.$t("common.error"),": ").concat(t.message||t.err_msg))}))},getTafNodeList:function(){var e=this;this.$ajax.getJSON("/k8s/api/image_node_select").then((function(t){e.nodeList=t.Data}))},saveTfcItem:function(e){var t=this;this.$ajax.postJSON("/k8s/api/save_tfc_item",e).then((function(e){t.$message.success("".concat(t.$t("common.success")))})).catch((function(e){t.$tip.error("".concat(t.$t("common.error"),": ").concat(e.message||e.err_msg))}))},showYaml:function(){var e=this;this.showDialog=!0,this.$nextTick((function(){e.$refs.yamlEdit.show("111","tframeworkconfigs"),e.$refs.yamlEdit.refresh()}))},closeDialog:function(){this.showDialog=!1,this.getTfc()}}},Ga=Za,Qa=(a("2562"),Object(w["a"])(Ga,Ya,Ua,!1,null,"3e5fdd24",null)),Xa=Qa.exports,eo=a("e3f3"),to=a("46e7"),ao=I["a"].prototype.push;I["a"].prototype.push=function(e){return ao.call(this,e).catch((function(e){return e}))},o["default"].use(I["a"]);var oo=new I["a"]({routes:[{path:"/server",name:"Server",component:vt,children:[{path:":treeid/manage",component:qe},{path:":treeid/history",component:it},{path:":treeid/publish",component:He},{path:":treeid/config",component:Ze},{path:":treeid/server-monitor",component:Ge["a"]},{path:":treeid/property-monitor",component:Qe["a"]},{path:":treeid/interface-debuger",component:Xe["a"]},{path:":treeid/user-manage",component:et["a"]}]},{path:"/operation",name:"Operation",component:kt,redirect:"/operation/deploy",children:[{path:"deploy",component:Ot},{path:"approval",component:Et},{path:"history",component:Wt},{path:"undeploy",component:Xt},{path:"templates",component:la},{path:"image",component:pa},{path:"affinity",component:ga},{path:"application",component:ka},{path:"business",component:Ta},{path:"node",component:Ea},{path:"event",component:Wa},{path:"tfc",component:Xa}]},{path:"/gateway",name:"Gateway",component:eo["a"]},to["d"],to["b"],to["c"],to["a"],{path:"*",redirect:"/server"}],scrollBehavior:function(e,t,a){return{x:0,y:0}}}),ro=a("5c96"),lo=a.n(ro),io=(a("a082"),a("42a1"),a("0808"),a("6944")),so=a.n(io);o["default"].config.productionTip=!1,y["b"].call(void 0).then((function(){o["default"].use(so.a),o["default"].use(lo.a,{i18n:function(e,t){return y["a"].t(e,t)}}),new o["default"]({i18n:y["a"],el:"#app",router:oo,store:r["a"],components:{k8sApp:A},template:"<k8sApp/>"})}))},"4e15":function(e,t,a){"use strict";var o=a("0d43"),r=a.n(o);r.a},"5d82":function(e,t,a){"use strict";var o=a("ff5a"),r=a.n(o);r.a},"5dd2":function(e,t,a){"use strict";var o=a("af03"),r=a.n(o);r.a},"5de2":function(e,t,a){"use strict";var o=a("c37c"),r=a.n(o);r.a},"5e23":function(e,t,a){},"626e":function(e,t,a){},"67f3":function(e,t,a){},"6c7a":function(e,t,a){"use strict";var o=a("0dbe"),r=a.n(o);r.a},"6e59":function(e,t,a){},"7b9a":function(e,t,a){"use strict";var o=a("24ee"),r=a.n(o);r.a},8924:function(e,t,a){},"98b3":function(e,t,a){"use strict";var o=a("e779"),r=a.n(o);r.a},"9df2":function(e,t,a){"use strict";var o=a("8924"),r=a.n(o);r.a},af03:function(e,t,a){},afb9:function(e,t,a){"use strict";var o=a("3d87"),r=a.n(o);r.a},b2b3:function(e,t,a){},b50eb:function(e,t,a){"use strict";var o=a("c26a"),r=a.n(o);r.a},c219:function(e,t,a){"use strict";var o=a("168e"),r=a.n(o);r.a},c26a:function(e,t,a){},c37c:function(e,t,a){},c3f0:function(e,t,a){"use strict";var o=a("e5f7"),r=a.n(o);r.a},c49e:function(e,t,a){},c914:function(e,t,a){"use strict";var o=a("2c1d"),r=a.n(o);r.a},ca4b:function(e,t,a){},ca6f:function(e,t,a){"use strict";var o=a("6e59"),r=a.n(o);r.a},cb44:function(e,t,a){"use strict";var o=a("5e23"),r=a.n(o);r.a},cdeb:function(e,t,a){"use strict";var o=a("67f3"),r=a.n(o);r.a},e5f7:function(e,t,a){},e779:function(e,t,a){},e81f:function(e,t,a){"use strict";var o=a("ca4b"),r=a.n(o);r.a},e93e:function(e,t,a){},f333:function(e,t,a){"use strict";var o=a("437c"),r=a.n(o);r.a},ff5a:function(e,t,a){}});